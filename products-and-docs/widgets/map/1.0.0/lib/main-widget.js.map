{"version":3,"sources":["../src/main-widget.es6"],"names":["TicketmasterMapWidget","attr","config","hasOwnProperty","attrs","widgetConfig","loadConfig","responce","eventsList","parseEvents","proportion","border","height","widgetHeight","window","location","host","mapWidgetRoot","eventsRootContainer","parentNode","params","verboseName","i","item","isConfigAttrExistAndNotEmpty","latlong","postalcode","period","getDateFromPeriod","startDateTime","endDateTime","tmapikey","apikey","apiKeyService","checkApiKeyCookie","getApiWidgetsKey","getAttribute","root","widgetRoot","querySelector","document","createElement","classList","add","appendChild","attributes","eventsRoot","id","style","width","theme","getElementById","makeRequest","styleLoadingHandler","themeUrl","remove","borderRadius","borderradius","borderWidth","borderSize","AdditionalElements","useGeolocation","getCoordinates","eventsLoadingHandler","apiUrl","eventReqAttrs","embedUniversePlugin","embedTMPlugin","initBuyBtn","initMessage","cb","widget","onLoadCoordinate","buyBtn","createTextNode","target","href","setAttribute","addEventListener","e","preventDefault","event","url","isUniversePluginInitialized","isUniverseUrl","isTMPluginInitialized","isAllowedTMEvent","match","t","n","r","length","tmWidgetWhiteList","indexOf","script","portalUrl","head","getElementsByTagName","messageDialog","messageContent","messageClose","hideMessage","message","hideMessageWithoutDelay","innerHTML","messageTimeout","clearTimeout","delay","setTimeout","clickNearMe","navigator","geolocation","getCurrentPosition","position","latitude","coords","longitude","update","buttons","getElementsByClassName","current","nearMeBtn","legalNoticeContent","legalNotice","legalNoticeUrl","logo","logoUrl","logoBox","question","questionUrl","toolTipHandler","toolTip","tooltipHtml","widgetVersion","nextSibling","toggle","date","result","day","LZ","x","MONTH_NAMES","DAY_NAMES","dayArray","split","d","parseInt","M","E","Date","getDay","time","timeArray","H","m","a","modificatorList","el","parent","removeChild","clearEvents","oldTheme","constructor","widgetContentHeight","clear","events","undefined","newTheme","forCheck","Object","keys","map","key","NamedNodeMap","value","name","replace","readyState","XMLHttpRequest","DONE","status","textContent","responseText","console","log","groups","push","eventsGroups","groupName","reduceParamsOrder","reduceParamsList","showMessage","markers","infowindow","google","maps","InfoWindow","content","image","size","Size","origin","Point","anchor","imageActive","sites","siteLatLng","LatLng","marker","Marker","icon","title","zIndex","html","addListener","setContent","open","setIcon","JSON","parse","myLatLng","lat","lng","Map","zoom","center","mapTypeId","MapTypeId","ROADMAP","mapTypeControl","panControl","streetViewControl","zoomControlOptions","ControlPosition","RIGHT_CENTER","latlngbounds","LatLngBounds","groupEventsByName","call","place","address","formatDate","line1","img","extend","fitBounds","setMarkers","resetReduceParamsOrder","hideMessageWithDelay","hideMessageDelay","reduceParamsAndReloadEvents","group","index","groupNodeWrapper","groupNode","publishEvent","DOMElement","createDOMItem","images","imgWidth","idx","forEach","eventsSet","_embedded","$widgetModalNoCode","modal","tmpEventSet","currentEvent","parser","expr","changeURL","pathname","join","search","hash","dates","start","localDate","localTime","venue","venues","parseFloat","getImageForEvent","handler","method","xmlHTTP","ActiveXObject","setRequestHeader","onreadystatechange","send","isBlank","win","focus","isListView","backgroundImage","domNode","_urlValid","itemConfig","medWrapper","createBackgroundImage","nameContent","initPretendedLink","colorscheme","addBuyButton","dateTimeContent","dateTime","dateWraper","addressWrapper","addressNameText","addressName","addressOneText","addressOne","addressTwoText","line2","addressTwo","categoriesWrapper","categories","element","categoryText","category","atob","btoa","dateObj","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","toLowerCase","firstDay","lastDay","toISOString","slice","valueOf","widgetsMap","widgetContainers","querySelectorAll","s","o","g","q","arguments","l","async","src","insertBefore","ga"],"mappings":"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","file":"main-widget.js","sourcesContent":["class TicketmasterMapWidget {\r\n\r\n    set config(attrs) { this.widgetConfig = this.loadConfig(attrs); }\r\n    get config() { return this.widgetConfig; }\r\n\r\n    set events(responce){ this.eventsList = this.parseEvents(responce);}\r\n    get events(){ return this.eventsList;}\r\n\r\n    get isSimpleProportionM() { return this.config.proportion === 'm'}\r\n    get borderSize(){ return this.config.border || 0;}\r\n    get widgetHeight(){ return this.config.height || 600;}\r\n\r\n    get widgetContentHeight() {\r\n        // return this.widgetHeight - (this.isListView || this.isSimpleProportionM ? 0 : 39) || 600;\r\n        return this.widgetHeight;\r\n    }\r\n\r\n    get eventUrl(){ return \"https://www.ticketmaster.com/event/\"; }\r\n\r\n    get apiUrl(){ return \"https://app.ticketmaster.com/discovery/v2/events.json\"; }\r\n\r\n    get themeUrl() {\r\n        return (window.location.host === 'developer.ticketmaster.com')\r\n            ? `https://developer.ticketmaster.com/products-and-docs/widgets/map/1.0.0/theme/`\r\n            : `https://ticketmaster-api-staging.github.io/products-and-docs/widgets/map/1.0.0/theme/`;\r\n    }\r\n\r\n    get portalUrl(){\r\n        return (window.location.host === 'developer.ticketmaster.com')\r\n            ? `https://developer.ticketmaster.com/`\r\n            : `https://ticketmaster-api-staging.github.io/`;\r\n    }\r\n\r\n    get logoUrl() { return \"https://www.ticketmaster.com/\"; }\r\n\r\n    get legalNoticeUrl() { return \"http://developer.ticketmaster.com/support/terms-of-use/\"; }\r\n\r\n    get questionUrl() { return \"http://developer.ticketmaster.com/support/faq/\"; }\r\n\r\n    get widgetVersion() { return \"1.0.0\"; }\r\n\r\n    get geocodeUrl() { return \"https://maps.googleapis.com/maps/api/geocode/json\"; }\r\n\r\n    get updateExceptions() { return [\"width\", \"height\", \"border\", \"borderradius\", \"colorscheme\", \"layout\", \"affiliateid\", \"propotion\", \"googleapikey\", \"latlong\"]}\r\n\r\n    get hideMessageDelay(){ return 5000; }\r\n\r\n    get controlHiddenClass(){ return \"events_control-hidden\"; }\r\n\r\n    get tmWidgetWhiteList(){ return [\"2200504BAD4C848F\", \"00005044BDC83AE6\", \"1B005068DB60687F\", \"1B004F4DBEE45E47\", \"3A004F4ED7829D5E\", \"3A004F4ED1FC9B63\", \"1B004F4FF83289C5\", \"1B004F4FC0276888\", \"0E004F4F3B7DC543\", \"1D004F4F09C61861\", \"1600505AC9A972A1\", \"22004F4FD82795C6\", \"01005057AFF54574\", \"01005056FAD8793A\", \"3A004F4FB2453240\", \"22004F50D2149AC6\", \"01005059AD49507A\", \"01005062B4236D5D\"]; }\r\n\r\n    get countriesWhiteList() {\r\n        return [\r\n            'Australia',\r\n            'Austria',\r\n            'Belgium',\r\n            'Canada',\r\n            'Denmark',\r\n            'Finland',\r\n            'France',\r\n            'Germany',\r\n            'Ireland',\r\n            'Mexico',\r\n            'Netherlands',\r\n            'New Zealand',\r\n            'Norway',\r\n            'Spain',\r\n            'Sweden',\r\n            'Turkey',\r\n            'UAE',\r\n            'United Kingdom',\r\n            'United States'\r\n        ]\r\n    }\r\n\r\n    isConfigAttrExistAndNotEmpty(attr) {\r\n\r\n        if( !this.config.hasOwnProperty(attr) || this.config[attr] === \"undefined\"){\r\n            return false;\r\n        }else if( this.config[attr] === \"\"){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    get eventReqAttrs(){\r\n        let mapWidgetRoot = this.eventsRootContainer.parentNode;\r\n        let attrs = {},\r\n            params = [\r\n                {\r\n                    attr: 'tmapikey',\r\n                    verboseName: 'apikey'\r\n                },\r\n                {\r\n                    attr: 'latlong',\r\n                    verboseName: 'latlong'\r\n                },\r\n                {\r\n                    attr: 'postalcode',\r\n                    verboseName: 'postalCode'\r\n                },\r\n                {\r\n                    attr: 'keyword',\r\n                    verboseName: 'keyword'\r\n                },\r\n                {\r\n                    attr: 'size',\r\n                    verboseName: 'size'\r\n                },\r\n                {\r\n                    attr: 'radius',\r\n                    verboseName: 'radius'\r\n                },\r\n                {\r\n                    attr: 'attractionid',\r\n                    verboseName: 'attractionId'\r\n                },\r\n                {\r\n                    attr: 'promoterid',\r\n                    verboseName: 'promoterId'\r\n                },\r\n                {\r\n                    attr: 'venueid',\r\n                    verboseName: 'venueId'\r\n                },\r\n                {\r\n                    attr: 'classificationname',\r\n                    verboseName: 'classificationName'\r\n                },\r\n                {\r\n                    attr: 'city',\r\n                    verboseName: 'city'\r\n                },\r\n                {\r\n                    attr: 'countrycode',\r\n                    verboseName: 'countryCode'\r\n                },\r\n                {\r\n                    attr: 'source',\r\n                    verboseName: 'source'\r\n                }\r\n            ];\r\n\r\n        for(let i in params){\r\n            let item = params[i];\r\n            if(this.isConfigAttrExistAndNotEmpty(item.attr))\r\n                attrs[item.verboseName] = this.config[item.attr];\r\n        }\r\n\r\n        if(this.config.latlong){\r\n            attrs.latlong = this.config.latlong;\r\n        }\r\n\r\n        if(this.config.postalcode) {\r\n            attrs.postalcode = this.config.postalcode;\r\n        }\r\n\r\n        if(this.isConfigAttrExistAndNotEmpty(\"period\")){\r\n            let period = this.getDateFromPeriod(this.config.period);\r\n            attrs.startDateTime = period[0];\r\n            attrs.endDateTime = period[1];\r\n        }\r\n\r\n        if (this.config.tmapikey == '') {\r\n            attrs.apikey = apiKeyService.checkApiKeyCookie() || apiKeyService.getApiWidgetsKey();\r\n        }\r\n\r\n        if (mapWidgetRoot.getAttribute(\"w-latlong\") != '') {\r\n            attrs.latlong = mapWidgetRoot.getAttribute(\"w-latlong\");\r\n        }\r\n\r\n        if (attrs.latlong == ',') {\r\n            delete attrs.latlong;\r\n        }\r\n\r\n        if (attrs.latlong == null) {\r\n            delete attrs.latlong;\r\n        }\r\n\r\n        return attrs;\r\n    }\r\n\r\n    constructor(root) {\r\n        if(!root) return;\r\n        this.widgetRoot = root;\r\n        if (this.widgetRoot.querySelector('.events-root-container') === null) {\r\n            this.eventsRootContainer = document.createElement(\"div\");\r\n            this.eventsRootContainer.classList.add(\"events-root-container\");\r\n            this.widgetRoot.appendChild(this.eventsRootContainer);\r\n\r\n            this.config = this.widgetRoot.attributes;\r\n\r\n            this.eventsRoot = document.createElement(\"div\");\r\n            this.eventsRoot.id = \"map\";\r\n            // this.eventsRoot.style.height = parseInt(parseInt(this.widgetHeight) + 25) + \"px\";\r\n            this.eventsRoot.style.height = this.widgetHeight + \"px\";\r\n            this.eventsRoot.style.width = this.config.width + \"px\";\r\n            this.eventsRootContainer.appendChild(this.eventsRoot);\r\n\r\n            if (this.config.theme !== null && !document.getElementById(`widget-theme-${this.config.theme}`)) {\r\n                this.makeRequest(this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\");\r\n            }\r\n\r\n            this.eventsRootContainer.classList.remove(\"border\");\r\n            if (this.config.border) {\r\n                this.eventsRootContainer.classList.add(\"border\");\r\n            }\r\n\r\n            this.widgetRoot.style.height = `${this.widgetHeight}px`;\r\n            this.widgetRoot.style.width = `${this.config.width}px`;\r\n            this.eventsRootContainer.style.height = `${this.widgetHeight}px`;\r\n            this.eventsRootContainer.style.width = `${this.config.width}px`;\r\n            this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\r\n            this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\r\n\r\n            //this.clear();\r\n\r\n            this.AdditionalElements();\r\n\r\n            this.useGeolocation();\r\n\r\n            this.getCoordinates(() => {\r\n                this.makeRequest(this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs);\r\n            });\r\n            /*plugins for 'buy button'*/\r\n            this.embedUniversePlugin();\r\n            this.embedTMPlugin();\r\n            this.initBuyBtn();\r\n            this.initMessage();\r\n        }\r\n    }\r\n\r\n    getCoordinates(cb){\r\n        let widget = this;\r\n        if(this.config.postalcode) {\r\n            widget.config.postalcode = this.config.postalcode;\r\n            cb(widget.config.postalcode);\r\n        }else{\r\n            // Used in builder\r\n            if(widget.onLoadCoordinate) widget.onLoadCoordinate(null);\r\n            widget.config.latlong = '';\r\n            // widget.config.countrycode = '';\r\n            cb(widget.config.latlong);\r\n        }\r\n    }\r\n\r\n    initBuyBtn(){\r\n        this.buyBtn = document.createElement(\"a\");\r\n        this.buyBtn.appendChild(document.createTextNode('BUY NOW'));\r\n        this.buyBtn.classList.add(\"event-buy-btn\");\r\n        this.buyBtn.classList.add(\"main-btn\");\r\n        this.buyBtn.target = '_blank';\r\n        this.buyBtn.href = '';\r\n        this.buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\r\n        this.buyBtn.addEventListener('click', (e)=> {\r\n            e.preventDefault();\r\n        });\r\n        this.eventsRootContainer.appendChild(this.buyBtn);\r\n    }\r\n\r\n    setBuyBtnUrl(){\r\n        if(this.buyBtn){\r\n            let event = '',\r\n                url = '';\r\n            if(event){\r\n                if(event.url){\r\n\r\n                    if((this.isUniversePluginInitialized && this.isUniverseUrl(event.url)) || (this.isTMPluginInitialized && this.isAllowedTMEvent(event.url))){\r\n                        url = event.url;\r\n                    }\r\n\r\n                }\r\n            }\r\n            this.buyBtn.href = url;\r\n        }\r\n    }\r\n\r\n    isUniverseUrl(url){\r\n        return (url.match(/universe.com/g) || url.match(/uniiverse.com/g) || url.match(/ticketmaster.com/g));\r\n    }\r\n\r\n    isAllowedTMEvent(url){\r\n        for (var t = [/(?:ticketmaster\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/, /(?:concerts\\.livenation\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/], n = null, r = 0; r < t.length && (n = url.match(t[r]), null === n); r++);\r\n        let id = (null !== n ? n[2] : void 0);\r\n        return (this.tmWidgetWhiteList.indexOf(id) > -1);\r\n    }\r\n\r\n    embedTMPlugin(){\r\n        let id = 'id_tm_widget';\r\n        if( !document.getElementById(id) ) {\r\n            let script = document.createElement('script');\r\n            script.setAttribute('src', this.portalUrl + 'scripts/vendors/tm.js');\r\n            script.setAttribute('type', 'text/javascript');\r\n            script.setAttribute('charset', 'UTF-8');\r\n            script.setAttribute('id', id);\r\n            (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\r\n        }\r\n        this.isTMPluginInitialized = true;\r\n    }\r\n\r\n    embedUniversePlugin(){\r\n        let id = 'id_universe_widget';\r\n        if( !document.getElementById(id) ){\r\n            let script = document.createElement('script');\r\n            script.setAttribute('src', 'https://www.universe.com/embed.js');\r\n            script.setAttribute('type', 'text/javascript');\r\n            script.setAttribute('charset', 'UTF-8');\r\n            script.setAttribute('id', id);\r\n            (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\r\n        }\r\n        this.isUniversePluginInitialized = true;\r\n    }\r\n\r\n    // Message\r\n    initMessage(){\r\n        this.messageDialog = document.createElement('div');\r\n        this.messageDialog.classList.add(\"event-message\");\r\n        this.messageContent = document.createElement('div');\r\n        this.messageContent.classList.add(\"event-message__content\");\r\n\r\n        let messageClose = document.createElement('div');\r\n        messageClose.classList.add(\"event-message__btn\");\r\n        messageClose.addEventListener(\"click\", ()=> {\r\n            this.hideMessage();\r\n        });\r\n\r\n        this.messageDialog.appendChild(this.messageContent);\r\n        this.messageDialog.appendChild(messageClose);\r\n        this.eventsRootContainer.appendChild(this.messageDialog);\r\n    }\r\n\r\n    showMessage(message, hideMessageWithoutDelay){\r\n        if(message.length){\r\n            this.hideMessageWithoutDelay = hideMessageWithoutDelay;\r\n            this.messageContent.innerHTML = message;\r\n            this.messageDialog.classList.add(\"event-message-visible\");\r\n            if (this.messageTimeout) {\r\n                clearTimeout(this.messageTimeout); // Clear timeout if before 'hideMessageWithDelay' was called\r\n            }\r\n        }\r\n    }\r\n\r\n    hideMessageWithDelay(delay){\r\n        if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout if this method was called before\r\n        this.messageTimeout = setTimeout(()=>{\r\n            this.hideMessage();\r\n        }, delay);\r\n    }\r\n\r\n    hideMessage(){\r\n        if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout and hide message immediately.\r\n        this.messageDialog.classList.remove(\"event-message-visible\");\r\n    }\r\n    // End message\r\n\r\n    useGeolocation() {\r\n        var widget = this;\r\n        var clickNearMe = function(e) {\r\n            if (navigator.geolocation) {\r\n                navigator.geolocation.getCurrentPosition(function (position) {\r\n                    var latitude = position.coords.latitude;\r\n                    var longitude = position.coords.longitude;\r\n                    e.target.parentNode.setAttribute('w-latlong', latitude + ',' + longitude);\r\n                    widget.update();\r\n                });\r\n\r\n            }\r\n        };\r\n\r\n        var buttons = document.getElementsByClassName(\"near-me-btn\");\r\n        for (var i = 0; i < buttons.length; i++) {\r\n            var current = buttons[i];\r\n            current.addEventListener('click', clickNearMe, false);\r\n            current.addEventListener('touchstart', clickNearMe, false);\r\n        }\r\n    }\r\n\r\n    AdditionalElements(){\r\n        var nearMeBtn = document.createElement(\"span\");\r\n        nearMeBtn.classList.add('near-me-btn');\r\n        if (this.widgetRoot.getAttribute(\"w-geoposition\") !== 'on') nearMeBtn.classList.add('dn');\r\n        nearMeBtn.setAttribute('title', 'Show events near me');\r\n        this.widgetRoot.appendChild(nearMeBtn);\r\n\r\n        var legalNoticeContent = document.createTextNode('Legal Notice'),\r\n            legalNotice = document.createElement(\"a\");\r\n        legalNotice.appendChild(legalNoticeContent);\r\n        legalNotice.classList.add(\"legal-notice\");\r\n        legalNotice.target = '_blank';\r\n        legalNotice.href = this.legalNoticeUrl;\r\n        this.widgetRoot.appendChild(legalNotice);\r\n\r\n        var logo = document.createElement('a');\r\n        logo.classList.add(\"event-logo\",\"centered-logo\");\r\n        logo.target = '_blank';\r\n        logo.href = this.logoUrl;\r\n        logo.innerHTML = 'Powered by ';\r\n\r\n        var logoBox = document.createElement('div');\r\n        logoBox.classList.add(\"event-logo-box\");\r\n        logoBox.appendChild(logo);\r\n        this.eventsRootContainer.appendChild(logoBox);\r\n\r\n        let question = document.createElement('span');\r\n        question.classList.add(\"event-question\");\r\n        question.target = '_blank';\r\n        question.href = this.questionUrl;\r\n        question.addEventListener('click', toolTipHandler);\r\n        this.eventsRootContainer.appendChild(question);\r\n\r\n        let toolTip = document.createElement('div'),\r\n            tooltipHtml = `\r\n              <div class=\"tooltip-inner\"> \r\n                <a href=\"${this.questionUrl}\" target = \"_blank\" >About widget</a>\r\n                <div class=\"place\">version: <b>${this.widgetVersion}</b></div>\r\n              </div>`;\r\n        toolTip.classList.add(\"tooltip-version\");\r\n        toolTip.classList.add(\"left\");\r\n        toolTip.innerHTML = tooltipHtml;\r\n        this.eventsRootContainer.appendChild(toolTip);\r\n\r\n        function toolTipHandler(e) {\r\n            e.preventDefault();\r\n            e.target.nextSibling.classList.toggle('show-tip');\r\n        }\r\n    }\r\n\r\n    formatDate(date) {\r\n        var result = '';\r\n        if(!date.day) return result; // Day is required\r\n\r\n        function LZ(x) {\r\n            return (x < 0 || x > 9 ? \"\" : \"0\") + x\r\n        }\r\n        var MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\r\n            DAY_NAMES = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\r\n            dayArray = date.day.split('-'),\r\n            d = parseInt(dayArray[2]),\r\n            M = parseInt(dayArray[1]);\r\n\r\n        // var E = new Date(date.day).getDay();\r\n        var E = new Date(+date.day.split('-')[0],(+date.day.split('-')[1])-1,+date.day.split('-')[2]).getDay();\r\n        result = DAY_NAMES[E] + ', ' + MONTH_NAMES[M - 1] + ' ' + d + ', ' + dayArray[0];\r\n\r\n        if(!date.time) return result;\r\n\r\n        var timeArray = date.time.split(':'),\r\n            H = parseInt(timeArray[0]),\r\n            m = timeArray[1],\r\n            a = \"AM\";\r\n\r\n        if (H > 11) a = \"PM\";\r\n        if (H == 0) {\r\n            H = 12;\r\n        } else if (H > 12) {\r\n            H = H - 12;\r\n        }\r\n\r\n        return result + ' ' + LZ(H) + ':' + m + ' ' + a;\r\n    }\r\n\r\n    clearEvents(){\r\n        this.eventsRoot.innerHTML = \"\";\r\n    }\r\n\r\n    clear(){\r\n        var modificatorList = this.widgetRoot.getElementsByClassName('modificator');\r\n        while (modificatorList.length) {\r\n            let el = modificatorList[0],\r\n                parent = el.parentNode;\r\n            parent.removeChild(el);\r\n        }\r\n        this.clearEvents();\r\n    }\r\n\r\n    update() {\r\n\r\n        let oldTheme = this.config.constructor();\r\n        for (let attr in this.config) {\r\n            if (this.config.hasOwnProperty(attr)) oldTheme[attr] = this.config[attr];\r\n        }\r\n\r\n        this.config = this.widgetRoot.attributes;\r\n\r\n        this.widgetRoot.style.height = `${this.widgetHeight}px`;\r\n        this.widgetRoot.style.width  = `${this.config.width}px`;\r\n        this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\r\n        this.eventsRootContainer.style.width  = `${this.config.width}px`;\r\n        this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\r\n        this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\r\n\r\n        this.eventsRootContainer.classList.remove(\"border\");\r\n        if( this.config.hasOwnProperty(\"border\") ){\r\n            this.eventsRootContainer.classList.add(\"border\");\r\n        }\r\n\r\n        this.clear();\r\n        this.getCoordinates(() => {\r\n            this.makeRequest( this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs );\r\n        });\r\n\r\n        let events = this.eventsRoot.getElementsByClassName(\"event-wrapper\");\r\n        for (let i in events) {\r\n            if (events.hasOwnProperty(i) && events[i].style !== undefined) {\r\n                events[i].style.width = `${this.config.width - this.borderSize * 2}px`;\r\n                events[i].style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n            }\r\n        }\r\n        this.useGeolocation();\r\n\r\n    }\r\n\r\n    needToUpdate(newTheme, oldTheme, forCheck = []){\r\n        return Object.keys(newTheme).map(function(key){\r\n                if(forCheck.indexOf(key) > -1) return true;\r\n                //console.warn([key, newTheme[key], oldTheme[key], newTheme[key] === oldTheme[key]])\r\n                return newTheme[key] === oldTheme[key] ;\r\n            }).indexOf(false) > -1\r\n    }\r\n\r\n    loadConfig(NamedNodeMap){\r\n        var config = {};\r\n        Object.keys(NamedNodeMap).map(function(value){\r\n            if( typeof(NamedNodeMap[value].name) !== \"undefined\" && NamedNodeMap[value].name.indexOf(\"w-\") !== -1){\r\n                config[ NamedNodeMap[value].name.replace(/w-/g, \"\").replace(/-/g, \"\") ] = NamedNodeMap[value].value;\r\n            }\r\n        });\r\n        return config;\r\n    }\r\n\r\n    styleLoadingHandler(){\r\n        if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n            if(this.status == 200){\r\n                var style = document.createElement(\"style\");\r\n                style.setAttribute(\"type\",\"text/css\");\r\n                style.setAttribute(\"id\",`widget-theme-${this.widget.config.theme}`);\r\n                style.textContent = this.responseText;\r\n                document.getElementsByTagName(\"head\")[0].appendChild(style);\r\n            }\r\n            else {\r\n                //alert(\"theme wasn't loaded\");\r\n                console.log(\"theme wasn't loaded\");\r\n            }\r\n        }\r\n    }\r\n\r\n    groupEventsByName(){\r\n        let groups = {};\r\n        this.events.map(function(event){\r\n            if (groups[event.name] === undefined) groups[event.name] = [];\r\n            groups[event.name].push(event);\r\n        });\r\n\r\n        this.eventsGroups = [];\r\n        for (let groupName in groups) {\r\n            this.eventsGroups.push(groups[groupName]);\r\n        }\r\n    }\r\n\r\n    resetReduceParamsOrder(){\r\n        this.reduceParamsOrder = 0;\r\n    }\r\n\r\n    reduceParamsAndReloadEvents(){\r\n        let eventReqAttrs = {},\r\n            reduceParamsList = [\r\n                ['classificationName'],\r\n                ['city'],\r\n                ['countryCode'],\r\n                ['source'],\r\n                ['startDateTime', 'endDateTime', 'country'],\r\n                ['radius'],\r\n                ['postalCode', 'latlong'],\r\n                ['attractionId'],\r\n                ['promoterId'],\r\n                // ['segmentId'],\r\n                ['venueId'],\r\n                ['keyword'],\r\n                ['size']\r\n            ];\r\n\r\n        // make copy of params\r\n        for(let key in this.eventReqAttrs){\r\n            eventReqAttrs[key] = this.eventReqAttrs[key]\r\n        }\r\n\r\n        if(!this.reduceParamsOrder) this.reduceParamsOrder = 0;\r\n        if(reduceParamsList.length > this.reduceParamsOrder){\r\n            for(let item in reduceParamsList){\r\n                if(this.reduceParamsOrder >= item){\r\n                    for(let i in reduceParamsList[item]){\r\n                        delete eventReqAttrs[reduceParamsList[item][i]];\r\n                    }\r\n                }\r\n            }\r\n\r\n            if(this.reduceParamsOrder === 0) this.showMessage(\"No results were found.<br/>Here other options for you.\");\r\n            this.reduceParamsOrder++;\r\n            this.makeRequest( this.eventsLoadingHandler, this.apiUrl, eventReqAttrs );\r\n        }else{\r\n            // We haven't any results\r\n            this.showMessage(\"No results were found.\", true);\r\n            this.reduceParamsOrder = 0;\r\n        }\r\n    }\r\n\r\n    setMarkers(map, markers) {\r\n\r\n        var infowindow = new google.maps.InfoWindow({\r\n            content: \" \",\r\n        });\r\n\r\n        var image = {\r\n            url: 'https://ticketmaster-api-staging.github.io/assets/widgets/1.0.0/img/marker.svg',\r\n            size: new google.maps.Size(22, 32),\r\n            origin: new google.maps.Point(0, 0),\r\n            anchor: new google.maps.Point(22, 32)\r\n        };\r\n\r\n        var imageActive = {\r\n            url: 'https://ticketmaster-api-staging.github.io/assets/widgets/1.0.0/img/marker-active.svg',\r\n            size: new google.maps.Size(22, 32),\r\n            origin: new google.maps.Point(0, 0),\r\n            anchor: new google.maps.Point(22, 32)\r\n        };\r\n\r\n        for (var i = 0; i < markers.length; i++) {\r\n            let sites = markers[i];\r\n            if (sites !== undefined) {\r\n                var siteLatLng = new google.maps.LatLng(sites[1], sites[2]);\r\n                var marker = new google.maps.Marker({\r\n                    position: siteLatLng,\r\n                    map: map,\r\n                    icon: image,\r\n                    title: sites[0],\r\n                    zIndex: sites[3],\r\n                    html: sites[4]\r\n                });\r\n            }\r\n            google.maps.event.addListener(marker, \"click\", function () {\r\n                infowindow.setContent(this.html);\r\n                infowindow.open(map, this);\r\n            });\r\n            google.maps.event.addListener(marker, 'mouseover', function() {\r\n                this.setIcon(imageActive);\r\n            });\r\n            google.maps.event.addListener(marker, 'mouseout', function() {\r\n                this.setIcon(image);\r\n            });\r\n        }\r\n    }\r\n\r\n    eventsLoadingHandler(){\r\n        let widget = this.widget;\r\n        var markers = [];\r\n        widget.clearEvents(); // Additional clearing after each loading\r\n        if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n            if(this.status == 200){\r\n                widget.events = JSON.parse(this.responseText);\r\n                if(widget.events.length){\r\n\r\n                    var myLatLng = {lat: 34.0390107, lng: -118.2672801};\r\n\r\n                    var map = new google.maps.Map(document.getElementById('map'), {\r\n                        zoom: 4,\r\n                        center: myLatLng,\r\n                        mapTypeId: google.maps.MapTypeId.ROADMAP,\r\n                        mapTypeControl: false,\r\n                        panControl: false,\r\n                        streetViewControl: false,\r\n                        zoomControlOptions: {\r\n                            position: google.maps.ControlPosition.RIGHT_CENTER\r\n                        },\r\n                    });\r\n\r\n                    var latlngbounds = new google.maps.LatLngBounds();\r\n\r\n                    widget.groupEventsByName.call(widget);\r\n\r\n                    for (let e=0; e < widget.events.length; e++) {\r\n\r\n                        if (widget.events[e].location !== undefined) {\r\n                            let place = '';\r\n                            let address = '';\r\n                            let date = widget.formatDate({\r\n                                day: widget.events[e].date.day,\r\n                                time: widget.events[e].date.time\r\n                            });\r\n                            if (widget.events[e].address.hasOwnProperty('name')) {\r\n                                place = widget.events[e].address.name + ', ';\r\n                            }\r\n                            else {\r\n                                place = '';\r\n                            }\r\n                            if (widget.events[e].address.hasOwnProperty('line1')) {\r\n                                address = widget.events[e].address.line1;\r\n                            } else {\r\n                                address = '';\r\n                            }\r\n\r\n                            let buyBtn = '';\r\n                            if (widget.isUniverseUrl(widget.events[e].url) != false) buyBtn = '<a class=\"buybtn\" href=\"' + widget.events[e].url + '\">BUY NOW</a>';\r\n\r\n                            markers[e] = [\r\n                                widget.events[e].name,\r\n                                widget.events[e].location.lat,\r\n                                widget.events[e].location.lng,\r\n                                e,\r\n                                '<div class=\"infowindow\" style=\"width:220px!important;padding-right:5px!important;line-height:normal;overflow:auto;\"><a class=\"an\" href=\"' + widget.events[e].url + '\"><span class=\"img\" style=\"background:url(' + widget.events[e].img + ') center center no-repeat\"></span><span class=\"name\">' + widget.events[e].name + '</span></a>' + buyBtn + '<div class=\"dateplace\"><span class=\"date\">' + date + '</span><span class=\"place\">' + place + address + '</span></div></div>'\r\n                            ];\r\n                            latlngbounds.extend(new google.maps.LatLng(widget.events[e].location.lat, widget.events[e].location.lng));\r\n                        }\r\n                    }\r\n                    map.fitBounds( latlngbounds );\r\n\r\n                    widget.setMarkers(map ,markers);\r\n\r\n\r\n                    widget.resetReduceParamsOrder();\r\n                    if(widget.hideMessageWithoutDelay)\r\n                        widget.hideMessage();\r\n                    else\r\n                        widget.hideMessageWithDelay(widget.hideMessageDelay);\r\n                }else{\r\n                    widget.reduceParamsAndReloadEvents.call(widget);\r\n                }\r\n            }\r\n            else if(this.status == 400) {\r\n                widget.reduceParamsAndReloadEvents.call(widget);\r\n                console.log('There was an error 400');\r\n            }\r\n            else {\r\n                widget.reduceParamsAndReloadEvents.call(widget);\r\n                console.log('something else other than 200 was returned');\r\n            }\r\n        }\r\n    }\r\n\r\n    publishEventsGroup(group, index){\r\n         let groupNodeWrapper = document.createElement(\"li\");\r\n         groupNodeWrapper.classList.add(\"event-wrapper\");\r\n         groupNodeWrapper.classList.add(\"event-group-wrapper\");\r\n         groupNodeWrapper.style.width  = `${this.config.width - this.borderSize * 2}px`;\r\n         groupNodeWrapper.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n\r\n         let groupNode = document.createElement(\"ul\");\r\n         groupNode.classList.add(\"event-group\");\r\n         groupNode.classList.add(\"event-group-\" + index);\r\n\r\n         group.map((event)=> {\r\n         this.publishEvent(event, groupNode)\r\n         });\r\n\r\n         groupNodeWrapper.appendChild(groupNode);\r\n         this.eventsRoot.appendChild(groupNodeWrapper);\r\n    }\r\n\r\n    publishEvent(event, parentNode){\r\n         parentNode = parentNode || this.eventsRoot;\r\n         let DOMElement = this.createDOMItem(event);\r\n         parentNode.appendChild(DOMElement);\r\n    }\r\n\r\n    getEventByID(id){\r\n        for(let index in this.events){\r\n            if(this.events.hasOwnProperty(index) && this.events[index].id === id){\r\n                return this.events[index]\r\n            }\r\n        }\r\n    }\r\n\r\n    getImageForEvent(images){\r\n        let imgWidth;\r\n        let idx;\r\n        images.forEach(function (img, i) {\r\n            if (i == 0) imgWidth = img.width;\r\n            if (imgWidth > img.width) {\r\n                imgWidth = img.width;\r\n                idx = i;\r\n            }\r\n        });\r\n        return (idx === undefined) ? '' : images[idx].url;\r\n    }\r\n\r\n    parseEvents(eventsSet){\r\n        if(!eventsSet._embedded){\r\n            if(typeof($widgetModalNoCode) !== \"undefined\"){\r\n                $widgetModalNoCode.modal();\r\n            }\r\n            return [];\r\n        }\r\n        eventsSet = eventsSet._embedded.events;\r\n        var tmpEventSet = [];\r\n\r\n        for(var key in eventsSet){\r\n            if(eventsSet.hasOwnProperty(key)){\r\n                let currentEvent = {};\r\n\r\n                currentEvent.id = eventsSet[key].id;\r\n                currentEvent.url = eventsSet[key].url;\r\n                currentEvent.name = eventsSet[key].name;\r\n\r\n                /* Change URL [START] */\r\n                var parser = document.createElement(\"a\");\r\n                parser.href = currentEvent.url;\r\n                var expr= \"/ticketmaster.evyy.net/\";\r\n                if (parser.href.match(expr) !== null) {\r\n                    var changeURL = parser.pathname.split('/');\r\n                    changeURL[3] = '330564';\r\n                    currentEvent.url = parser.origin + changeURL.join('/') + parser.search + parser.hash;\r\n                }\r\n                /* Change URL [END] */\r\n\r\n                currentEvent.date = {\r\n                    day: eventsSet[key].dates.start.localDate,\r\n                    time: eventsSet[key].dates.start.localTime\r\n                };\r\n\r\n                if(eventsSet[key].hasOwnProperty('_embedded') && eventsSet[key]._embedded.hasOwnProperty('venues')){\r\n                    let venue = eventsSet[key]._embedded.venues[0];\r\n                    if(venue){\r\n                        if(venue.address)\r\n                            currentEvent.address = venue.address;\r\n\r\n                        if(venue.name) {\r\n                            if(!currentEvent.address) currentEvent.address = {};\r\n                            currentEvent.address.name = venue.name;\r\n                        }\r\n\r\n                        if (venue.location) {\r\n                            currentEvent.location = {\r\n                                lat: parseFloat(venue.location.latitude),\r\n                                lng: parseFloat(venue.location.longitude)\r\n                            };\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Remove this comment to get categories\r\n                /*if(eventsSet[key]._embedded.hasOwnProperty('categories')){\r\n                 currentEvent.categories = [];\r\n                 let eventCategories = eventsSet[key]._embedded.categories;\r\n                 currentEvent.categories = Object.keys(eventCategories).map(function(category){\r\n                 return eventCategories[category].name\r\n                 });\r\n                 }*/\r\n\r\n                currentEvent.img = this.getImageForEvent(eventsSet[key].images);\r\n                tmpEventSet.push(currentEvent);\r\n\r\n            }\r\n        }\r\n        return tmpEventSet;\r\n    }\r\n\r\n    makeRequest(handler, url=this.apiUrl, attrs={}, method=\"GET\"){\r\n        attrs = Object.keys(attrs).map(function(key){\r\n            return `${key}=${attrs[key]}`;\r\n        }).join(\"&\");\r\n\r\n        url = [url,attrs].join(\"?\");\r\n\r\n        this.xmlHTTP = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n        if(method == \"POST\") {\r\n            this.xmlHTTP.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\r\n        }\r\n        this.xmlHTTP.widget = this;\r\n        this.xmlHTTP.onreadystatechange = handler;\r\n        this.xmlHTTP.open(method, url, true);\r\n        this.xmlHTTP.send();\r\n    }\r\n\r\n    initPretendedLink(el, url, isBlank){\r\n        if(el && url){\r\n            el.setAttribute('data-url', url);\r\n            el.classList.add(\"event-pretended-link\");\r\n            el.addEventListener('click', function(){\r\n                let url = this.getAttribute('data-url');\r\n                if(url){\r\n                    let win = window.open(url, (isBlank ? '_blank' : '_self'));\r\n                    win.focus();\r\n                }\r\n            });\r\n            el.addEventListener('touchstart', function(){\r\n                let url = this.getAttribute('data-url');\r\n                if(url){\r\n                    let win = window.open(url, (isBlank ? '_blank' : '_self'));\r\n                    win.focus();\r\n                }\r\n            });\r\n        }\r\n        return el;\r\n    }\r\n\r\n    createBackgroundImage(event, img) {\r\n        if (!this.isListView) {\r\n            var image = document.createElement(\"span\");\r\n            image.classList.add(\"bg-cover\");\r\n            image.style.backgroundImage = `url('${img}')`;\r\n            event.appendChild(image);\r\n        }\r\n    }\r\n\r\n    addBuyButton(domNode, url) {\r\n        if (this.isListView) {\r\n            let _urlValid = ( this.isUniversePluginInitialized && this.isUniverseUrl(url) ) || ( this.isTMPluginInitialized && this.isAllowedTMEvent(url) );\r\n            if(!_urlValid) url = '';\r\n            let buyBtn = document.createElement(\"a\");\r\n            buyBtn.appendChild(document.createTextNode('BUY NOW'));\r\n            buyBtn.classList.add(\"event-buy-btn\");\r\n            buyBtn.target = '_blank';\r\n            buyBtn.href = url;\r\n            buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\r\n            domNode.appendChild(buyBtn);\r\n        }\r\n    }\r\n\r\n    createDOMItem(itemConfig){\r\n        var medWrapper = document.createElement(\"div\");\r\n        medWrapper.classList.add(\"event-content-wraper\");\r\n\r\n        var event = document.createElement(\"li\");\r\n        event.classList.add(\"event-wrapper\");\r\n        event.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n        event.style.width  = `${this.config.width - this.borderSize * 2}px`;\r\n\r\n        this.createBackgroundImage(event, itemConfig.img);\r\n\r\n        var nameContent = document.createTextNode(itemConfig.name),\r\n            name =  document.createElement(\"span\");\r\n        name.classList.add(\"event-name\");\r\n        name.appendChild(nameContent);\r\n        this.initPretendedLink(name, itemConfig.url, true);\r\n        name.setAttribute('onclick', `ga('send', 'event', 'DiscoveryClickeventName_theme=${this.config.theme}_width=${this.config.width}_height=${this.config.height}_color_scheme=${this.config.colorscheme}', 'click', '${itemConfig.url}');`);\r\n        /* name.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickeventName', 'click', '\" + itemConfig.url + \"');\"); */\r\n        medWrapper.appendChild(name);\r\n\r\n\r\n        this.addBuyButton(medWrapper, itemConfig.url);\r\n\r\n        var dateTimeContent = document.createTextNode(this.formatDate(itemConfig.date)),\r\n            dateTime = document.createElement(\"span\");\r\n        dateTime.classList.add(\"event-date\", \"centered-logo\");\r\n        dateTime.appendChild(dateTimeContent);\r\n\r\n        var dateWraper = document.createElement(\"span\");\r\n        dateWraper.classList.add(\"event-date-wraper\");\r\n        dateWraper.appendChild(dateTime);\r\n        medWrapper.appendChild(dateWraper);\r\n\r\n        if(itemConfig.hasOwnProperty(\"address\")){\r\n            var addressWrapper = document.createElement(\"span\");\r\n            addressWrapper.classList.add(\"address-wrapper\");\r\n\r\n            if( itemConfig.address.hasOwnProperty(\"name\") ){\r\n                var addressNameText = document.createTextNode(itemConfig.address.name),\r\n                    addressName =  document.createElement(\"span\");\r\n                addressName.classList.add(\"event-address\");\r\n                addressName.classList.add(\"event-address-name\");\r\n                addressName.appendChild(addressNameText);\r\n                addressWrapper.appendChild(addressName);\r\n            }\r\n\r\n            if( itemConfig.address.hasOwnProperty(\"line1\") ){\r\n                var addressOneText = document.createTextNode(itemConfig.address.line1),\r\n                    addressOne =  document.createElement(\"span\");\r\n                addressOne.classList.add(\"event-address\");\r\n                addressOne.appendChild(addressOneText);\r\n                addressWrapper.appendChild(addressOne);\r\n            }\r\n\r\n            if( itemConfig.address.hasOwnProperty(\"line2\") ){\r\n                var addressTwoText = document.createTextNode(itemConfig.address.line2),\r\n                    addressTwo =  document.createElement(\"span\");\r\n                addressTwo.classList.add(\"event-address\");\r\n                addressTwo.appendChild(addressTwoText);\r\n                addressWrapper.appendChild(addressTwo);\r\n            }\r\n\r\n            medWrapper.appendChild(addressWrapper);\r\n        }\r\n\r\n        if(itemConfig.hasOwnProperty(\"categories\")) {\r\n            var categoriesWrapper = document.createElement(\"span\");\r\n            categoriesWrapper.classList.add(\"category-wrapper\");\r\n\r\n            itemConfig.categories.forEach(function (element) {\r\n                var categoryText = document.createTextNode(element),\r\n                    category = document.createElement(\"span\");\r\n                category.classList.add(\"event-category\");\r\n                category.appendChild(categoryText);\r\n                categoriesWrapper.appendChild(category);\r\n            });\r\n            medWrapper.appendChild(categoriesWrapper);\r\n        }\r\n\r\n        event.appendChild(medWrapper);\r\n\r\n        return event;\r\n    }\r\n\r\n    makeImageUrl(id){\r\n        return `https://app.ticketmaster.com/discovery/v2/events/${id}/images.json`;\r\n    }\r\n\r\n\r\n    /*\r\n     * Config block\r\n     */\r\n\r\n    decConfig(config){\r\n        return JSON.parse(window.atob(config));\r\n    }\r\n\r\n    encConfig(config){\r\n        return window.btoa(config);\r\n    }\r\n\r\n    toShortISOString(dateObj){\r\n        return dateObj.getFullYear() +\r\n            \"-\" + (dateObj.getMonth() + 1 < 10 ? \"0\"+ (dateObj.getMonth()+ 1): dateObj.getMonth() + 1) +\r\n            \"-\" + (dateObj.getDate() < 10 ? \"0\"+ dateObj.getDate(): dateObj.getDate()) +\r\n            \"T\" + (dateObj.getHours() < 10 ? \"0\"+dateObj.getHours(): dateObj.getHours()) +\r\n            \":\" + (dateObj.getMinutes() < 10 ? \"0\"+dateObj.getMinutes(): dateObj.getMinutes()) +\r\n            \":\" + (dateObj.getSeconds() < 10 ? \"0\"+dateObj.getSeconds(): dateObj.getSeconds()) +\r\n            \"Z\";\r\n    }\r\n\r\n    getDateFromPeriod(period){\r\n\r\n        var period = period.toLowerCase(),\r\n            firstDay, lastDay;\r\n\r\n        if(period == \"year\" ) {\r\n            // firstDay = new Date( new Date(new Date()).toISOString() );\r\n            // lastDay = new Date( new Date(new Date().valueOf()+24*365*60*60*1000).toISOString() );\r\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\r\n            lastDay = new Date(new Date().valueOf()+24*365*60*60*1000).toISOString().slice(0,19) + 'Z';\r\n        }\r\n        else if(period == \"month\") {\r\n            // firstDay = new Date( new Date(new Date()).toISOString() );\r\n            // lastDay = new Date( new Date(new Date().valueOf()+24*31*60*60*1000).toISOString() );\r\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\r\n            lastDay = new Date(new Date().valueOf()+24*31*60*60*1000).toISOString().slice(0,19) + 'Z';\r\n        }\r\n        else if(period == \"week\") {\r\n            // firstDay = new Date( new Date(new Date()).toISOString() );\r\n            // lastDay = new Date( new Date(new Date().valueOf()+24*7*60*60*1000).toISOString() );\r\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\r\n            lastDay = new Date(new Date().valueOf()+24*7*60*60*1000).toISOString().slice(0,19) + 'Z';\r\n        } else {\r\n            // firstDay = new Date( new Date(new Date()).toISOString() );\r\n            // lastDay = new Date( new Date(new Date().valueOf()+24*60*60*1000).toISOString() );\r\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\r\n            lastDay = new Date(new Date().valueOf()+24*60*60*1000).toISOString().slice(0,19) + 'Z';\r\n        }\r\n\r\n        // return [this.toShortISOString(firstDay), this.toShortISOString(lastDay)];\r\n        return [firstDay, lastDay];\r\n    }\r\n\r\n}\r\nlet widgetsMap = [];\r\n(function () {\r\n    let widgetContainers = document.querySelectorAll(\"div[w-type='map']\");\r\n    for (let i = 0; i < widgetContainers.length; ++i) {\r\n        widgetsMap.push(new TicketmasterMapWidget(widgetContainers[i]));\r\n    }\r\n\r\n})();\r\n\r\n(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\r\n        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\r\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\r\n})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\r\n\r\nga('create', 'UA-78315612-1', 'auto');\r\nga('send', 'pageview');\r\n"]}