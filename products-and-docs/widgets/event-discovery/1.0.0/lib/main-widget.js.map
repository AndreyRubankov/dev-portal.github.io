{"version":3,"sources":["../src/main-widget.es6"],"names":["TicketmasterEventDiscoveryWidget","attr","config","hasOwnProperty","attrs","widgetConfig","loadConfig","responce","eventsList","parseEvents","theme","proportion","border","height","widgetHeight","isListView","isSimpleProportionM","window","location","host","params","verboseName","i","item","isConfigAttrExistAndNotEmpty","latlong","postalCode","postalcode","period","getDateFromPeriod","startDateTime","endDateTime","root","widgetRoot","eventsRootContainer","document","createElement","classList","add","appendChild","eventsRootDiv","setAttribute","eventsRoot","themeModificators","oldSchoolModificator","bind","newSchoolModificator","listViewModificator","attributes","getElementById","makeRequest","styleLoadingHandler","themeUrl","remove","style","width","widgetContentHeight","borderRadius","borderradius","borderWidth","borderSize","AdditionalElements","getCoordinates","eventsLoadingHandler","apiUrl","eventReqAttrs","embedUniversePlugin","embedTMPlugin","initBuyBtn","initMessage","initSliderControls","initEventCounter","addScroll","cb","widget","parseGoogleGeocodeResponse","readyState","XMLHttpRequest","DONE","results","countryShortName","status","response","JSON","parse","responseText","length","filter","countriesWhiteList","elem","address_components","long_name","sort","f","g","a","b","geometry","short_name","country","result","lat","lng","onLoadCoordinate","args","language","components","googleapikey","key","geocodeUrl","buyBtn","createTextNode","target","href","addEventListener","e","preventDefault","stopAutoSlideX","url","isAddressCenter","el","querySelector","querySelectorAll","event","eventsGroups","currentSlideX","currentSlideY","isUniversePluginInitialized","isUniverseUrl","isTMPluginInitialized","isAllowedTMEvent","updateTransition","match","t","n","r","id","tmWidgetWhiteList","indexOf","script","portalUrl","head","getElementsByTagName","messageDialog","messageContent","messageClose","hideMessage","message","hideMessageWithoutDelay","innerHTML","messageTimeout","clearTimeout","delay","setTimeout","legalNoticeContent","legalNotice","legalNoticeUrl","logo","logoUrl","logoBox","question","questionUrl","generalAdmissionWrapper","generalAdmission","generalAdmissionText","ticketLogo","headLogo","prevEventX","controlHiddenClass","nextEventX","prevEventY","nextEventY","slideCountX","setSlideManually","slideIndex","isDirectionX","sliderTimeout","runAutoSlideX","sliderRestartDelay","goToSlideX","goToSlideY","marginLeft","toggleControlsVisibility","setEventsCounter","setBuyBtnUrl","eventGroup","getElementsByClassName","marginTop","sliderInterval","setInterval","sliderDelay","clearInterval","coreCssClass","prevEventXClass","nextEventXClass","prevEventYClass","nextEventYClass","whichTransitionEvent","transitions","undefined","transitionEvent","prevSlideX","nextSlideX","prevSlideY","nextSlideY","xDown","yDown","handleTouchStart","evt","touches","clientX","clientY","handleTouchMove","xUp","yUp","xDiff","yDiff","Math","abs","className","call","date","day","LZ","x","MONTH_NAMES","DAY_NAMES","dayArray","split","d","parseInt","M","E","Date","getDay","time","timeArray","H","m","modificatorList","parent","parentNode","removeChild","ss","ssDiv","clearEvents","oldTheme","constructor","needToUpdate","updateExceptions","clear","events","newTheme","forCheck","Object","keys","map","NamedNodeMap","value","name","replace","textContent","console","log","groups","push","groupName","eventsCounter","text","reduceParamsOrder","reduceParamsList","showMessage","hideSliderControls","groupEventsByName","group","publishEvent","publishEventsGroup","initSlider","resetReduceParamsOrder","hideMessageWithDelay","hideMessageDelay","reduceParamsAndReloadEvents","index","groupNodeWrapper","groupNode","DOMElement","createDOMItem","images","myImg","forEach","element","eventsSet","_embedded","$widgetModalNoCode","modal","tmpEventSet","currentEvent","dates","start","localDate","localTime","venue","venues","address","img","getImageForEvent","handler","method","join","xmlHTTP","ActiveXObject","setRequestHeader","onreadystatechange","open","send","isBlank","getAttribute","win","focus","image","backgroundImage","domNode","isBarcodeWidget","barcodeBtn","bottomBg","_urlValid","u","defineProperty","SimpleScrollbar","pageY","scrollTop","scrollRatio","body","removeEventListener","bar","wrapper","firstChild","insertAdjacentHTML","lastChild","moveBar","requestAnimationFrame","setImmediate","prototype","scrollHeight","clientHeight","cssText","clientWidth","initEl","initAll","scrollRoot","itemConfig","medWrapper","createBackgroundImage","nameContent","initPretendedLink","colorscheme","addBarcode","addBuyButton","dateTimeContent","formatDate","dateTime","dateWraper","addressWrapper","addressNameText","addressName","addressOneText","line1","addressOne","addressTwoText","line2","addressTwo","categoriesWrapper","categories","categoryText","category","atob","btoa","dateObj","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","toLowerCase","firstDay","lastDay","toISOString","valueOf","toShortISOString","widgetsEventDiscovery","widgetContainers","s","o","q","arguments","l","async","src","insertBefore","ga"],"mappings":"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","file":"main-widget.js","sourcesContent":["class TicketmasterEventDiscoveryWidget {\r\n\r\n  set config(attrs) { this.widgetConfig = this.loadConfig(attrs); }\r\n  get config() { return this.widgetConfig; }\r\n\r\n  set events(responce){ this.eventsList = this.parseEvents(responce);}\r\n  get events(){ return this.eventsList;}\r\n\r\n  get isListView() { return this.config.theme === 'listview';}\r\n  get isBarcodeWidget() { return (this.config.theme === 'oldschool' || this.config.theme === 'newschool');}\r\n  get isSimpleProportionM() { return this.config.proportion === 'm'}\r\n  get borderSize(){ return this.config.border || 0;}\r\n  get widgetHeight(){ return this.config.height || 600;}\r\n\r\n  get widgetContentHeight() {\r\n    return this.widgetHeight - (this.isListView || this.isSimpleProportionM ? 0 : 39) || 600;\r\n  }\r\n\r\n  get eventUrl(){ return \"https://www.ticketmaster.com/event/\"; }\r\n\r\n  get apiUrl(){ return \"https://app.ticketmaster.com/discovery/v2/events.json\"; }\r\n\r\n  get themeUrl() {\r\n    return (window.location.host === 'developer.ticketmaster.com')\r\n      ? `https://developer.ticketmaster.com/products-and-docs/widgets/event-discovery/1.0.0/theme/`\r\n      : `https://ticketmaster-api-staging.github.io/products-and-docs/widgets/event-discovery/1.0.0/theme/`;\r\n  }\r\n\r\n  get portalUrl(){\r\n    return (window.location.host === 'developer.ticketmaster.com')\r\n      ? `https://developer.ticketmaster.com/`\r\n      : `https://ticketmaster-api-staging.github.io/`;\r\n  }\r\n\r\n  get logoUrl() { return \"https://www.ticketmaster.com/\"; }\r\n\r\n  get legalNoticeUrl() { return \"http://developer.ticketmaster.com/support/terms-of-use/\"; }\r\n\r\n  get questionUrl() { return \"http://developer.ticketmaster.com/support/faq/\"; }\r\n\r\n  get geocodeUrl() { return \"https://maps.googleapis.com/maps/api/geocode/json\"; }\r\n\r\n  get updateExceptions() { return [\"width\", \"height\", \"border\", \"borderradius\", \"colorscheme\", \"layout\", \"affiliateid\", \"propotion\", \"googleapikey\"]}\r\n\r\n  get sliderDelay(){ return 5000; }\r\n\r\n  get sliderRestartDelay(){ return 5000; }\r\n\r\n  get hideMessageDelay(){ return 5000; }\r\n\r\n  get controlHiddenClass(){ return \"events_control-hidden\"; }\r\n\r\n  get tmWidgetWhiteList(){ return [\"2200504BAD4C848F\", \"00005044BDC83AE6\", \"1B005068DB60687F\", \"1B004F4DBEE45E47\", \"3A004F4ED7829D5E\", \"3A004F4ED1FC9B63\", \"1B004F4FF83289C5\", \"1B004F4FC0276888\", \"0E004F4F3B7DC543\", \"1D004F4F09C61861\", \"1600505AC9A972A1\", \"22004F4FD82795C6\", \"01005057AFF54574\", \"01005056FAD8793A\", \"3A004F4FB2453240\", \"22004F50D2149AC6\", \"01005059AD49507A\", \"01005062B4236D5D\"]; }\r\n\r\n  get countriesWhiteList() {\r\n    return [\r\n      'Australia',\r\n      'Austria',\r\n      'Belgium',\r\n      'Canada',\r\n      'Denmark',\r\n      'Finland',\r\n      'France',\r\n      'Germany',\r\n      'Ireland',\r\n      'Mexico',\r\n      'Netherlands',\r\n      'New Zealand',\r\n      'Norway',\r\n      'Spain',\r\n      'Sweden',\r\n      'Turkey',\r\n      'UAE',\r\n      'United Kingdom',\r\n      'United States'\r\n    ]\r\n  }\r\n\r\n  isConfigAttrExistAndNotEmpty(attr) {\r\n    if( !this.config.hasOwnProperty(attr) || this.config[attr] === \"undefined\"){\r\n      return false;\r\n    }else if( this.config[attr] === \"\"){\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  \r\n  get eventReqAttrs(){\r\n    let attrs = {},\r\n    params = [\r\n      {\r\n        attr: 'tmapikey',\r\n        verboseName: 'apikey'\r\n      },\r\n      {\r\n        attr: 'keyword',\r\n        verboseName: 'keyword'\r\n      },\r\n      {\r\n        attr: 'size',\r\n        verboseName: 'size'\r\n      },\r\n      {\r\n        attr: 'radius',\r\n        verboseName: 'radius'\r\n      },\r\n      {\r\n        attr: 'attractionid',\r\n        verboseName: 'attractionId'\r\n      },\r\n      {\r\n        attr: 'promoterid',\r\n        verboseName: 'promoterId'\r\n      },\r\n      {\r\n        attr: 'venueid',\r\n        verboseName: 'venueId'\r\n      },\r\n      {\r\n        attr: 'classificationname',\r\n        verboseName: 'classificationName'\r\n      },\r\n      {\r\n        attr: 'city',\r\n        verboseName: 'city'\r\n      },\r\n      {\r\n        attr: 'countrycode',\r\n        verboseName: 'countryCode'\r\n      },\r\n      {\r\n        attr: 'source',\r\n        verboseName: 'source'\r\n      }\r\n    ];\r\n\r\n    for(let i in params){\r\n      let item = params[i];\r\n      if(this.isConfigAttrExistAndNotEmpty(item.attr))\r\n        attrs[item.verboseName] = this.config[item.attr];\r\n    }\r\n\r\n    // Only one allowed at the same time\r\n    if(this.config.latlong){\r\n      attrs.latlong = this.config.latlong;\r\n    }else{\r\n      if(this.isConfigAttrExistAndNotEmpty(\"postalcode\"))\r\n        attrs.postalCode = this.config.postalcode;\r\n    }\r\n\r\n    if(this.isConfigAttrExistAndNotEmpty(\"period\")){\r\n      let period = this.getDateFromPeriod(this.config.period);\r\n      attrs.startDateTime = period[0];\r\n      attrs.endDateTime = period[1];\r\n    }\r\n\r\n    return attrs;\r\n  }\r\n\r\n  constructor(root) {\r\n    if(!root) return;\r\n    this.widgetRoot = root;\r\n\r\n    this.eventsRootContainer = document.createElement(\"div\");\r\n    this.eventsRootContainer.classList.add(\"events-root-container\");\r\n    this.widgetRoot.appendChild(this.eventsRootContainer);\r\n\r\n    this.eventsRootDiv = document.createElement(\"div\");\r\n    this.eventsRootDiv.setAttribute(\"class\", \"ss\");\r\n    this.eventsRootDiv.setAttribute(\"ss-container\", \"\");\r\n    this.eventsRootContainer.appendChild(this.eventsRootDiv);\r\n\r\n    this.eventsRoot = document.createElement(\"ul\");\r\n    this.eventsRoot.classList.add(\"events-root\");\r\n    this.eventsRootDiv.appendChild(this.eventsRoot);\r\n\r\n    // Set theme modificators\r\n    this.themeModificators = {\r\n      \"oldschool\" : this.oldSchoolModificator.bind(this),\r\n      \"newschool\" : this.newSchoolModificator.bind(this),\r\n      \"listview\" : this.listViewModificator.bind(this)\r\n    };\r\n\r\n    this.config = this.widgetRoot.attributes;\r\n\r\n    if(this.config.theme !== null && !document.getElementById(`widget-theme-${this.config.theme}`)){\r\n      this.makeRequest( this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\" );\r\n    }\r\n\r\n    this.eventsRootContainer.classList.remove(\"border\");\r\n    if(this.config.border){\r\n      this.eventsRootContainer.classList.add(\"border\");\r\n    }\r\n\r\n    this.widgetRoot.style.height = `${this.widgetHeight}px`;\r\n    this.widgetRoot.style.width  = `${this.config.width}px`;\r\n\r\n    this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\r\n    this.eventsRootContainer.style.width  = `${this.config.width}px`;\r\n    this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\r\n    this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\r\n\r\n    //this.clear();\r\n\r\n    this.AdditionalElements();\r\n\r\n    this.getCoordinates(() => {\r\n      this.makeRequest( this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs );\r\n    });\r\n\r\n    if( this.themeModificators.hasOwnProperty( this.widgetConfig.theme ) ) {\r\n      this.themeModificators[ this.widgetConfig.theme ]();\r\n    }\r\n\r\n    /*plugins for 'buy button'*/\r\n    this.embedUniversePlugin();\r\n    this.embedTMPlugin();\r\n\r\n    this.initBuyBtn();\r\n\r\n    this.initMessage();\r\n\r\n    if (!this.isListView) this.initSliderControls();\r\n\r\n    if (!this.isListView) this.initEventCounter();\r\n\r\n    if (this.isListView) this.addScroll();\r\n  }\r\n  \r\n  getCoordinates(cb){\r\n    let widget = this;\r\n\r\n    function parseGoogleGeocodeResponse(){\r\n      if (this && this.readyState === XMLHttpRequest.DONE ) {\r\n        let latlong = '',\r\n          results = null,\r\n          countryShortName = '';\r\n        if(this.status === 200) {\r\n          let response = JSON.parse(this.responseText);\r\n          if (response.status === 'OK' && response.results.length) {\r\n            // Filtering only white list countries\r\n            results = response.results.filter((item) => {\r\n              return widget.countriesWhiteList.filter((elem) => {\r\n                  return elem === item.address_components[item.address_components.length - 1].long_name;\r\n                }).length > 0;\r\n            });\r\n\r\n            if (results.length) {\r\n              // sorting results by country name\r\n              results.sort((f, g) => {\r\n                let a = f.address_components[f.address_components.length - 1].long_name;\r\n                let b = g.address_components[g.address_components.length - 1].long_name;\r\n                if (a > b) {\r\n                  return 1;\r\n                }\r\n                if (a < b) {\r\n                  return -1;\r\n                }\r\n                return 0;\r\n              });\r\n\r\n              // Use first item if multiple results was found in one country or in different\r\n              let geometry = results[0].geometry;\r\n              countryShortName = results[0].address_components[results[0].address_components.length - 1].short_name;\r\n\r\n              // If multiple results without country try to find USA as prefer value\r\n              if (!widget.config.country) {\r\n                for (let i in results) {\r\n                  let result = results[i];\r\n                  if (result.address_components) {\r\n                    let country = result.address_components[result.address_components.length - 1];\r\n                    if (country) {\r\n                      if (country.short_name === 'US') {\r\n                        countryShortName = 'US';\r\n                        geometry = result.geometry;\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n\r\n              if (geometry) {\r\n                if (geometry.location) {\r\n                  latlong = `${geometry.location.lat},${geometry.location.lng}`;\r\n                }\r\n              }\r\n            } else {\r\n              results = null;\r\n            }\r\n          }\r\n        }\r\n        // Used in builder\r\n        if(widget.onLoadCoordinate) widget.onLoadCoordinate(results, countryShortName);\r\n        widget.config.latlong = latlong;\r\n        cb(widget.config.latlong);\r\n      }\r\n    }\r\n\r\n    if(this.isConfigAttrExistAndNotEmpty('postalcode')){\r\n      let args = {language: 'en', components: `postal_code:${widget.config.postalcode}`};\r\n      if(widget.config.googleapikey) args.key = widget.config.googleapikey;\r\n      if(this.config.country) args.components += `|country:${this.config.country}`;\r\n      this.makeRequest( parseGoogleGeocodeResponse, this.geocodeUrl, args);\r\n    }else{\r\n      // Used in builder\r\n      if(widget.onLoadCoordinate) widget.onLoadCoordinate(null);\r\n      widget.config.latlong = '';\r\n      widget.config.country = '';\r\n      cb(widget.config.latlong);\r\n    }\r\n  }\r\n\r\n  initBuyBtn(){\r\n    this.buyBtn = document.createElement(\"a\");\r\n    this.buyBtn.appendChild(document.createTextNode('BUY NOW'));\r\n    this.buyBtn.classList.add(\"event-buy-btn\");\r\n    this.buyBtn.classList.add(\"main-btn\");\r\n    this.buyBtn.target = '_blank';\r\n    this.buyBtn.href = '';\r\n    this.buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\r\n    this.buyBtn.addEventListener('click', (e)=> {\r\n      e.preventDefault(); /*used in plugins for 'buy button'*/\r\n      this.stopAutoSlideX();\r\n      //console.log(this.config.affiliateid)\r\n    });\r\n    this.eventsRootContainer.appendChild(this.buyBtn);\r\n  }\r\n\r\n  /**\r\n   * Set position center/right\r\n   *\r\n   * @param url\r\n   * @param isAddressCenter - if true : Set address position center/right for oldschool theme 300x250 (proportion :'m')\r\n   */\r\n  updateTransition(url , isAddressCenter) {\r\n    let el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");\r\n    (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date.centered-logo\") : el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");    \r\n    if(url !=='') {\r\n      if(el && !isAddressCenter){\r\n        el.classList.add(\"right-logo\");\r\n        el.classList.remove(\"centered-logo\");\r\n      }else if(el){\r\n        let i;\r\n        for (i = 0; i < el.length-1; i++) {\r\n          el[i].classList.remove(\"centered-logo\");\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date\"): el = this.eventsRootContainer.querySelector(\".event-logo.right-logo\");\r\n      if (el && !isAddressCenter) {\r\n        el.classList.remove(\"right-logo\");\r\n        el.classList.add(\"centered-logo\");\r\n      }else if(el){\r\n        let i;\r\n        for (i = 0; i < el.length-1; i++) {\r\n          el[i].classList.add(\"centered-logo\");\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setBuyBtnUrl(){\r\n    if(this.buyBtn){\r\n      let event = this.eventsGroups[this.currentSlideX][this.currentSlideY],\r\n          url = '';\r\n      if(event){\r\n        if(event.url){\r\n\r\n           if((this.isUniversePluginInitialized && this.isUniverseUrl(event.url)) || (this.isTMPluginInitialized && this.isAllowedTMEvent(event.url))){\r\n             url = event.url;\r\n           }\r\n\r\n          if(this.config.theme === 'oldschool' && this.config.proportion === 'm'){\r\n            this.updateTransition(url , true);\r\n          }else{\r\n            this.updateTransition(url);\r\n          }\r\n\r\n        }\r\n      }\r\n      this.buyBtn.href = url;\r\n    }\r\n  }\r\n\r\n  isUniverseUrl(url){\r\n    return (url.match(/universe.com/g) || url.match(/uniiverse.com/g));\r\n  }\r\n\r\n  isAllowedTMEvent(url){\r\n    for (var t = [/(?:ticketmaster\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/, /(?:concerts\\.livenation\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/], n = null, r = 0; r < t.length && (n = url.match(t[r]), null === n); r++);\r\n    let id = (null !== n ? n[2] : void 0);\r\n    return (this.tmWidgetWhiteList.indexOf(id) > -1);\r\n  }\r\n\r\n  embedTMPlugin(){\r\n    let id = 'id_tm_widget';\r\n    if( !document.getElementById(id) ) {\r\n      let script = document.createElement('script');\r\n      script.setAttribute('src', this.portalUrl + 'scripts/vendors/tm.js');\r\n      script.setAttribute('type', 'text/javascript');\r\n      script.setAttribute('charset', 'UTF-8');\r\n      script.setAttribute('id', id);\r\n      (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\r\n    }\r\n    this.isTMPluginInitialized = true;\r\n  }\r\n\r\n  embedUniversePlugin(){\r\n    let id = 'id_universe_widget';\r\n    if( !document.getElementById(id) ){\r\n      let script = document.createElement('script');\r\n      script.setAttribute('src', 'https://www.universe.com/embed.js');\r\n      script.setAttribute('type', 'text/javascript');\r\n      script.setAttribute('charset', 'UTF-8');\r\n      script.setAttribute('id', id);\r\n      (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\r\n    }\r\n    this.isUniversePluginInitialized = true;\r\n  }\r\n\r\n  // Message\r\n  initMessage(){\r\n    this.messageDialog = document.createElement('div');\r\n    this.messageDialog.classList.add(\"event-message\");\r\n    this.messageContent = document.createElement('div');\r\n    this.messageContent.classList.add(\"event-message__content\");\r\n\r\n    let messageClose = document.createElement('div');\r\n    messageClose.classList.add(\"event-message__btn\");\r\n    messageClose.addEventListener(\"click\", ()=> {\r\n      this.hideMessage();\r\n    });\r\n\r\n    this.messageDialog.appendChild(this.messageContent);\r\n    this.messageDialog.appendChild(messageClose);\r\n    this.eventsRootContainer.appendChild(this.messageDialog);\r\n  }\r\n\r\n  showMessage(message, hideMessageWithoutDelay){\r\n    if(message.length){\r\n      this.hideMessageWithoutDelay = hideMessageWithoutDelay;\r\n      this.messageContent.innerHTML = message;\r\n      this.messageDialog.classList.add(\"event-message-visible\");\r\n      if (this.messageTimeout) {\r\n        clearTimeout(this.messageTimeout); // Clear timeout if before 'hideMessageWithDelay' was called\r\n      }\r\n    }\r\n  }\r\n\r\n  hideMessageWithDelay(delay){\r\n    if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout if this method was called before\r\n    this.messageTimeout = setTimeout(()=>{\r\n      this.hideMessage();\r\n    }, delay);\r\n  }\r\n\r\n  hideMessage(){\r\n    if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout and hide message immediately.\r\n    this.messageDialog.classList.remove(\"event-message-visible\");\r\n  }\r\n  // End message\r\n\r\n  AdditionalElements(){\r\n    var legalNoticeContent = document.createTextNode('Legal Notice'),\r\n        legalNotice = document.createElement(\"a\");\r\n    legalNotice.appendChild(legalNoticeContent);\r\n    legalNotice.classList.add(\"legal-notice\");\r\n    legalNotice.target = '_blank';\r\n    legalNotice.href = this.legalNoticeUrl;\r\n    this.widgetRoot.appendChild(legalNotice);\r\n\r\n    var logo = document.createElement('a');\r\n    logo.classList.add(\"event-logo\",\"centered-logo\");\r\n    logo.target = '_blank';\r\n    logo.href = this.logoUrl;\r\n    logo.innerHTML = 'Powered by ';\r\n\r\n    var logoBox = document.createElement('div');\r\n    logoBox.classList.add(\"event-logo-box\");\r\n    logoBox.appendChild(logo);\r\n    this.eventsRootContainer.appendChild(logoBox);\r\n\r\n    let question = document.createElement('a');\r\n    question.classList.add(\"event-question\");\r\n    question.target = '_blank';\r\n    question.href = this.questionUrl;\r\n    this.eventsRootContainer.appendChild(question);\r\n  }\r\n\r\n  //adds general admission element for OLDSCHOOL theme\r\n  oldSchoolModificator(){\r\n\r\n    var generalAdmissionWrapper = document.createElement(\"div\");\r\n        generalAdmissionWrapper.classList.add(\"general-admission\", \"modificator\");\r\n\r\n    var generalAdmission = document.createElement(\"div\"),\r\n        generalAdmissionText = document.createTextNode('GENERAL ADMISSION');\r\n        generalAdmission.appendChild(generalAdmissionText);\r\n        generalAdmissionWrapper.appendChild(generalAdmission);\r\n\r\n    this.eventsRootContainer.appendChild(generalAdmissionWrapper);\r\n  }\r\n\r\n  newSchoolModificator(){\r\n    var ticketLogo = document.createElement(\"div\");\r\n    ticketLogo.classList.add(\"ticket-logo\", \"modificator\");\r\n\r\n    for(let i = 0; i < 4; i++){\r\n      let headLogo = document.createElement(\"img\");\r\n      headLogo.setAttribute(\"src\", this.portalUrl + \"assets/widgets/1.0.0/img/ticketmaster-logo-white.svg\");\r\n      headLogo.setAttribute(\"height\", \"11\");\r\n      ticketLogo.appendChild(headLogo);\r\n    }\r\n\r\n    this.eventsRootContainer.appendChild(ticketLogo);\r\n  }\r\n\r\n  listViewModificator(){\r\n  }\r\n\r\n  hideSliderControls(){\r\n    this.prevEventX.classList.add(this.controlHiddenClass);\r\n    this.nextEventX.classList.add(this.controlHiddenClass);\r\n    this.prevEventY.classList.add(this.controlHiddenClass);\r\n    this.nextEventY.classList.add(this.controlHiddenClass);\r\n  }\r\n\r\n\r\n  toggleControlsVisibility(){\r\n    // Horizontal\r\n    if(this.slideCountX > 1){\r\n      this.prevEventX.classList.remove(this.controlHiddenClass);\r\n      this.nextEventX.classList.remove(this.controlHiddenClass);\r\n      if(this.currentSlideX === 0){\r\n        this.prevEventX.classList.add(this.controlHiddenClass);\r\n      }else if(this.currentSlideX === this.slideCountX - 1){\r\n        this.nextEventX.classList.add(this.controlHiddenClass);\r\n      }\r\n    }else{\r\n      this.prevEventX.classList.add(this.controlHiddenClass);\r\n      this.nextEventX.classList.add(this.controlHiddenClass);\r\n    }\r\n\r\n    // Vertical\r\n    if(this.eventsGroups.length){\r\n      if(this.eventsGroups[this.currentSlideX].length > 1){\r\n        this.prevEventY.classList.remove(this.controlHiddenClass);\r\n        this.nextEventY.classList.remove(this.controlHiddenClass);\r\n        if(this.currentSlideY === 0){\r\n          this.prevEventY.classList.add(this.controlHiddenClass);\r\n        }else if(this.currentSlideY === this.eventsGroups[this.currentSlideX].length - 1){\r\n          this.nextEventY.classList.add(this.controlHiddenClass);\r\n        }\r\n      }else{\r\n        this.prevEventY.classList.add(this.controlHiddenClass);\r\n        this.nextEventY.classList.add(this.controlHiddenClass);\r\n      }\r\n    }else{\r\n      this.prevEventY.classList.add(this.controlHiddenClass);\r\n      this.nextEventY.classList.add(this.controlHiddenClass);\r\n    }\r\n  }\r\n\r\n  prevSlideX(){\r\n    if(this.currentSlideX > 0){\r\n      this.setSlideManually(this.currentSlideX - 1, true);\r\n    }\r\n  }\r\n\r\n  nextSlideX(){\r\n    if(this.slideCountX - 1 > this.currentSlideX) {\r\n      this.setSlideManually(this.currentSlideX + 1, true);\r\n    }\r\n  }\r\n\r\n  prevSlideY(){\r\n    if(this.currentSlideY > 0){\r\n      this.setSlideManually(this.currentSlideY - 1, false);\r\n    }\r\n  }\r\n\r\n  nextSlideY(){\r\n    if(this.eventsGroups[this.currentSlideX].length - 1 > this.currentSlideY) {\r\n      this.setSlideManually(this.currentSlideY + 1, false);\r\n    }\r\n  }\r\n\r\n  setSlideManually(slideIndex, isDirectionX){\r\n    this.stopAutoSlideX();\r\n    this.sliderTimeout = setTimeout(()=>{\r\n      this.runAutoSlideX();\r\n    }, this.sliderRestartDelay);\r\n    if(isDirectionX)\r\n      this.goToSlideX(slideIndex);\r\n    else\r\n      this.goToSlideY(slideIndex);\r\n  }\r\n\r\n  goToSlideX(slideIndex){\r\n    if(this.currentSlideX === slideIndex) return;\r\n    this.currentSlideY = 0;\r\n    this.currentSlideX = slideIndex;\r\n    this.eventsRoot.style.marginLeft = `-${this.currentSlideX * 100}%`;\r\n    this.toggleControlsVisibility();\r\n    this.setEventsCounter();\r\n    this.setBuyBtnUrl();\r\n  }\r\n\r\n  goToSlideY(slideIndex){\r\n    if(this.currentSlideY === slideIndex) return;\r\n    this.currentSlideY = slideIndex;\r\n    let eventGroup = this.eventsRoot.getElementsByClassName(\"event-group-\" + this.currentSlideX);\r\n    if(eventGroup.length){\r\n      eventGroup = eventGroup[0];\r\n      eventGroup.style.marginTop = `-${this.currentSlideY * (this.widgetContentHeight - this.borderSize * 2)}px`;\r\n      this.toggleControlsVisibility();\r\n      this.setBuyBtnUrl();\r\n    }\r\n  }\r\n\r\n  runAutoSlideX(){\r\n    if(this.slideCountX > 1) {\r\n      this.sliderInterval = setInterval(()=> {\r\n        var slideIndex = 0;\r\n        if (this.slideCountX - 1 > this.currentSlideX) slideIndex = this.currentSlideX + 1;\r\n        this.goToSlideX(slideIndex);\r\n      }, this.sliderDelay);\r\n    }\r\n  }\r\n\r\n  stopAutoSlideX(){\r\n    if(this.sliderTimeout) clearTimeout(this.sliderTimeout);\r\n    if(this.sliderInterval) clearInterval(this.sliderInterval);\r\n  }\r\n\r\n  initSliderControls(){\r\n    this.currentSlideX = 0;\r\n    this.currentSlideY = 0;\r\n    this.slideCountX = 0;\r\n    let coreCssClass = 'events_control';\r\n\r\n    // left btn\r\n    this.prevEventX = document.createElement(\"div\");\r\n    let prevEventXClass = [coreCssClass, coreCssClass + '-horizontal', coreCssClass + '-left', this.controlHiddenClass];\r\n    for(let i in prevEventXClass){\r\n      this.prevEventX.classList.add(prevEventXClass[i]);\r\n    }\r\n    this.eventsRootContainer.appendChild(this.prevEventX);\r\n\r\n    // right btn\r\n    this.nextEventX = document.createElement(\"div\");\r\n    let nextEventXClass = [coreCssClass, coreCssClass + '-horizontal', coreCssClass + '-right', this.controlHiddenClass];\r\n    for(let i in nextEventXClass){\r\n      this.nextEventX.classList.add(nextEventXClass[i]);\r\n    }\r\n    this.eventsRootContainer.appendChild(this.nextEventX);\r\n\r\n    // top btn\r\n    this.prevEventY = document.createElement(\"div\");\r\n    let prevEventYClass = [coreCssClass, coreCssClass + '-vertical', coreCssClass + '-top', this.controlHiddenClass];\r\n    for(let i in prevEventYClass ){\r\n      this.prevEventY.classList.add(prevEventYClass[i]);\r\n    }\r\n    this.eventsRootContainer.appendChild(this.prevEventY);\r\n\r\n    // bottom btn\r\n    this.nextEventY = document.createElement(\"div\");\r\n    let nextEventYClass = [coreCssClass, coreCssClass + '-vertical', coreCssClass + '-bottom', this.controlHiddenClass];\r\n    for(let i in nextEventYClass){\r\n      this.nextEventY.classList.add(nextEventYClass[i]);\r\n    }\r\n    this.eventsRootContainer.appendChild(this.nextEventY);\r\n\r\n    // Restore events group position\r\n    function whichTransitionEvent(){\r\n      let el = document.createElement('fakeelement'),\r\n        transitions = {\r\n          'transition':'transitionend',\r\n          'OTransition':'oTransitionEnd',\r\n          'MozTransition':'transitionend',\r\n          'WebkitTransition':'webkitTransitionEnd'\r\n        };\r\n\r\n      for(let event in transitions){\r\n        if( el.style[event] !== undefined ) return transitions[event];\r\n      }\r\n    }\r\n\r\n    var transitionEvent = whichTransitionEvent();\r\n    transitionEvent && this.eventsRoot.addEventListener(transitionEvent, (e)=> {\r\n      if (this.eventsRoot !== e.target) return;\r\n      let eventGroup = this.eventsRoot.getElementsByClassName(\"event-group\");\r\n      // Reset all groups. We don't know what event group was visible before.\r\n      for(let i = 0; eventGroup.length > i; i++){\r\n        eventGroup[i].style.marginTop = 0;\r\n      }\r\n    });\r\n\r\n    // Arrows\r\n    this.prevEventX.addEventListener(\"click\", ()=> {\r\n      this.prevSlideX();\r\n    });\r\n\r\n    this.nextEventX.addEventListener(\"click\", ()=> {\r\n      this.nextSlideX();\r\n    });\r\n\r\n    this.prevEventY.addEventListener(\"click\", ()=> {\r\n      this.prevSlideY();\r\n    });\r\n\r\n    this.nextEventY.addEventListener(\"click\", ()=> {\r\n      this.nextSlideY();\r\n    });\r\n\r\n    // Tough device swipes\r\n    let xDown = null,\r\n        yDown = null;\r\n\r\n    function handleTouchStart(evt) {\r\n      xDown = evt.touches[0].clientX;\r\n      yDown = evt.touches[0].clientY;\r\n    }\r\n\r\n    function handleTouchMove(evt) {\r\n      if ( ! xDown || ! yDown ) return;\r\n\r\n      let xUp = evt.touches[0].clientX,\r\n          yUp = evt.touches[0].clientY,\r\n          xDiff = xDown - xUp,\r\n          yDiff = yDown - yUp;\r\n\r\n      if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {\r\n        if ( xDiff > 0 )\r\n          this.nextSlideX(); // left swipe\r\n        else\r\n          this.prevSlideX(); // right swipe\r\n      } else {\r\n        if ( yDiff > 0 )\r\n          this.nextSlideY(); // up swipe\r\n        else\r\n          this.prevSlideY(); // down swipe\r\n      }\r\n\r\n      xDown = null;\r\n      yDown = null;\r\n    }\r\n\r\n    this.eventsRootContainer.addEventListener('touchstart', (e)=> {\r\n      if(this.config.theme !== \"listview\") { if (e.target.className != 'event-logo' && e.target.className != 'event-question') e.preventDefault(); } /*used in plugins for 'buy button'*/\r\n      handleTouchStart.call(this, e);\r\n    }, false);\r\n    this.eventsRootContainer.addEventListener('touchmove', (e)=> {\r\n      if(this.config.theme !== \"listview\") { if (e.target.className != 'event-logo' && e.target.className != 'event-question') e.preventDefault(); }\r\n      handleTouchMove.call(this, e);\r\n    }, false);\r\n  }\r\n\r\n  initSlider(){\r\n    if(this.sliderInterval) clearInterval(this.sliderInterval);\r\n    if(this.sliderTimeout) clearTimeout(this.sliderTimeout);\r\n    this.slideCountX = this.eventsGroups.length;\r\n    this.eventsRoot.style.marginLeft = '0%';\r\n    this.eventsRoot.style.width = `${this.slideCountX * 100}%`;\r\n    this.currentSlideX = 0;\r\n    this.currentSlideY = 0;\r\n    this.runAutoSlideX();\r\n    this.toggleControlsVisibility();\r\n    this.setBuyBtnUrl();\r\n  }\r\n\r\n  formatDate(date) {\r\n    var result = '';\r\n    if(!date.day) return result; // Day is required\r\n\r\n    function LZ(x) {\r\n      return (x < 0 || x > 9 ? \"\" : \"0\") + x\r\n    }\r\n    var MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\r\n        DAY_NAMES = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\r\n        dayArray = date.day.split('-'),\r\n        d = parseInt(dayArray[2]),\r\n        M = parseInt(dayArray[1]);\r\n\r\n    // var E = new Date(date.day).getDay();\r\n    var E = new Date(+date.day.split('-')[0],(+date.day.split('-')[1])-1,+date.day.split('-')[2]).getDay();\r\n    result = DAY_NAMES[E] + ', ' + MONTH_NAMES[M - 1] + ' ' + d + ', ' + dayArray[0];\r\n\r\n    if(!date.time) return result;\r\n\r\n    var timeArray = date.time.split(':'),\r\n      H = parseInt(timeArray[0]),\r\n      m = timeArray[1],\r\n      a = \"AM\";\r\n\r\n    if (H > 11) a = \"PM\";\r\n    if (H == 0) {\r\n      H = 12;\r\n    } else if (H > 12) {\r\n      H = H - 12;\r\n    }\r\n\r\n    return result + ' ' + LZ(H) + ':' + m + ' ' + a;\r\n  }\r\n\r\n  clearEvents(){\r\n    this.eventsRoot.innerHTML = \"\";\r\n  }\r\n\r\n  clear(){\r\n    var modificatorList = this.widgetRoot.getElementsByClassName('modificator');\r\n    while (modificatorList.length) {\r\n      let el = modificatorList[0],\r\n          parent = el.parentNode;\r\n      parent.removeChild(el);\r\n    }\r\n\r\n\r\n    if(!this.isListView) {\r\n      var eventsRootContainer = document.getElementsByClassName(\"events-root-container\")[0];\r\n      var eventsRoot = document.getElementsByClassName(\"events-root\")[0];\r\n      var ss = document.getElementsByClassName(\"ss\")[0];\r\n      ss.parentNode.removeChild(ss);\r\n\r\n      var ssDiv = document.createElement(\"div\");\r\n      ssDiv.setAttribute(\"class\", \"ss\");\r\n      eventsRootContainer.appendChild(ssDiv);\r\n\r\n      var ssDiv = document.getElementsByClassName(\"ss\")[0];\r\n      ssDiv.appendChild(eventsRoot);\r\n\r\n      var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\r\n      eventsRootContainer.classList.remove(\"listview-after\");\r\n    }\r\n\r\n    if(this.isListView) {\r\n      var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\r\n      eventsRootContainer.classList.add(\"listview-after\");\r\n    }\r\n\r\n\r\n    this.clearEvents();\r\n  }\r\n\r\n  update() {\r\n\r\n    let oldTheme = this.config.constructor();\r\n    for (let attr in this.config) {\r\n      if (this.config.hasOwnProperty(attr)) oldTheme[attr] = this.config[attr];\r\n    }\r\n\r\n    this.config = this.widgetRoot.attributes;\r\n\r\n    if(this.isListView) {\r\n      this.stopAutoSlideX();\r\n    }\r\n\r\n    /*if(this.config.theme !== null){\r\n      this.makeRequest( this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\" );\r\n    }*/\r\n\r\n    this.widgetRoot.style.height = `${this.widgetHeight}px`;\r\n    this.widgetRoot.style.width  = `${this.config.width}px`;\r\n    this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\r\n    this.eventsRootContainer.style.width  = `${this.config.width}px`;\r\n    this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\r\n    this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\r\n\r\n    this.eventsRootContainer.classList.remove(\"border\");\r\n    if( this.config.hasOwnProperty(\"border\") ){\r\n      this.eventsRootContainer.classList.add(\"border\");\r\n    }\r\n\r\n    if(this.needToUpdate(this.config, oldTheme, this.updateExceptions)){\r\n      this.clear();\r\n\r\n      if( this.themeModificators.hasOwnProperty( this.widgetConfig.theme ) ) {\r\n        this.themeModificators[ this.widgetConfig.theme ]();\r\n      }\r\n\r\n      this.getCoordinates(() => {\r\n        this.makeRequest( this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs );\r\n      });\r\n\r\n      if(this.isListView) this.addScroll();\r\n    }\r\n    else{\r\n      let events = this.eventsRoot.getElementsByClassName(\"event-wrapper\");\r\n      for(let i in events){\r\n        if(events.hasOwnProperty(i) && events[i].style !== undefined){\r\n          events[i].style.width = `${this.config.width - this.borderSize * 2}px`;\r\n          events[i].style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n        }\r\n      }\r\n      if(!this.isListView) {\r\n        this.goToSlideY(0);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  needToUpdate(newTheme, oldTheme, forCheck = []){\r\n    return Object.keys(newTheme).map(function(key){\r\n      if(forCheck.indexOf(key) > -1) return true;\r\n      //console.warn([key, newTheme[key], oldTheme[key], newTheme[key] === oldTheme[key]])\r\n      return newTheme[key] === oldTheme[key] ;\r\n    }).indexOf(false) > -1\r\n  }\r\n\r\n  loadConfig(NamedNodeMap){\r\n      var config = {};\r\n      Object.keys(NamedNodeMap).map(function(value){\r\n        if( typeof(NamedNodeMap[value].name) !== \"undefined\" && NamedNodeMap[value].name.indexOf(\"w-\") !== -1){\r\n          config[ NamedNodeMap[value].name.replace(/w-/g, \"\").replace(/-/g, \"\") ] = NamedNodeMap[value].value;\r\n        }\r\n      });\r\n      return config;\r\n  }\r\n\r\n  styleLoadingHandler(){\r\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n      if(this.status == 200){\r\n        var style = document.createElement(\"style\");\r\n        style.setAttribute(\"type\",\"text/css\");\r\n        style.setAttribute(\"id\",`widget-theme-${this.widget.config.theme}`);\r\n        style.textContent = this.responseText;\r\n        document.getElementsByTagName(\"head\")[0].appendChild(style);\r\n      }\r\n      else {\r\n        //alert(\"theme wasn't loaded\");\r\n        console.log(\"theme wasn't loaded\");\r\n      }\r\n    }\r\n  }\r\n\r\n  groupEventsByName(){\r\n    let groups = {};\r\n    this.events.map(function(event){\r\n      if (groups[event.name] === undefined) groups[event.name] = [];\r\n      groups[event.name].push(event);\r\n    });\r\n\r\n    this.eventsGroups = [];\r\n    for (let groupName in groups) {\r\n      this.eventsGroups.push(groups[groupName]);\r\n    }\r\n  }\r\n\r\n  initEventCounter(){\r\n    this.eventsCounter = document.createElement(\"div\");\r\n    this.eventsCounter.classList.add(\"events-counter\");\r\n    this.widgetRoot.appendChild(this.eventsCounter);\r\n  }\r\n\r\n  setEventsCounter(){\r\n    if(this.eventsCounter){\r\n      let text = '';\r\n      if(this.eventsGroups.length){\r\n        if(this.eventsGroups.length > 1){\r\n          text = `${this.currentSlideX + 1} of ${this.eventsGroups.length} events`;\r\n        } else {\r\n          text = '1 event';\r\n        }\r\n      }\r\n      this.eventsCounter.innerHTML = text;\r\n    }\r\n  }\r\n\r\n  resetReduceParamsOrder(){\r\n    this.reduceParamsOrder = 0;\r\n  }\r\n\r\n  reduceParamsAndReloadEvents(){\r\n    let eventReqAttrs = {},\r\n      reduceParamsList = [\r\n        ['classificationName'],\r\n        ['city'],\r\n        ['countryCode'],\r\n        ['source'],\r\n        ['startDateTime', 'endDateTime', 'country'],\r\n        ['radius'],\r\n        ['postalCode', 'latlong'],\r\n        ['attractionId'],\r\n        ['promoterId'],\r\n        // ['segmentId'],\r\n        ['venueId'],\r\n        ['keyword'],\r\n        ['size']\r\n      ];\r\n\r\n    // make copy of params\r\n    for(let key in this.eventReqAttrs){\r\n      eventReqAttrs[key] = this.eventReqAttrs[key]\r\n    }\r\n\r\n    if(!this.reduceParamsOrder) this.reduceParamsOrder = 0;\r\n    if(reduceParamsList.length > this.reduceParamsOrder){\r\n      for(let item in reduceParamsList){\r\n        if(this.reduceParamsOrder >= item){\r\n          for(let i in reduceParamsList[item]){\r\n            delete eventReqAttrs[reduceParamsList[item][i]];\r\n          }\r\n        }\r\n      }\r\n\r\n      if(this.reduceParamsOrder === 0) this.showMessage(\"No results were found.<br/>Here other options for you.\");\r\n      this.reduceParamsOrder++;\r\n      this.makeRequest( this.eventsLoadingHandler, this.apiUrl, eventReqAttrs );\r\n    }else{\r\n      // We haven't any results\r\n      this.showMessage(\"No results were found.\", true);\r\n      this.reduceParamsOrder = 0;\r\n      this.hideSliderControls();\r\n    }\r\n  }\r\n\r\n  eventsLoadingHandler(){\r\n    let widget = this.widget;\r\n    widget.clearEvents(); // Additional clearing after each loading\r\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n      if(this.status == 200){\r\n        widget.events = JSON.parse(this.responseText);\r\n\r\n        if(widget.events.length){\r\n          widget.groupEventsByName.call(widget);\r\n\r\n          widget.eventsGroups.map(function(group, i){\r\n            if(group.length === 1)\r\n              widget.publishEvent(group[0]);\r\n            else\r\n              widget.publishEventsGroup.call(widget, group, i);\r\n          });\r\n\r\n          if (!widget.isListView) widget.initSlider();\r\n          widget.setEventsCounter();\r\n          widget.resetReduceParamsOrder();\r\n          if(widget.hideMessageWithoutDelay)\r\n            widget.hideMessage();\r\n          else\r\n            widget.hideMessageWithDelay(widget.hideMessageDelay);\r\n\r\n        }else{\r\n          widget.reduceParamsAndReloadEvents.call(widget);\r\n        }\r\n      }\r\n      else if(this.status == 400) {\r\n        widget.reduceParamsAndReloadEvents.call(widget);\r\n        console.log('There was an error 400');\r\n      }\r\n      else {\r\n        widget.reduceParamsAndReloadEvents.call(widget);\r\n        console.log('something else other than 200 was returned');\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  publishEventsGroup(group, index){\r\n    let groupNodeWrapper = document.createElement(\"li\");\r\n    groupNodeWrapper.classList.add(\"event-wrapper\");\r\n    groupNodeWrapper.classList.add(\"event-group-wrapper\");\r\n    groupNodeWrapper.style.width  = `${this.config.width - this.borderSize * 2}px`;\r\n    groupNodeWrapper.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n\r\n    let groupNode = document.createElement(\"ul\");\r\n    groupNode.classList.add(\"event-group\");\r\n    groupNode.classList.add(\"event-group-\" + index);\r\n\r\n    group.map((event)=> {\r\n      this.publishEvent(event, groupNode)\r\n    });\r\n\r\n    groupNodeWrapper.appendChild(groupNode);\r\n    this.eventsRoot.appendChild(groupNodeWrapper);\r\n  }\r\n\r\n  publishEvent(event, parentNode){\r\n    parentNode = parentNode || this.eventsRoot;\r\n    let DOMElement = this.createDOMItem(event);\r\n    parentNode.appendChild(DOMElement);\r\n  }\r\n\r\n  getEventByID(id){\r\n    for(let index in this.events){\r\n      if(this.events.hasOwnProperty(index) && this.events[index].id === id){\r\n        return this.events[index]\r\n      }\r\n    }\r\n  }\r\n\r\n  getImageForEvent(images){\r\n    var width = this.config.width,\r\n      height = this.widgetContentHeight;\r\n\r\n    images.sort(function(a,b) {\r\n      if (a.width < b.width)\r\n        return -1;\r\n      else if (a.width > b.width)\r\n        return 1;\r\n      else\r\n        return 0;\r\n    });\r\n\r\n    var myImg = \"\";\r\n    images.forEach(function(element){\r\n      if(element.width >= width && element.height >= height && !myImg){\r\n        myImg = element.url;\r\n      }\r\n    });\r\n    return myImg;\r\n  }\r\n\r\n  parseEvents(eventsSet){\r\n    if(!eventsSet._embedded){\r\n      if(typeof($widgetModalNoCode) !== \"undefined\"){\r\n        $widgetModalNoCode.modal();\r\n      }\r\n      return [];\r\n    }\r\n    eventsSet = eventsSet._embedded.events;\r\n    var tmpEventSet = [];\r\n\r\n    for(var key in eventsSet){\r\n      if(eventsSet.hasOwnProperty(key)){\r\n        let currentEvent = {};\r\n\r\n        currentEvent.id = eventsSet[key].id;\r\n        currentEvent.url = eventsSet[key].url;\r\n        currentEvent.name = eventsSet[key].name;\r\n\r\n        currentEvent.date = {\r\n          day: eventsSet[key].dates.start.localDate,\r\n          time: eventsSet[key].dates.start.localTime\r\n        };\r\n\r\n        if(eventsSet[key].hasOwnProperty('_embedded') && eventsSet[key]._embedded.hasOwnProperty('venues')){\r\n          let venue = eventsSet[key]._embedded.venues[0];\r\n          if(venue){\r\n            if(venue.address)\r\n              currentEvent.address = venue.address;\r\n\r\n            if(venue.name){\r\n              if(!currentEvent.address) currentEvent.address = {};\r\n              currentEvent.address.name = venue.name;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Remove this comment to get categories\r\n        /*if(eventsSet[key]._embedded.hasOwnProperty('categories')){\r\n          currentEvent.categories = [];\r\n          let eventCategories = eventsSet[key]._embedded.categories;\r\n          currentEvent.categories = Object.keys(eventCategories).map(function(category){\r\n            return eventCategories[category].name\r\n          });\r\n        }*/\r\n\r\n        currentEvent.img = this.getImageForEvent(eventsSet[key].images);\r\n        tmpEventSet.push(currentEvent);\r\n\r\n      }\r\n    }\r\n    return tmpEventSet;\r\n  }\r\n\r\n\r\n  makeRequest(handler, url=this.apiUrl, attrs={}, method=\"GET\"){\r\n    attrs = Object.keys(attrs).map(function(key){\r\n      return `${key}=${attrs[key]}`;\r\n    }).join(\"&\");\r\n\r\n    url = [url,attrs].join(\"?\");\r\n\r\n    this.xmlHTTP = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    if(method == \"POST\") {\r\n      this.xmlHTTP.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\r\n    }\r\n    this.xmlHTTP.widget = this;\r\n    this.xmlHTTP.onreadystatechange = handler;\r\n    this.xmlHTTP.open(method, url, true);\r\n    this.xmlHTTP.send();\r\n  }\r\n\r\n\r\n  initPretendedLink(el, url, isBlank){\r\n    if(el && url){\r\n      el.setAttribute('data-url', url);\r\n      el.classList.add(\"event-pretended-link\");\r\n      el.addEventListener('click', function(){\r\n        let url = this.getAttribute('data-url');\r\n        if(url){\r\n          let win = window.open(url, (isBlank ? '_blank' : '_self'));\r\n          win.focus();\r\n        }\r\n      });\r\n      el.addEventListener('touchstart', function(){\r\n        let url = this.getAttribute('data-url');\r\n        if(url){\r\n          let win = window.open(url, (isBlank ? '_blank' : '_self'));\r\n          win.focus();\r\n        }\r\n      });\r\n    }\r\n    return el;\r\n  }\r\n\r\n  createBackgroundImage(event, img) {\r\n    if (!this.isListView) {\r\n      var image = document.createElement(\"span\");\r\n      image.classList.add(\"bg-cover\");\r\n      image.style.backgroundImage = `url('${img}')`;\r\n      event.appendChild(image);\r\n    }\r\n  }\r\n\r\n  addBarcode(domNode, url) {\r\n    if (this.isBarcodeWidget) {\r\n      let barcodeBtn = document.createElement(\"a\");\r\n      barcodeBtn.classList.add(\"barcode\");\r\n      barcodeBtn.target = '_blank';\r\n      barcodeBtn.href = url;\r\n      barcodeBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickEventName', 'click');\");\r\n      domNode.appendChild(barcodeBtn);\r\n      let bottomBg = document.createElement(\"span\");\r\n      bottomBg.classList.add(\"barcode-bottom\");\r\n      domNode.appendChild(bottomBg);\r\n    }\r\n  }\r\n\r\n  addBuyButton(domNode, url) {\r\n    if (this.isListView) {\r\n      let _urlValid = ( this.isUniversePluginInitialized && this.isUniverseUrl(url) ) || ( this.isTMPluginInitialized && this.isAllowedTMEvent(url) );\r\n      if(!_urlValid) url = '';\r\n      let buyBtn = document.createElement(\"a\");\r\n      buyBtn.appendChild(document.createTextNode('BUY NOW'));\r\n      buyBtn.classList.add(\"event-buy-btn\");\r\n      buyBtn.target = '_blank';\r\n      buyBtn.href = url;\r\n      buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\r\n      domNode.appendChild(buyBtn);\r\n    }\r\n  }\r\n\r\n  addScroll() {\r\n    (function(n,t){function u(n){n.hasOwnProperty(\"data-simple-scrollbar\")||Object.defineProperty(n,\"data-simple-scrollbar\",new SimpleScrollbar(n))}function e(n,i){function f(n){var t=n.pageY-u;u=n.pageY;r(function(){i.el.scrollTop+=t/i.scrollRatio})}function e(){n.classList.remove(\"ss-grabbed\");t.body.classList.remove(\"ss-grabbed\");t.removeEventListener(\"mousemove\",f);t.removeEventListener(\"mouseup\",e)}var u;n.addEventListener(\"mousedown\",function(i){return u=i.pageY,n.classList.add(\"ss-grabbed\"),t.body.classList.add(\"ss-grabbed\"),t.addEventListener(\"mousemove\",f),t.addEventListener(\"mouseup\",e),!1})}function i(n){for(this.target=n,this.bar='<div class=\"ss-scroll\">',this.wrapper=t.createElement(\"div\"),this.wrapper.setAttribute(\"class\",\"ss-wrapper\"),this.el=t.createElement(\"div\"),this.el.setAttribute(\"class\",\"ss-content\"),this.wrapper.appendChild(this.el);this.target.firstChild;)this.el.appendChild(this.target.firstChild);this.target.appendChild(this.wrapper);this.target.insertAdjacentHTML(\"beforeend\",this.bar);this.bar=this.target.lastChild;e(this.bar,this);this.moveBar();this.el.addEventListener(\"scroll\",this.moveBar.bind(this));this.el.addEventListener(\"mouseenter\",this.moveBar.bind(this));this.target.classList.add(\"ss-container\")}function f(){for(var i=t.querySelectorAll(\"*[ss-container]\"),n=0;n<i.length;n++)u(i[n])}var r=n.requestAnimationFrame||n.setImmediate||function(n){return setTimeout(n,0)};i.prototype={moveBar:function(){var t=this.el.scrollHeight,i=this.el.clientHeight,n=this;this.scrollRatio=i/t;r(function(){n.bar.style.cssText=\"height:\"+i/t*100+\"%; top:\"+n.el.scrollTop/t*100+\"%;right:-\"+(n.target.clientWidth-n.bar.clientWidth)+\"px;\"})}};t.addEventListener(\"DOMContentLoaded\",f);i.initEl=u;i.initAll=f;n.SimpleScrollbar=i})(window,document)\r\n    // var scrollRoot = document.getElementsByClassName(\"ss\")[0];\r\n    var scrollRoot = document.querySelector('.ss');\r\n    SimpleScrollbar.initEl(scrollRoot);\r\n  }\r\n\r\n  createDOMItem(itemConfig){\r\n    var medWrapper = document.createElement(\"div\");\r\n    medWrapper.classList.add(\"event-content-wraper\");\r\n\r\n    var event = document.createElement(\"li\");\r\n    event.classList.add(\"event-wrapper\");\r\n    event.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\r\n    event.style.width  = `${this.config.width - this.borderSize * 2}px`;\r\n\r\n    this.createBackgroundImage(event, itemConfig.img);\r\n\r\n    var nameContent = document.createTextNode(itemConfig.name),\r\n    name =  document.createElement(\"span\");\r\n    name.classList.add(\"event-name\");\r\n    name.appendChild(nameContent);\r\n    this.initPretendedLink(name, itemConfig.url, true);\r\n    name.setAttribute('onclick', `ga('send', 'event', 'DiscoveryClickeventName_theme=${this.config.theme}_width=${this.config.width}_height=${this.config.height}_color_scheme=${this.config.colorscheme}', 'click', '${itemConfig.url}');`);\r\n    /* name.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickeventName', 'click', '\" + itemConfig.url + \"');\"); */\r\n    medWrapper.appendChild(name);\r\n\r\n    this.addBarcode(event, itemConfig.url);\r\n    this.addBuyButton(medWrapper, itemConfig.url);\r\n\r\n    var dateTimeContent = document.createTextNode(this.formatDate(itemConfig.date)),\r\n    dateTime = document.createElement(\"span\");\r\n    dateTime.classList.add(\"event-date\", \"centered-logo\");\r\n    dateTime.appendChild(dateTimeContent);\r\n\r\n    var dateWraper = document.createElement(\"span\");\r\n    dateWraper.classList.add(\"event-date-wraper\");\r\n    dateWraper.appendChild(dateTime);\r\n    medWrapper.appendChild(dateWraper);\r\n\r\n    if(itemConfig.hasOwnProperty(\"address\")){\r\n      var addressWrapper = document.createElement(\"span\");\r\n      addressWrapper.classList.add(\"address-wrapper\");\r\n\r\n      if( itemConfig.address.hasOwnProperty(\"name\") ){\r\n        var addressNameText = document.createTextNode(itemConfig.address.name),\r\n            addressName =  document.createElement(\"span\");\r\n        addressName.classList.add(\"event-address\");\r\n        addressName.classList.add(\"event-address-name\");\r\n        addressName.appendChild(addressNameText);\r\n        addressWrapper.appendChild(addressName);\r\n      }\r\n\r\n      if( itemConfig.address.hasOwnProperty(\"line1\") ){\r\n        var addressOneText = document.createTextNode(itemConfig.address.line1),\r\n        addressOne =  document.createElement(\"span\");\r\n        addressOne.classList.add(\"event-address\");\r\n        addressOne.appendChild(addressOneText);\r\n        addressWrapper.appendChild(addressOne);\r\n      }\r\n\r\n      if( itemConfig.address.hasOwnProperty(\"line2\") ){\r\n        var addressTwoText = document.createTextNode(itemConfig.address.line2),\r\n        addressTwo =  document.createElement(\"span\");\r\n        addressTwo.classList.add(\"event-address\");\r\n        addressTwo.appendChild(addressTwoText);\r\n        addressWrapper.appendChild(addressTwo);\r\n      }\r\n\r\n      medWrapper.appendChild(addressWrapper);\r\n    }\r\n\r\n    if(itemConfig.hasOwnProperty(\"categories\")) {\r\n      var categoriesWrapper = document.createElement(\"span\");\r\n      categoriesWrapper.classList.add(\"category-wrapper\");\r\n\r\n      itemConfig.categories.forEach(function (element) {\r\n        var categoryText = document.createTextNode(element),\r\n          category = document.createElement(\"span\");\r\n        category.classList.add(\"event-category\");\r\n        category.appendChild(categoryText);\r\n        categoriesWrapper.appendChild(category);\r\n      });\r\n      medWrapper.appendChild(categoriesWrapper);\r\n    }\r\n\r\n    event.appendChild(medWrapper);\r\n\r\n    return event;\r\n  }\r\n\r\n\r\n  makeImageUrl(id){\r\n    return `https://app.ticketmaster.com/discovery/v2/events/${id}/images.json`;\r\n  }\r\n\r\n\r\n  /*\r\n   * Config block\r\n   */\r\n\r\n  decConfig(config){\r\n    return JSON.parse(window.atob(config));\r\n  }\r\n\r\n  encConfig(config){\r\n    return window.btoa(config);\r\n  }\r\n\r\n  toShortISOString(dateObj){\r\n    return dateObj.getFullYear() +\r\n      \"-\" + (dateObj.getMonth() + 1 < 10 ? \"0\"+ (dateObj.getMonth()+ 1): dateObj.getMonth() + 1) +\r\n      \"-\" + (dateObj.getDate() < 10 ? \"0\"+ dateObj.getDate(): dateObj.getDate()) +\r\n      \"T\" + (dateObj.getHours() < 10 ? \"0\"+dateObj.getHours(): dateObj.getHours()) +\r\n      \":\" + (dateObj.getMinutes() < 10 ? \"0\"+dateObj.getMinutes(): dateObj.getMinutes()) +\r\n      \":\" + (dateObj.getSeconds() < 10 ? \"0\"+dateObj.getSeconds(): dateObj.getSeconds()) +\r\n      \"Z\";\r\n  }\r\n\r\n  getDateFromPeriod(period){\r\n\r\n    var period = period.toLowerCase(),\r\n      firstDay, lastDay;\r\n\r\n    if(period == \"year\" ) {\r\n      firstDay = new Date( new Date(new Date()).toISOString() );\r\n      lastDay = new Date( new Date(new Date().valueOf()+24*365*60*60*1000).toISOString() );\r\n    }\r\n    else if(period == \"month\") {\r\n      firstDay = new Date( new Date(new Date()).toISOString() );\r\n      lastDay = new Date( new Date(new Date().valueOf()+24*31*60*60*1000).toISOString() );\r\n    }\r\n    else if(period == \"week\") {\r\n      firstDay = new Date( new Date(new Date()).toISOString() );\r\n      lastDay = new Date( new Date(new Date().valueOf()+24*7*60*60*1000).toISOString() );\r\n    } else {\r\n      firstDay = new Date( new Date(new Date()).toISOString() );\r\n      lastDay = new Date( new Date(new Date().valueOf()+24*60*60*1000).toISOString() );\r\n    }\r\n\r\n    return [this.toShortISOString(firstDay), this.toShortISOString(lastDay)];\r\n  }\r\n\r\n}\r\nlet widgetsEventDiscovery = [];\r\n(function () {\r\n  let widgetContainers = document.querySelectorAll(\"div[w-type='event-discovery']\");\r\n  for (let i = 0; i < widgetContainers.length; ++i) {\r\n    widgetsEventDiscovery.push(new TicketmasterEventDiscoveryWidget(widgetContainers[i]));\r\n  }\r\n\r\n})();\r\n\r\n(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\r\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\r\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\r\n})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\r\n\r\nga('create', 'UA-78315612-1', 'auto');\r\nga('send', 'pageview');\r\n\r\n\r\n\r\n"]}