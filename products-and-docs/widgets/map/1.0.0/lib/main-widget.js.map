{"version":3,"sources":["../src/main-widget.es6"],"names":["TicketmasterEventDiscoveryWidget","attr","config","hasOwnProperty","attrs","widgetConfig","loadConfig","responce","eventsList","parseEvents","theme","proportion","border","height","widgetHeight","isListView","isSimpleProportionM","window","location","host","params","verboseName","i","item","isConfigAttrExistAndNotEmpty","latlong","postalCode","postalcode","period","getDateFromPeriod","startDateTime","endDateTime","root","widgetRoot","querySelector","eventsRootContainer","document","createElement","classList","add","appendChild","eventsRoot","id","setAttribute","themeModificators","oldSchoolModificator","bind","newSchoolModificator","attributes","getElementById","makeRequest","styleLoadingHandler","themeUrl","remove","style","width","widgetContentHeight","borderRadius","borderradius","borderWidth","borderSize","AdditionalElements","getCoordinates","eventsLoadingHandler","apiUrl","eventReqAttrs","embedUniversePlugin","embedTMPlugin","initBuyBtn","initMessage","cb","widget","parseGoogleGeocodeResponse","readyState","XMLHttpRequest","DONE","results","countryShortName","status","response","JSON","parse","responseText","length","filter","countriesWhiteList","elem","address_components","long_name","sort","f","g","a","b","geometry","short_name","country","result","lat","lng","onLoadCoordinate","args","language","components","googleapikey","key","geocodeUrl","buyBtn","createTextNode","target","href","addEventListener","e","preventDefault","url","isAddressCenter","el","querySelectorAll","event","isUniversePluginInitialized","isUniverseUrl","isTMPluginInitialized","isAllowedTMEvent","updateTransition","match","t","n","r","tmWidgetWhiteList","indexOf","script","portalUrl","head","getElementsByTagName","messageDialog","messageContent","messageClose","hideMessage","message","hideMessageWithoutDelay","innerHTML","messageTimeout","clearTimeout","delay","setTimeout","legalNoticeContent","legalNotice","legalNoticeUrl","logo","logoUrl","logoBox","question","questionUrl","generalAdmissionWrapper","generalAdmission","generalAdmissionText","ticketLogo","headLogo","date","day","LZ","x","MONTH_NAMES","DAY_NAMES","dayArray","split","d","parseInt","M","E","Date","getDay","time","timeArray","H","m","modificatorList","getElementsByClassName","parent","parentNode","removeChild","clearEvents","oldTheme","constructor","needToUpdate","updateExceptions","clear","addScroll","events","undefined","newTheme","forCheck","Object","keys","map","NamedNodeMap","value","name","replace","textContent","console","log","groups","push","eventsGroups","groupName","reduceParamsOrder","reduceParamsList","showMessage","markers","infowindow","google","maps","InfoWindow","content","sites","siteLatLng","LatLng","marker","Marker","position","title","zIndex","html","addListener","setContent","open","myLatLng","Map","zoom","center","mapTypeId","MapTypeId","ROADMAP","groupEventsByName","call","group","publishEventsGroup","setMarkers","resetReduceParamsOrder","hideMessageWithDelay","hideMessageDelay","reduceParamsAndReloadEvents","index","images","myImg","forEach","element","eventsSet","_embedded","$widgetModalNoCode","modal","tmpEventSet","currentEvent","parser","expr","changeURL","pathname","origin","join","search","hash","dates","start","localDate","localTime","venue","venues","address","parseFloat","latitude","longitude","img","getImageForEvent","handler","method","xmlHTTP","ActiveXObject","setRequestHeader","onreadystatechange","send","isBlank","getAttribute","win","focus","image","backgroundImage","domNode","isBarcodeWidget","barcodeBtn","bottomBg","_urlValid","u","defineProperty","SimpleScrollbar","pageY","scrollTop","scrollRatio","body","removeEventListener","bar","wrapper","firstChild","insertAdjacentHTML","lastChild","moveBar","requestAnimationFrame","setImmediate","prototype","scrollHeight","clientHeight","cssText","clientWidth","initEl","initAll","scrollRoot","itemConfig","medWrapper","createBackgroundImage","nameContent","initPretendedLink","colorscheme","addBarcode","addBuyButton","dateTimeContent","formatDate","dateTime","dateWraper","addressWrapper","addressNameText","addressName","addressOneText","line1","addressOne","addressTwoText","line2","addressTwo","categoriesWrapper","categories","categoryText","category","atob","btoa","dateObj","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","toLowerCase","firstDay","lastDay","toISOString","slice","valueOf","widgetsEventDiscovery","widgetContainers","s","o","q","arguments","l","async","src","insertBefore","ga"],"mappings":"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","file":"main-widget.js","sourcesContent":["class TicketmasterEventDiscoveryWidget {\n\n    set config(attrs) { this.widgetConfig = this.loadConfig(attrs); }\n    get config() { return this.widgetConfig; }\n\n    set events(responce){ this.eventsList = this.parseEvents(responce);}\n    get events(){ return this.eventsList;}\n\n    get isListView() { return this.config.theme === 'listview';}\n    get isBarcodeWidget() { return (this.config.theme === 'oldschool' || this.config.theme === 'newschool');}\n    get isSimpleProportionM() { return this.config.proportion === 'm'}\n    get borderSize(){ return this.config.border || 0;}\n    get widgetHeight(){ return this.config.height || 600;}\n\n    get widgetContentHeight() {\n        return this.widgetHeight - (this.isListView || this.isSimpleProportionM ? 0 : 39) || 600;\n    }\n\n    get eventUrl(){ return \"https://www.ticketmaster.com/event/\"; }\n\n    get apiUrl(){ return \"https://app.ticketmaster.com/discovery/v2/events.json\"; }\n\n    get themeUrl() {\n        return (window.location.host === 'developer.ticketmaster.com')\n            ? `https://developer.ticketmaster.com/products-and-docs/widgets/event-discovery/1.0.0/theme/`\n            : `https://ticketmaster-api-staging.github.io/products-and-docs/widgets/event-discovery/1.0.0/theme/`;\n    }\n\n    get portalUrl(){\n        return (window.location.host === 'developer.ticketmaster.com')\n            ? `https://developer.ticketmaster.com/`\n            : `https://ticketmaster-api-staging.github.io/`;\n    }\n\n    get logoUrl() { return \"https://www.ticketmaster.com/\"; }\n\n    get legalNoticeUrl() { return \"http://developer.ticketmaster.com/support/terms-of-use/\"; }\n\n    get questionUrl() { return \"http://developer.ticketmaster.com/support/faq/\"; }\n\n    get geocodeUrl() { return \"https://maps.googleapis.com/maps/api/geocode/json\"; }\n\n    get updateExceptions() { return [\"width\", \"height\", \"border\", \"borderradius\", \"colorscheme\", \"layout\", \"affiliateid\", \"propotion\", \"googleapikey\"]}\n\n    get hideMessageDelay(){ return 5000; }\n\n    get controlHiddenClass(){ return \"events_control-hidden\"; }\n\n    get tmWidgetWhiteList(){ return [\"2200504BAD4C848F\", \"00005044BDC83AE6\", \"1B005068DB60687F\", \"1B004F4DBEE45E47\", \"3A004F4ED7829D5E\", \"3A004F4ED1FC9B63\", \"1B004F4FF83289C5\", \"1B004F4FC0276888\", \"0E004F4F3B7DC543\", \"1D004F4F09C61861\", \"1600505AC9A972A1\", \"22004F4FD82795C6\", \"01005057AFF54574\", \"01005056FAD8793A\", \"3A004F4FB2453240\", \"22004F50D2149AC6\", \"01005059AD49507A\", \"01005062B4236D5D\"]; }\n\n    get countriesWhiteList() {\n        return [\n            'Australia',\n            'Austria',\n            'Belgium',\n            'Canada',\n            'Denmark',\n            'Finland',\n            'France',\n            'Germany',\n            'Ireland',\n            'Mexico',\n            'Netherlands',\n            'New Zealand',\n            'Norway',\n            'Spain',\n            'Sweden',\n            'Turkey',\n            'UAE',\n            'United Kingdom',\n            'United States'\n        ]\n    }\n\n    isConfigAttrExistAndNotEmpty(attr) {\n        if( !this.config.hasOwnProperty(attr) || this.config[attr] === \"undefined\"){\n            return false;\n        }else if( this.config[attr] === \"\"){\n            return false;\n        }\n        return true;\n    }\n\n    get eventReqAttrs(){\n        let attrs = {},\n            params = [\n                {\n                    attr: 'tmapikey',\n                    verboseName: 'apikey'\n                },\n                {\n                    attr: 'keyword',\n                    verboseName: 'keyword'\n                },\n                {\n                    attr: 'size',\n                    verboseName: 'size'\n                },\n                {\n                    attr: 'radius',\n                    verboseName: 'radius'\n                },\n                {\n                    attr: 'attractionid',\n                    verboseName: 'attractionId'\n                },\n                {\n                    attr: 'promoterid',\n                    verboseName: 'promoterId'\n                },\n                {\n                    attr: 'venueid',\n                    verboseName: 'venueId'\n                },\n                {\n                    attr: 'classificationname',\n                    verboseName: 'classificationName'\n                },\n                {\n                    attr: 'city',\n                    verboseName: 'city'\n                },\n                {\n                    attr: 'countrycode',\n                    verboseName: 'countryCode'\n                },\n                {\n                    attr: 'source',\n                    verboseName: 'source'\n                }\n            ];\n\n        for(let i in params){\n            let item = params[i];\n            if(this.isConfigAttrExistAndNotEmpty(item.attr))\n                attrs[item.verboseName] = this.config[item.attr];\n        }\n\n        // Only one allowed at the same time\n        if(this.config.latlong){\n            attrs.latlong = this.config.latlong;\n        }else{\n            if(this.isConfigAttrExistAndNotEmpty(\"postalcode\"))\n                attrs.postalCode = this.config.postalcode;\n        }\n\n        if(this.isConfigAttrExistAndNotEmpty(\"period\")){\n            let period = this.getDateFromPeriod(this.config.period);\n            attrs.startDateTime = period[0];\n            attrs.endDateTime = period[1];\n        }\n\n        return attrs;\n    }\n\n    constructor(root) {\n        if(!root) return;\n        this.widgetRoot = root;\n        if (this.widgetRoot.querySelector('.events-root-container') === null) {\n            this.eventsRootContainer = document.createElement(\"div\");\n            this.eventsRootContainer.classList.add(\"events-root-container\");\n            this.widgetRoot.appendChild(this.eventsRootContainer);\n\n            /*\n            this.eventsRoot = document.createElement(\"ul\");\n            this.eventsRoot.classList.add(\"events-root\");\n            this.eventsRootDiv.appendChild(this.eventsRoot);\n            */\n\n            this.eventsRoot = document.createElement(\"div\");\n            // this.eventsRoot.classList.add(\"map\");\n            this.eventsRoot.id = \"map\";\n            this.eventsRoot.setAttribute(\"style\", \"width:300px;height:560px;\");\n            this.eventsRootContainer.appendChild(this.eventsRoot);\n\n            // Set theme modificators\n            this.themeModificators = {\n                \"oldschool\": this.oldSchoolModificator.bind(this),\n                \"newschool\": this.newSchoolModificator.bind(this),\n            };\n\n            this.config = this.widgetRoot.attributes;\n\n            if (this.config.theme !== null && !document.getElementById(`widget-theme-${this.config.theme}`)) {\n                this.makeRequest(this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\");\n            }\n\n            this.eventsRootContainer.classList.remove(\"border\");\n            if (this.config.border) {\n                this.eventsRootContainer.classList.add(\"border\");\n            }\n\n            this.widgetRoot.style.height = `${this.widgetHeight}px`;\n            this.widgetRoot.style.width = `${this.config.width}px`;\n\n            this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\n            this.eventsRootContainer.style.width = `${this.config.width}px`;\n            this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\n            this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\n\n            //this.clear();\n\n            this.AdditionalElements();\n\n            this.getCoordinates(() => {\n                this.makeRequest(this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs);\n            });\n\n            if (this.themeModificators.hasOwnProperty(this.widgetConfig.theme)) {\n                this.themeModificators[this.widgetConfig.theme]();\n            }\n\n            /*plugins for 'buy button'*/\n            this.embedUniversePlugin();\n            this.embedTMPlugin();\n            this.initBuyBtn();\n            this.initMessage();\n        }\n    }\n\n    getCoordinates(cb){\n        let widget = this;\n\n        function parseGoogleGeocodeResponse(){\n            if (this && this.readyState === XMLHttpRequest.DONE ) {\n                let latlong = '',\n                    results = null,\n                    countryShortName = '';\n                if(this.status === 200) {\n                    let response = JSON.parse(this.responseText);\n                    if (response.status === 'OK' && response.results.length) {\n                        // Filtering only white list countries\n                        results = response.results.filter((item) => {\n                            return widget.countriesWhiteList.filter((elem) => {\n                                    return elem === item.address_components[item.address_components.length - 1].long_name;\n                                }).length > 0;\n                        });\n\n                        if (results.length) {\n                            // sorting results by country name\n                            results.sort((f, g) => {\n                                let a = f.address_components[f.address_components.length - 1].long_name;\n                                let b = g.address_components[g.address_components.length - 1].long_name;\n                                if (a > b) {\n                                    return 1;\n                                }\n                                if (a < b) {\n                                    return -1;\n                                }\n                                return 0;\n                            });\n\n                            // Use first item if multiple results was found in one country or in different\n                            let geometry = results[0].geometry;\n                            countryShortName = results[0].address_components[results[0].address_components.length - 1].short_name;\n\n                            // If multiple results without country try to find USA as prefer value\n                            if (!widget.config.country) {\n                                for (let i in results) {\n                                    let result = results[i];\n                                    if (result.address_components) {\n                                        let country = result.address_components[result.address_components.length - 1];\n                                        if (country) {\n                                            if (country.short_name === 'US') {\n                                                countryShortName = 'US';\n                                                geometry = result.geometry;\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n\n                            if (geometry) {\n                                if (geometry.location) {\n                                    latlong = `${geometry.location.lat},${geometry.location.lng}`;\n                                }\n                            }\n                        } else {\n                            results = null;\n                        }\n                    }\n                }\n                // Used in builder\n                if(widget.onLoadCoordinate) widget.onLoadCoordinate(results, countryShortName);\n                widget.config.latlong = latlong;\n                cb(widget.config.latlong);\n            }\n        }\n\n        if(this.isConfigAttrExistAndNotEmpty('postalcode')){\n            let args = {language: 'en', components: `postal_code:${widget.config.postalcode}`};\n            if(widget.config.googleapikey) args.key = widget.config.googleapikey;\n            if(this.config.country) args.components += `|country:${this.config.country}`;\n            this.makeRequest( parseGoogleGeocodeResponse, this.geocodeUrl, args);\n        }else{\n            // Used in builder\n            if(widget.onLoadCoordinate) widget.onLoadCoordinate(null);\n            widget.config.latlong = '';\n            widget.config.country = '';\n            cb(widget.config.latlong);\n        }\n    }\n\n    initBuyBtn(){\n        this.buyBtn = document.createElement(\"a\");\n        this.buyBtn.appendChild(document.createTextNode('BUY NOW'));\n        this.buyBtn.classList.add(\"event-buy-btn\");\n        this.buyBtn.classList.add(\"main-btn\");\n        this.buyBtn.target = '_blank';\n        this.buyBtn.href = '';\n        this.buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\n        this.buyBtn.addEventListener('click', (e)=> {\n            e.preventDefault(); /*used in plugins for 'buy button'*/\n            //console.log(this.config.affiliateid)\n        });\n        this.eventsRootContainer.appendChild(this.buyBtn);\n    }\n\n    /**\n     * Set position center/right\n     *\n     * @param url\n     * @param isAddressCenter - if true : Set address position center/right for oldschool theme 300x250 (proportion :'m')\n     */\n    updateTransition(url , isAddressCenter) {\n        let el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");\n        (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date.centered-logo\") : el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");\n        if(url !=='') {\n            if(el && !isAddressCenter){\n                el.classList.add(\"right-logo\");\n                el.classList.remove(\"centered-logo\");\n            }else if(el){\n                let i;\n                for (i = 0; i < el.length-1; i++) {\n                    el[i].classList.remove(\"centered-logo\");\n                }\n            }\n        }\n        else {\n            (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date\"): el = this.eventsRootContainer.querySelector(\".event-logo.right-logo\");\n            if (el && !isAddressCenter) {\n                el.classList.remove(\"right-logo\");\n                el.classList.add(\"centered-logo\");\n            }else if(el){\n                let i;\n                for (i = 0; i < el.length-1; i++) {\n                    el[i].classList.add(\"centered-logo\");\n                }\n            }\n        }\n    }\n\n    setBuyBtnUrl(){\n        if(this.buyBtn){\n            let event = '',\n                url = '';\n            if(event){\n                if(event.url){\n\n                    if((this.isUniversePluginInitialized && this.isUniverseUrl(event.url)) || (this.isTMPluginInitialized && this.isAllowedTMEvent(event.url))){\n                        url = event.url;\n                    }\n\n                    if(this.config.theme === 'oldschool' && this.config.proportion === 'm'){\n                        this.updateTransition(url , true);\n                    }else{\n                        this.updateTransition(url);\n                    }\n\n                }\n            }\n            this.buyBtn.href = url;\n        }\n    }\n\n    isUniverseUrl(url){\n        return (url.match(/universe.com/g) || url.match(/uniiverse.com/g));\n    }\n\n    isAllowedTMEvent(url){\n        for (var t = [/(?:ticketmaster\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/, /(?:concerts\\.livenation\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/], n = null, r = 0; r < t.length && (n = url.match(t[r]), null === n); r++);\n        let id = (null !== n ? n[2] : void 0);\n        return (this.tmWidgetWhiteList.indexOf(id) > -1);\n    }\n\n    embedTMPlugin(){\n        let id = 'id_tm_widget';\n        if( !document.getElementById(id) ) {\n            let script = document.createElement('script');\n            script.setAttribute('src', this.portalUrl + 'scripts/vendors/tm.js');\n            script.setAttribute('type', 'text/javascript');\n            script.setAttribute('charset', 'UTF-8');\n            script.setAttribute('id', id);\n            (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\n        }\n        this.isTMPluginInitialized = true;\n    }\n\n    embedUniversePlugin(){\n        let id = 'id_universe_widget';\n        if( !document.getElementById(id) ){\n            let script = document.createElement('script');\n            script.setAttribute('src', 'https://www.universe.com/embed.js');\n            script.setAttribute('type', 'text/javascript');\n            script.setAttribute('charset', 'UTF-8');\n            script.setAttribute('id', id);\n            (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\n        }\n        this.isUniversePluginInitialized = true;\n    }\n\n    // Message\n    initMessage(){\n        this.messageDialog = document.createElement('div');\n        this.messageDialog.classList.add(\"event-message\");\n        this.messageContent = document.createElement('div');\n        this.messageContent.classList.add(\"event-message__content\");\n\n        let messageClose = document.createElement('div');\n        messageClose.classList.add(\"event-message__btn\");\n        messageClose.addEventListener(\"click\", ()=> {\n            this.hideMessage();\n        });\n\n        this.messageDialog.appendChild(this.messageContent);\n        this.messageDialog.appendChild(messageClose);\n        this.eventsRootContainer.appendChild(this.messageDialog);\n    }\n\n    showMessage(message, hideMessageWithoutDelay){\n        if(message.length){\n            this.hideMessageWithoutDelay = hideMessageWithoutDelay;\n            this.messageContent.innerHTML = message;\n            this.messageDialog.classList.add(\"event-message-visible\");\n            if (this.messageTimeout) {\n                clearTimeout(this.messageTimeout); // Clear timeout if before 'hideMessageWithDelay' was called\n            }\n        }\n    }\n\n    hideMessageWithDelay(delay){\n        if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout if this method was called before\n        this.messageTimeout = setTimeout(()=>{\n            this.hideMessage();\n        }, delay);\n    }\n\n    hideMessage(){\n        if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout and hide message immediately.\n        this.messageDialog.classList.remove(\"event-message-visible\");\n    }\n    // End message\n\n    AdditionalElements(){\n        var legalNoticeContent = document.createTextNode('Legal Notice'),\n            legalNotice = document.createElement(\"a\");\n        legalNotice.appendChild(legalNoticeContent);\n        legalNotice.classList.add(\"legal-notice\");\n        legalNotice.target = '_blank';\n        legalNotice.href = this.legalNoticeUrl;\n        this.widgetRoot.appendChild(legalNotice);\n\n        var logo = document.createElement('a');\n        logo.classList.add(\"event-logo\",\"centered-logo\");\n        logo.target = '_blank';\n        logo.href = this.logoUrl;\n        logo.innerHTML = 'Powered by ';\n\n        var logoBox = document.createElement('div');\n        logoBox.classList.add(\"event-logo-box\");\n        logoBox.appendChild(logo);\n        this.eventsRootContainer.appendChild(logoBox);\n\n        let question = document.createElement('a');\n        question.classList.add(\"event-question\");\n        question.target = '_blank';\n        question.href = this.questionUrl;\n        this.eventsRootContainer.appendChild(question);\n    }\n\n    //adds general admission element for OLDSCHOOL theme\n    oldSchoolModificator(){\n\n        var generalAdmissionWrapper = document.createElement(\"div\");\n        generalAdmissionWrapper.classList.add(\"general-admission\", \"modificator\");\n\n        var generalAdmission = document.createElement(\"div\"),\n            generalAdmissionText = document.createTextNode('GENERAL ADMISSION');\n        generalAdmission.appendChild(generalAdmissionText);\n        generalAdmissionWrapper.appendChild(generalAdmission);\n\n        this.eventsRootContainer.appendChild(generalAdmissionWrapper);\n    }\n\n    newSchoolModificator(){\n        var ticketLogo = document.createElement(\"div\");\n        ticketLogo.classList.add(\"ticket-logo\", \"modificator\");\n\n        for(let i = 0; i < 4; i++){\n            let headLogo = document.createElement(\"img\");\n            headLogo.setAttribute(\"src\", this.portalUrl + \"assets/widgets/1.0.0/img/ticketmaster-logo-white.svg\");\n            headLogo.setAttribute(\"height\", \"11\");\n            ticketLogo.appendChild(headLogo);\n        }\n\n        this.eventsRootContainer.appendChild(ticketLogo);\n    }\n\n\n    formatDate(date) {\n        var result = '';\n        if(!date.day) return result; // Day is required\n\n        function LZ(x) {\n            return (x < 0 || x > 9 ? \"\" : \"0\") + x\n        }\n        var MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\n            DAY_NAMES = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\n            dayArray = date.day.split('-'),\n            d = parseInt(dayArray[2]),\n            M = parseInt(dayArray[1]);\n\n        // var E = new Date(date.day).getDay();\n        var E = new Date(+date.day.split('-')[0],(+date.day.split('-')[1])-1,+date.day.split('-')[2]).getDay();\n        result = DAY_NAMES[E] + ', ' + MONTH_NAMES[M - 1] + ' ' + d + ', ' + dayArray[0];\n\n        if(!date.time) return result;\n\n        var timeArray = date.time.split(':'),\n            H = parseInt(timeArray[0]),\n            m = timeArray[1],\n            a = \"AM\";\n\n        if (H > 11) a = \"PM\";\n        if (H == 0) {\n            H = 12;\n        } else if (H > 12) {\n            H = H - 12;\n        }\n\n        return result + ' ' + LZ(H) + ':' + m + ' ' + a;\n    }\n\n    clearEvents(){\n        this.eventsRoot.innerHTML = \"\";\n    }\n\n    clear(){\n        var modificatorList = this.widgetRoot.getElementsByClassName('modificator');\n        while (modificatorList.length) {\n            let el = modificatorList[0],\n                parent = el.parentNode;\n            parent.removeChild(el);\n        }\n\n\n        if(!this.isListView) {\n            var eventsRootContainer = document.getElementsByClassName(\"events-root-container\")[0];\n            var eventsRoot = document.getElementsByClassName(\"events-root\")[0];\n            /*\n            var ss = document.getElementsByClassName(\"ss\")[0];\n            ss.parentNode.removeChild(ss);\n\n            var ssDiv = document.createElement(\"div\");\n            ssDiv.setAttribute(\"class\", \"ss\");\n            eventsRootContainer.appendChild(ssDiv);\n\n            var ssDiv = document.getElementsByClassName(\"ss\")[0];\n            ssDiv.appendChild(eventsRoot);\n            */\n\n            var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\n            eventsRootContainer.classList.remove(\"listview-after\");\n        }\n\n        if(this.isListView) {\n            var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\n            eventsRootContainer.classList.add(\"listview-after\");\n        }\n\n\n        this.clearEvents();\n    }\n\n    update() {\n\n        let oldTheme = this.config.constructor();\n        for (let attr in this.config) {\n            if (this.config.hasOwnProperty(attr)) oldTheme[attr] = this.config[attr];\n        }\n\n        this.config = this.widgetRoot.attributes;\n\n        /*if(this.config.theme !== null){\n         this.makeRequest( this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\" );\n         }*/\n\n        this.widgetRoot.style.height = `${this.widgetHeight}px`;\n        this.widgetRoot.style.width  = `${this.config.width}px`;\n        this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\n        this.eventsRootContainer.style.width  = `${this.config.width}px`;\n        this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\n        this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\n\n        this.eventsRootContainer.classList.remove(\"border\");\n        if( this.config.hasOwnProperty(\"border\") ){\n            this.eventsRootContainer.classList.add(\"border\");\n        }\n\n        if(this.needToUpdate(this.config, oldTheme, this.updateExceptions)){\n            this.clear();\n\n            if( this.themeModificators.hasOwnProperty( this.widgetConfig.theme ) ) {\n                this.themeModificators[ this.widgetConfig.theme ]();\n            }\n\n            this.getCoordinates(() => {\n                this.makeRequest( this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs );\n            });\n\n            if(this.isListView) this.addScroll();\n        }\n        else{\n            let events = this.eventsRoot.getElementsByClassName(\"event-wrapper\");\n            for(let i in events){\n                if(events.hasOwnProperty(i) && events[i].style !== undefined){\n                    events[i].style.width = `${this.config.width - this.borderSize * 2}px`;\n                    events[i].style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\n                }\n            }\n        }\n\n    }\n\n    needToUpdate(newTheme, oldTheme, forCheck = []){\n        return Object.keys(newTheme).map(function(key){\n                if(forCheck.indexOf(key) > -1) return true;\n                //console.warn([key, newTheme[key], oldTheme[key], newTheme[key] === oldTheme[key]])\n                return newTheme[key] === oldTheme[key] ;\n            }).indexOf(false) > -1\n    }\n\n    loadConfig(NamedNodeMap){\n        var config = {};\n        Object.keys(NamedNodeMap).map(function(value){\n            if( typeof(NamedNodeMap[value].name) !== \"undefined\" && NamedNodeMap[value].name.indexOf(\"w-\") !== -1){\n                config[ NamedNodeMap[value].name.replace(/w-/g, \"\").replace(/-/g, \"\") ] = NamedNodeMap[value].value;\n            }\n        });\n        return config;\n    }\n\n    styleLoadingHandler(){\n        if (this && this.readyState == XMLHttpRequest.DONE ) {\n            if(this.status == 200){\n                var style = document.createElement(\"style\");\n                style.setAttribute(\"type\",\"text/css\");\n                style.setAttribute(\"id\",`widget-theme-${this.widget.config.theme}`);\n                style.textContent = this.responseText;\n                document.getElementsByTagName(\"head\")[0].appendChild(style);\n            }\n            else {\n                //alert(\"theme wasn't loaded\");\n                console.log(\"theme wasn't loaded\");\n            }\n        }\n    }\n\n    groupEventsByName(){\n        let groups = {};\n        this.events.map(function(event){\n            if (groups[event.name] === undefined) groups[event.name] = [];\n            groups[event.name].push(event);\n        });\n\n        this.eventsGroups = [];\n        for (let groupName in groups) {\n            this.eventsGroups.push(groups[groupName]);\n        }\n    }\n\n    resetReduceParamsOrder(){\n        this.reduceParamsOrder = 0;\n    }\n\n    reduceParamsAndReloadEvents(){\n        let eventReqAttrs = {},\n            reduceParamsList = [\n                ['classificationName'],\n                ['city'],\n                ['countryCode'],\n                ['source'],\n                ['startDateTime', 'endDateTime', 'country'],\n                ['radius'],\n                ['postalCode', 'latlong'],\n                ['attractionId'],\n                ['promoterId'],\n                // ['segmentId'],\n                ['venueId'],\n                ['keyword'],\n                ['size']\n            ];\n\n        // make copy of params\n        for(let key in this.eventReqAttrs){\n            eventReqAttrs[key] = this.eventReqAttrs[key]\n        }\n\n        if(!this.reduceParamsOrder) this.reduceParamsOrder = 0;\n        if(reduceParamsList.length > this.reduceParamsOrder){\n            for(let item in reduceParamsList){\n                if(this.reduceParamsOrder >= item){\n                    for(let i in reduceParamsList[item]){\n                        delete eventReqAttrs[reduceParamsList[item][i]];\n                    }\n                }\n            }\n\n            if(this.reduceParamsOrder === 0) this.showMessage(\"No results were found.<br/>Here other options for you.\");\n            this.reduceParamsOrder++;\n            this.makeRequest( this.eventsLoadingHandler, this.apiUrl, eventReqAttrs );\n        }else{\n            // We haven't any results\n            this.showMessage(\"No results were found.\", true);\n            this.reduceParamsOrder = 0;\n        }\n    }\n\n    setMarkers(map, markers) {\n\n        var infowindow = new google.maps.InfoWindow({\n            content: \" \"\n        });\n\n        for (var i = 0; i < markers.length; i++) {\n            let sites = markers[i];\n            if (sites !== undefined) {\n                var siteLatLng = new google.maps.LatLng(sites[1], sites[2]);\n                var marker = new google.maps.Marker({\n                    position: siteLatLng,\n                    map: map,\n                    title: sites[0],\n                    zIndex: sites[3],\n                    html: sites[4]\n                });\n            }\n            google.maps.event.addListener(marker, \"click\", function () {\n                infowindow.setContent(this.html);\n                infowindow.open(map, this);\n            });\n        }\n    }\n\n    eventsLoadingHandler(){\n        let widget = this.widget;\n        var markers = [];\n        widget.clearEvents(); // Additional clearing after each loading\n        if (this && this.readyState == XMLHttpRequest.DONE ) {\n            if(this.status == 200){\n                widget.events = JSON.parse(this.responseText);\n                if(widget.events.length){\n\n                    var myLatLng = {lat: 43.646632, lng: -79.390205};\n\n                    var map = new google.maps.Map(document.getElementById('map'), {\n                        zoom: 4,\n                        center: myLatLng,\n                        mapTypeId: google.maps.MapTypeId.ROADMAP\n                    });\n\n                    widget.groupEventsByName.call(widget);\n\n                    widget.eventsGroups.map(function(group, i){\n                        if(group.length === 1) {\n                            // widget.publishEvent(group[0]);\n                            markers[i] = [\n                                group[0].name,\n                                group[0].location.lat,\n                                group[0].location.lng,\n                                i,\n                                'This is ' + group[0].name\n                            ];\n                        }\n                        else\n                            widget.publishEventsGroup.call(widget, group, i);\n                    });\n\n                    widget.setMarkers(map ,markers);\n\n\n                    widget.resetReduceParamsOrder();\n                    if(widget.hideMessageWithoutDelay)\n                        widget.hideMessage();\n                    else\n                        widget.hideMessageWithDelay(widget.hideMessageDelay);\n                }else{\n                    widget.reduceParamsAndReloadEvents.call(widget);\n                }\n            }\n            else if(this.status == 400) {\n                widget.reduceParamsAndReloadEvents.call(widget);\n                console.log('There was an error 400');\n            }\n            else {\n                widget.reduceParamsAndReloadEvents.call(widget);\n                console.log('something else other than 200 was returned');\n            }\n        }\n    }\n\n    publishEventsGroup(group, index){\n        /*\n        let groupNodeWrapper = document.createElement(\"li\");\n        groupNodeWrapper.classList.add(\"event-wrapper\");\n        groupNodeWrapper.classList.add(\"event-group-wrapper\");\n        groupNodeWrapper.style.width  = `${this.config.width - this.borderSize * 2}px`;\n        groupNodeWrapper.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\n\n        let groupNode = document.createElement(\"ul\");\n        groupNode.classList.add(\"event-group\");\n        groupNode.classList.add(\"event-group-\" + index);\n\n        group.map((event)=> {\n            this.publishEvent(event, groupNode)\n        });\n\n        groupNodeWrapper.appendChild(groupNode);\n        this.eventsRoot.appendChild(groupNodeWrapper);\n        */\n    }\n\n    publishEvent(event, parentNode){\n        /*\n        parentNode = parentNode || this.eventsRoot;\n        let DOMElement = this.createDOMItem(event);\n        parentNode.appendChild(DOMElement);\n        */\n        console.log(event);\n    }\n\n    getEventByID(id){\n        for(let index in this.events){\n            if(this.events.hasOwnProperty(index) && this.events[index].id === id){\n                return this.events[index]\n            }\n        }\n    }\n\n    getImageForEvent(images){\n        var width = this.config.width,\n            height = this.widgetContentHeight;\n\n        images.sort(function(a,b) {\n            if (a.width < b.width)\n                return -1;\n            else if (a.width > b.width)\n                return 1;\n            else\n                return 0;\n        });\n\n        var myImg = \"\";\n        images.forEach(function(element){\n            if(element.width >= width && element.height >= height && !myImg){\n                myImg = element.url;\n            }\n        });\n        return myImg;\n    }\n\n    parseEvents(eventsSet){\n        if(!eventsSet._embedded){\n            if(typeof($widgetModalNoCode) !== \"undefined\"){\n                $widgetModalNoCode.modal();\n            }\n            return [];\n        }\n        eventsSet = eventsSet._embedded.events;\n        var tmpEventSet = [];\n\n        for(var key in eventsSet){\n            if(eventsSet.hasOwnProperty(key)){\n                let currentEvent = {};\n\n                currentEvent.id = eventsSet[key].id;\n                currentEvent.url = eventsSet[key].url;\n                currentEvent.name = eventsSet[key].name;\n\n                /* Change URL [START] */\n                var parser = document.createElement(\"a\");\n                parser.href = currentEvent.url;\n                var expr= \"/ticketmaster.evyy.net/\";\n                if (parser.href.match(expr) !== null) {\n                    var changeURL = parser.pathname.split('/');\n                    changeURL[3] = '330564';\n                    currentEvent.url = parser.origin + changeURL.join('/') + parser.search + parser.hash;\n                }\n                /* Change URL [END] */\n\n                currentEvent.date = {\n                    day: eventsSet[key].dates.start.localDate,\n                    time: eventsSet[key].dates.start.localTime\n                };\n\n                if(eventsSet[key].hasOwnProperty('_embedded') && eventsSet[key]._embedded.hasOwnProperty('venues')){\n                    let venue = eventsSet[key]._embedded.venues[0];\n                    if(venue){\n                        if(venue.address)\n                            currentEvent.address = venue.address;\n\n                        if(venue.name) {\n                            if(!currentEvent.address) currentEvent.address = {};\n                            currentEvent.address.name = venue.name;\n                        }\n\n                        if (venue.location) {\n                            currentEvent.location = {\n                                lat: parseFloat(venue.location.latitude),\n                                lng: parseFloat(venue.location.longitude)\n                            };\n                        }\n                    }\n                }\n\n                // Remove this comment to get categories\n                /*if(eventsSet[key]._embedded.hasOwnProperty('categories')){\n                 currentEvent.categories = [];\n                 let eventCategories = eventsSet[key]._embedded.categories;\n                 currentEvent.categories = Object.keys(eventCategories).map(function(category){\n                 return eventCategories[category].name\n                 });\n                 }*/\n\n                currentEvent.img = this.getImageForEvent(eventsSet[key].images);\n                tmpEventSet.push(currentEvent);\n\n            }\n        }\n        return tmpEventSet;\n    }\n\n    makeRequest(handler, url=this.apiUrl, attrs={}, method=\"GET\"){\n        attrs = Object.keys(attrs).map(function(key){\n            return `${key}=${attrs[key]}`;\n        }).join(\"&\");\n\n        url = [url,attrs].join(\"?\");\n\n        this.xmlHTTP = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\");\n        if(method == \"POST\") {\n            this.xmlHTTP.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n        }\n        this.xmlHTTP.widget = this;\n        this.xmlHTTP.onreadystatechange = handler;\n        this.xmlHTTP.open(method, url, true);\n        this.xmlHTTP.send();\n    }\n\n    initPretendedLink(el, url, isBlank){\n        if(el && url){\n            el.setAttribute('data-url', url);\n            el.classList.add(\"event-pretended-link\");\n            el.addEventListener('click', function(){\n                let url = this.getAttribute('data-url');\n                if(url){\n                    let win = window.open(url, (isBlank ? '_blank' : '_self'));\n                    win.focus();\n                }\n            });\n            el.addEventListener('touchstart', function(){\n                let url = this.getAttribute('data-url');\n                if(url){\n                    let win = window.open(url, (isBlank ? '_blank' : '_self'));\n                    win.focus();\n                }\n            });\n        }\n        return el;\n    }\n\n    createBackgroundImage(event, img) {\n        if (!this.isListView) {\n            var image = document.createElement(\"span\");\n            image.classList.add(\"bg-cover\");\n            image.style.backgroundImage = `url('${img}')`;\n            event.appendChild(image);\n        }\n    }\n\n    addBarcode(domNode, url) {\n        if (this.isBarcodeWidget) {\n            let barcodeBtn = document.createElement(\"a\");\n            barcodeBtn.classList.add(\"barcode\");\n            barcodeBtn.target = '_blank';\n            barcodeBtn.href = url;\n            barcodeBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickEventName', 'click');\");\n            domNode.appendChild(barcodeBtn);\n            let bottomBg = document.createElement(\"span\");\n            bottomBg.classList.add(\"barcode-bottom\");\n            domNode.appendChild(bottomBg);\n        }\n    }\n\n    addBuyButton(domNode, url) {\n        if (this.isListView) {\n            let _urlValid = ( this.isUniversePluginInitialized && this.isUniverseUrl(url) ) || ( this.isTMPluginInitialized && this.isAllowedTMEvent(url) );\n            if(!_urlValid) url = '';\n            let buyBtn = document.createElement(\"a\");\n            buyBtn.appendChild(document.createTextNode('BUY NOW'));\n            buyBtn.classList.add(\"event-buy-btn\");\n            buyBtn.target = '_blank';\n            buyBtn.href = url;\n            buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\n            domNode.appendChild(buyBtn);\n        }\n    }\n\n    addScroll() {\n        (function(n,t){function u(n){n.hasOwnProperty(\"data-simple-scrollbar\")||Object.defineProperty(n,\"data-simple-scrollbar\",new SimpleScrollbar(n))}function e(n,i){function f(n){var t=n.pageY-u;u=n.pageY;r(function(){i.el.scrollTop+=t/i.scrollRatio})}function e(){n.classList.remove(\"ss-grabbed\");t.body.classList.remove(\"ss-grabbed\");t.removeEventListener(\"mousemove\",f);t.removeEventListener(\"mouseup\",e)}var u;n.addEventListener(\"mousedown\",function(i){return u=i.pageY,n.classList.add(\"ss-grabbed\"),t.body.classList.add(\"ss-grabbed\"),t.addEventListener(\"mousemove\",f),t.addEventListener(\"mouseup\",e),!1})}function i(n){for(this.target=n,this.bar='<div class=\"ss-scroll\">',this.wrapper=t.createElement(\"div\"),this.wrapper.setAttribute(\"class\",\"ss-wrapper\"),this.el=t.createElement(\"div\"),this.el.setAttribute(\"class\",\"ss-content\"),this.wrapper.appendChild(this.el);this.target.firstChild;)this.el.appendChild(this.target.firstChild);this.target.appendChild(this.wrapper);this.target.insertAdjacentHTML(\"beforeend\",this.bar);this.bar=this.target.lastChild;e(this.bar,this);this.moveBar();this.el.addEventListener(\"scroll\",this.moveBar.bind(this));this.el.addEventListener(\"mouseenter\",this.moveBar.bind(this));this.target.classList.add(\"ss-container\")}function f(){for(var i=t.querySelectorAll(\"*[ss-container]\"),n=0;n<i.length;n++)u(i[n])}var r=n.requestAnimationFrame||n.setImmediate||function(n){return setTimeout(n,0)};i.prototype={moveBar:function(){var t=this.el.scrollHeight,i=this.el.clientHeight,n=this;this.scrollRatio=i/t;r(function(){n.bar.style.cssText=\"height:\"+i/t*100+\"%; top:\"+n.el.scrollTop/t*100+\"%;right:-\"+(n.target.clientWidth-n.bar.clientWidth)+\"px;\"})}};t.addEventListener(\"DOMContentLoaded\",f);i.initEl=u;i.initAll=f;n.SimpleScrollbar=i})(window,document)\n        // var scrollRoot = document.getElementsByClassName(\"ss\")[0];\n        var scrollRoot = document.querySelector('.ss');\n        SimpleScrollbar.initEl(scrollRoot);\n    }\n\n    createDOMItem(itemConfig){\n        var medWrapper = document.createElement(\"div\");\n        medWrapper.classList.add(\"event-content-wraper\");\n\n        var event = document.createElement(\"li\");\n        event.classList.add(\"event-wrapper\");\n        event.style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\n        event.style.width  = `${this.config.width - this.borderSize * 2}px`;\n\n        this.createBackgroundImage(event, itemConfig.img);\n\n        var nameContent = document.createTextNode(itemConfig.name),\n            name =  document.createElement(\"span\");\n        name.classList.add(\"event-name\");\n        name.appendChild(nameContent);\n        this.initPretendedLink(name, itemConfig.url, true);\n        name.setAttribute('onclick', `ga('send', 'event', 'DiscoveryClickeventName_theme=${this.config.theme}_width=${this.config.width}_height=${this.config.height}_color_scheme=${this.config.colorscheme}', 'click', '${itemConfig.url}');`);\n        /* name.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickeventName', 'click', '\" + itemConfig.url + \"');\"); */\n        medWrapper.appendChild(name);\n\n        this.addBarcode(event, itemConfig.url);\n        this.addBuyButton(medWrapper, itemConfig.url);\n\n        var dateTimeContent = document.createTextNode(this.formatDate(itemConfig.date)),\n            dateTime = document.createElement(\"span\");\n        dateTime.classList.add(\"event-date\", \"centered-logo\");\n        dateTime.appendChild(dateTimeContent);\n\n        var dateWraper = document.createElement(\"span\");\n        dateWraper.classList.add(\"event-date-wraper\");\n        dateWraper.appendChild(dateTime);\n        medWrapper.appendChild(dateWraper);\n\n        if(itemConfig.hasOwnProperty(\"address\")){\n            var addressWrapper = document.createElement(\"span\");\n            addressWrapper.classList.add(\"address-wrapper\");\n\n            if( itemConfig.address.hasOwnProperty(\"name\") ){\n                var addressNameText = document.createTextNode(itemConfig.address.name),\n                    addressName =  document.createElement(\"span\");\n                addressName.classList.add(\"event-address\");\n                addressName.classList.add(\"event-address-name\");\n                addressName.appendChild(addressNameText);\n                addressWrapper.appendChild(addressName);\n            }\n\n            if( itemConfig.address.hasOwnProperty(\"line1\") ){\n                var addressOneText = document.createTextNode(itemConfig.address.line1),\n                    addressOne =  document.createElement(\"span\");\n                addressOne.classList.add(\"event-address\");\n                addressOne.appendChild(addressOneText);\n                addressWrapper.appendChild(addressOne);\n            }\n\n            if( itemConfig.address.hasOwnProperty(\"line2\") ){\n                var addressTwoText = document.createTextNode(itemConfig.address.line2),\n                    addressTwo =  document.createElement(\"span\");\n                addressTwo.classList.add(\"event-address\");\n                addressTwo.appendChild(addressTwoText);\n                addressWrapper.appendChild(addressTwo);\n            }\n\n            medWrapper.appendChild(addressWrapper);\n        }\n\n        if(itemConfig.hasOwnProperty(\"categories\")) {\n            var categoriesWrapper = document.createElement(\"span\");\n            categoriesWrapper.classList.add(\"category-wrapper\");\n\n            itemConfig.categories.forEach(function (element) {\n                var categoryText = document.createTextNode(element),\n                    category = document.createElement(\"span\");\n                category.classList.add(\"event-category\");\n                category.appendChild(categoryText);\n                categoriesWrapper.appendChild(category);\n            });\n            medWrapper.appendChild(categoriesWrapper);\n        }\n\n        event.appendChild(medWrapper);\n\n        return event;\n    }\n\n    makeImageUrl(id){\n        return `https://app.ticketmaster.com/discovery/v2/events/${id}/images.json`;\n    }\n\n\n    /*\n     * Config block\n     */\n\n    decConfig(config){\n        return JSON.parse(window.atob(config));\n    }\n\n    encConfig(config){\n        return window.btoa(config);\n    }\n\n    toShortISOString(dateObj){\n        return dateObj.getFullYear() +\n            \"-\" + (dateObj.getMonth() + 1 < 10 ? \"0\"+ (dateObj.getMonth()+ 1): dateObj.getMonth() + 1) +\n            \"-\" + (dateObj.getDate() < 10 ? \"0\"+ dateObj.getDate(): dateObj.getDate()) +\n            \"T\" + (dateObj.getHours() < 10 ? \"0\"+dateObj.getHours(): dateObj.getHours()) +\n            \":\" + (dateObj.getMinutes() < 10 ? \"0\"+dateObj.getMinutes(): dateObj.getMinutes()) +\n            \":\" + (dateObj.getSeconds() < 10 ? \"0\"+dateObj.getSeconds(): dateObj.getSeconds()) +\n            \"Z\";\n    }\n\n    getDateFromPeriod(period){\n\n        var period = period.toLowerCase(),\n            firstDay, lastDay;\n\n        if(period == \"year\" ) {\n            // firstDay = new Date( new Date(new Date()).toISOString() );\n            // lastDay = new Date( new Date(new Date().valueOf()+24*365*60*60*1000).toISOString() );\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\n            lastDay = new Date(new Date().valueOf()+24*365*60*60*1000).toISOString().slice(0,19) + 'Z';\n        }\n        else if(period == \"month\") {\n            // firstDay = new Date( new Date(new Date()).toISOString() );\n            // lastDay = new Date( new Date(new Date().valueOf()+24*31*60*60*1000).toISOString() );\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\n            lastDay = new Date(new Date().valueOf()+24*31*60*60*1000).toISOString().slice(0,19) + 'Z';\n        }\n        else if(period == \"week\") {\n            // firstDay = new Date( new Date(new Date()).toISOString() );\n            // lastDay = new Date( new Date(new Date().valueOf()+24*7*60*60*1000).toISOString() );\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\n            lastDay = new Date(new Date().valueOf()+24*7*60*60*1000).toISOString().slice(0,19) + 'Z';\n        } else {\n            // firstDay = new Date( new Date(new Date()).toISOString() );\n            // lastDay = new Date( new Date(new Date().valueOf()+24*60*60*1000).toISOString() );\n            firstDay = new Date().toISOString().slice(0,19) + 'Z';\n            lastDay = new Date(new Date().valueOf()+24*60*60*1000).toISOString().slice(0,19) + 'Z';\n        }\n\n        // return [this.toShortISOString(firstDay), this.toShortISOString(lastDay)];\n        return [firstDay, lastDay];\n    }\n\n}\nlet widgetsEventDiscovery = [];\n(function () {\n    let widgetContainers = document.querySelectorAll(\"div[w-type='event-discovery']\");\n    for (let i = 0; i < widgetContainers.length; ++i) {\n        widgetsEventDiscovery.push(new TicketmasterEventDiscoveryWidget(widgetContainers[i]));\n    }\n\n})();\n\n(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\nga('create', 'UA-78315612-1', 'auto');\nga('send', 'pageview');\n"]}