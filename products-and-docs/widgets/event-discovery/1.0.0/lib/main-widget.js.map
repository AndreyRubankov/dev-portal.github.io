{"version":3,"sources":["../src/main-widget.es6"],"names":["TicketmasterEventDiscoveryWidget","attr","config","hasOwnProperty","attrs","widgetConfig","loadConfig","responce","eventsList","parseEvents","theme","layout","proportion","border","height","widgetHeight","isListView","isListViewThumbnails","isSimpleProportionM","isFullWidth","window","location","host","WidgetRoot","eventsRootContainer","parentNode","params","verboseName","i","item","isConfigAttrExistAndNotEmpty","latlong","replace","period","getDateFromPeriod","startDateTime","endDateTime","getAttribute","root","widgetRoot","querySelector","document","createElement","classList","add","appendChild","eventsRootDiv","setAttribute","eventsRoot","themeModificators","oldSchoolModificator","bind","newSchoolModificator","listViewModificator","attributes","listenerResize","getElementById","makeRequest","styleLoadingHandler","themeUrl","remove","style","width","widgetContentHeight","borderRadius","borderradius","borderWidth","borderSize","AdditionalElements","getCoordinates","eventsLoadingHandler","apiUrl","eventReqAttrs","embedUniversePlugin","embedTMPlugin","initBuyBtn","initMessage","initSliderControls","initEventCounter","addScroll","cb","widget","parseGoogleGeocodeResponse","readyState","XMLHttpRequest","DONE","results","countryShortName","status","response","JSON","parse","responseText","length","filter","countriesWhiteList","elem","address_components","long_name","sort","f","g","a","b","geometry","short_name","country","result","lat","lng","onLoadCoordinate","args","language","components","postalcode","googleapikey","key","geocodeUrl","buyBtn","createTextNode","target","href","addEventListener","e","stopAutoSlideX","url","isAddressCenter","el","querySelectorAll","event","eventsGroups","currentSlideX","currentSlideY","isUniversePluginInitialized","isUniverseUrl","isTMPluginInitialized","isAllowedTMEvent","updateTransition","match","t","n","r","id","tmWidgetWhiteList","indexOf","script","portalUrl","head","getElementsByTagName","messageDialog","messageContent","messageClose","hideMessage","message","hideMessageWithoutDelay","innerHTML","messageTimeout","clearTimeout","delay","setTimeout","legalNoticeContent","legalNotice","legalNoticeUrl","logo","logoUrl","logoBox","question","toolTip","tooltipHtml","questionUrl","widgetVersion","toolTipHandler","preventDefault","nextSibling","toggle","generalAdmissionWrapper","generalAdmission","generalAdmissionText","ticketLogo","headLogo","prevEventX","controlHiddenClass","nextEventX","prevEventY","nextEventY","slideCountX","setSlideManually","slideIndex","isDirectionX","sliderTimeout","runAutoSlideX","sliderRestartDelay","goToSlideX","goToSlideY","marginLeft","toggleControlsVisibility","setEventsCounter","setBuyBtnUrl","eventGroup","getElementsByClassName","marginTop","sliderInterval","setInterval","sliderDelay","clearInterval","coreCssClass","prevEventXClass","nextEventXClass","prevEventYClass","nextEventYClass","whichTransitionEvent","transitions","undefined","transitionEvent","prevSlideX","nextSlideX","prevSlideY","nextSlideY","xDown","yDown","handleTouchStart","evt","touches","clientX","clientY","handleTouchMove","xUp","yUp","xDiff","yDiff","Math","abs","className","call","offsetWidth","resizeThrottler","resizeTimeout","actualResizeHandler","list","forEach","me","push","removeEventListener","pop","heightStatic","display","date","day","LZ","x","MONTH_NAMES","DAY_NAMES","dayArray","split","d","parseInt","M","E","Date","getDay","time","timeArray","H","m","modificatorList","parent","removeChild","ss","ssDiv","clearEvents","oldTheme","constructor","needToUpdate","updateExceptions","clear","events","newTheme","forCheck","Object","keys","map","NamedNodeMap","value","name","textContent","console","log","groups","groupName","eventsCounter","text","reduceParamsOrder","reduceParamsList","showMessage","hideSliderControls","initFullWidth","groupEventsByName","group","publishEvent","publishEventsGroup","initSlider","resetReduceParamsOrder","hideMessageWithDelay","hideMessageDelay","reduceParamsAndReloadEvents","index","groupNodeWrapper","groupNode","DOMElement","createDOMItem","images","isGetSmallest","isSecondSmallest","myImg","element","eventsSet","_embedded","$widgetModalNoCode","modal","tmpEventSet","currentEvent","parser","expr","changeURL","pathname","origin","join","search","hash","dates","start","localDate","localTime","venue","venues","address","img","getImageForEvent","handler","method","xmlHTTP","ActiveXObject","setRequestHeader","onreadystatechange","open","send","isBlank","win","focus","image","backgroundImage","wrapperImg","domNode","isBarcodeWidget","barcodeBtn","bottomBg","_urlValid","u","defineProperty","SimpleScrollbar","pageY","scrollTop","scrollRatio","body","bar","wrapper","firstChild","insertAdjacentHTML","lastChild","moveBar","requestAnimationFrame","setImmediate","prototype","scrollHeight","clientHeight","cssText","clientWidth","initEl","initAll","scrollRoot","itemConfig","medWrapper","createBackgroundImage","titleLink","nameContent","initPretendedLink","colorscheme","addBarcode","addBuyButton","dateTimeContent","formatDate","dateTime","dateWraper","addressWrapper","addressNameText","addressName","addressOneText","line1","addressOne","addressTwoText","line2","addressTwo","categoriesWrapper","categories","categoryText","category","atob","btoa","dateObj","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","toLowerCase","firstDay","lastDay","toISOString","slice","valueOf","widgetsEventDiscovery","widgetContainers","s","o","q","arguments","l","async","src","insertBefore","ga","module","exports"],"mappings":"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","file":"main-widget.js","sourcesContent":["class TicketmasterEventDiscoveryWidget {\n\n  set config(attrs) { this.widgetConfig = this.loadConfig(attrs); }\n  get config() { return this.widgetConfig; }\n\n  set events(responce){ this.eventsList = this.parseEvents(responce);}\n  get events(){ return this.eventsList;}\n\n  get isListView() { return this.config.theme === 'listview';}\n  get isListViewThumbnails() { return this.config.theme === 'listviewthumbnails';}\n  get isFullWidth() { return this.config.layout === 'fullwidth';}\n  get isPosterTheme() { return this.config.layout === 'simple';}\n  get isBarcodeWidget() { return (this.config.theme === 'oldschool' || this.config.theme === 'newschool');}\n  get isSimpleProportionM() { return this.config.proportion === 'm'}\n  get borderSize(){ return this.config.border || 0;}\n  get widgetHeight(){ return this.config.height || 600;}\n\n  get widgetContentHeight() {\n    return this.widgetHeight - (this.isListView || this.isListViewThumbnails || this.isSimpleProportionM || this.isFullWidth ? 0 : 39) || 600;\n  }\n\n  get eventUrl(){ return \"https://www.ticketmaster.com/event/\"; }\n\n  get apiUrl(){ return \"https://app.ticketmaster.com/discovery/v2/events.json\"; }\n\n  get themeUrl() {\n    return (window.location.host === 'developer.ticketmaster.com')\n      ? `https://developer.ticketmaster.com/products-and-docs/widgets/event-discovery/1.0.0/theme/`\n      : `https://ticketmaster-api-staging.github.io/products-and-docs/widgets/event-discovery/1.0.0/theme/`;\n  }\n\n  get portalUrl(){\n    return (window.location.host === 'developer.ticketmaster.com')\n      ? `https://developer.ticketmaster.com/`\n      : `https://ticketmaster-api-staging.github.io/`;\n  }\n\n  get logoUrl() { return \"https://www.ticketmaster.com/\"; }\n\n  get legalNoticeUrl() { return \"http://developer.ticketmaster.com/support/terms-of-use/\"; }\n\n  get questionUrl() { return \"http://developer.ticketmaster.com/support/faq/\"; }\n\n  get widgetVersion() { return \"1.0.0\"; }\n\n  get geocodeUrl() { return \"https://maps.googleapis.com/maps/api/geocode/json\"; }\n\n  get updateExceptions() { return [\"width\", \"height\", \"border\", \"borderradius\", \"colorscheme\", \"layout\", \"affiliateid\", \"propotion\", \"googleapikey\"]}\n\n  get sliderDelay(){ return 5000; }\n\n  get sliderRestartDelay(){ return 5000; }\n\n  get hideMessageDelay(){ return 5000; }\n\n  get controlHiddenClass(){ return \"events_control-hidden\"; }\n\n  get tmWidgetWhiteList(){ return [\"2200504BAD4C848F\", \"00005044BDC83AE6\", \"1B005068DB60687F\", \"1B004F4DBEE45E47\", \"3A004F4ED7829D5E\", \"3A004F4ED1FC9B63\", \"1B004F4FF83289C5\", \"1B004F4FC0276888\", \"0E004F4F3B7DC543\", \"1D004F4F09C61861\", \"1600505AC9A972A1\", \"22004F4FD82795C6\", \"01005057AFF54574\", \"01005056FAD8793A\", \"3A004F4FB2453240\", \"22004F50D2149AC6\", \"01005059AD49507A\", \"01005062B4236D5D\"]; }\n\n  get countriesWhiteList() {\n    return [\n      'Australia',\n      'Austria',\n      'Belgium',\n      'Canada',\n      'Denmark',\n      'Finland',\n      'France',\n      'Germany',\n      'Ireland',\n      'Mexico',\n      'Netherlands',\n      'New Zealand',\n      'Norway',\n      'Spain',\n      'Sweden',\n      'Turkey',\n      'UAE',\n      'United Kingdom',\n      'United States'\n    ]\n  }\n\n  isConfigAttrExistAndNotEmpty(attr) {\n    if( !this.config.hasOwnProperty(attr) || this.config[attr] === \"undefined\"){\n      return false;\n    }else if( this.config[attr] === \"\"){\n      return false;\n    }\n    return true;\n  }\n  \n  get eventReqAttrs(){\n    let WidgetRoot = this.eventsRootContainer.parentNode;\n    let attrs = {},\n    params = [\n      {\n        attr: 'tmapikey',\n        verboseName: 'apikey'\n      },\n      {\n          attr: 'latlong',\n          verboseName: 'latlong'\n      },\n      {\n        attr: 'keyword',\n        verboseName: 'keyword'\n      },\n      {\n        attr: 'size',\n        verboseName: 'size'\n      },\n      {\n        attr: 'radius',\n        verboseName: 'radius'\n      },\n      {\n        attr: 'attractionid',\n        verboseName: 'attractionId'\n      },\n      {\n        attr: 'promoterid',\n        verboseName: 'promoterId'\n      },\n      {\n        attr: 'venueid',\n        verboseName: 'venueId'\n      },\n      {\n        attr: 'classificationname',\n        verboseName: 'classificationName'\n      },\n      {\n        attr: 'city',\n        verboseName: 'city'\n      },\n      {\n        attr: 'countrycode',\n        verboseName: 'countryCode'\n      },\n      {\n        attr: 'source',\n        verboseName: 'source'\n      }\n    ];\n\n    for(let i in params){\n      let item = params[i];\n      if(this.isConfigAttrExistAndNotEmpty(item.attr))\n        attrs[item.verboseName] = this.config[item.attr];\n    }\n\n    if(this.config.latlong){\n        attrs.latlong = this.config.latlong.replace(/\\s+/g, '');\n    }\n\n    if(this.isConfigAttrExistAndNotEmpty(\"period\")){\n      let period = this.getDateFromPeriod(this.config.period);\n      attrs.startDateTime = period[0];\n      attrs.endDateTime = period[1];\n    }\n\n    if (WidgetRoot.getAttribute(\"w-latlong\") != null) {\n        attrs.latlong = WidgetRoot.getAttribute(\"w-latlong\").replace(/\\s+/g, '');\n    }\n\n    if (attrs.latlong == ',') {\n        delete attrs.latlong;\n    }\n\n    if (attrs.latlong == null) {\n        delete attrs.latlong;\n    }\n\n  return attrs;\n  }\n\n  constructor(root) {\n    if(!root) return;\n    this.widgetRoot = root;\n    if (this.widgetRoot.querySelector('.events-root-container') === null) {\n        this.eventsRootContainer = document.createElement(\"div\");\n        this.eventsRootContainer.classList.add(\"events-root-container\");\n        this.widgetRoot.appendChild(this.eventsRootContainer);\n\n        this.eventsRootDiv = document.createElement(\"div\");\n        this.eventsRootDiv.setAttribute(\"class\", \"ss\");\n        this.eventsRootDiv.setAttribute(\"ss-container\", \"\");\n        this.eventsRootContainer.appendChild(this.eventsRootDiv);\n\n        this.eventsRoot = document.createElement(\"ul\");\n        this.eventsRoot.classList.add(\"events-root\");\n        this.eventsRootDiv.appendChild(this.eventsRoot);\n\n        // Set theme modificators\n        this.themeModificators = {\n            \"oldschool\": this.oldSchoolModificator.bind(this),\n            \"newschool\": this.newSchoolModificator.bind(this),\n            \"listview\": this.listViewModificator.bind(this),\n            \"listviewthumbnails\": this.listViewModificator.bind(this)\n        };\n\n        this.config = this.widgetRoot.attributes;\n        this.listenerResize = [];\n\n        if (this.config.theme !== null && !document.getElementById(`widget-theme-${this.config.theme}`)) {\n            this.makeRequest(this.styleLoadingHandler, this.themeUrl + this.config.theme + \".css\");\n        }\n\n        this.eventsRootContainer.classList.remove(\"border\");\n        if (this.config.border) {\n            this.eventsRootContainer.classList.add(\"border\");\n        }\n\n        this.widgetRoot.style.height = `${this.widgetHeight}px`;\n        this.widgetRoot.style.width = `${this.config.width}px`;\n\n        this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\n        this.eventsRootContainer.style.width = `${this.config.width}px`;\n        this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\n        this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\n\n        //this.clear();\n\n        this.AdditionalElements();\n\n        this.getCoordinates(() => {\n            this.makeRequest(this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs);\n        });\n\n        if (this.themeModificators.hasOwnProperty(this.widgetConfig.theme)) {\n            this.themeModificators[this.widgetConfig.theme]();\n        }\n\n      /*plugins for 'buy button'*/\n        this.embedUniversePlugin();\n        this.embedTMPlugin();\n\n        this.initBuyBtn();\n\n        this.initMessage();\n\n        if (!this.isListView || !this.isListViewThumbnails ) this.initSliderControls();\n\n        if (!this.isListView || !this.isListViewThumbnails ) this.initEventCounter();\n\n        if (this.isListView || this.isListViewThumbnails) this.addScroll();\n    }\n  }\n\n  /*\n  getCoordinates(cb){\n      let widget = this;\n      if(this.config.postalcode) {\n          widget.config.postalcode = this.config.postalcode;\n          cb(widget.config.postalcode);\n      }else{\n          // Used in builder\n          if(widget.onLoadCoordinate) widget.onLoadCoordinate(null);\n          widget.config.latlong = '';\n          // widget.config.countrycode = '';\n          cb(widget.config.latlong);\n      }\n  }\n  */\n\n  getCoordinates(cb){\n    let widget = this;\n\n    function parseGoogleGeocodeResponse(){\n      if (this && this.readyState === XMLHttpRequest.DONE ) {\n        let latlong = '',\n          results = null,\n          countryShortName = '';\n        if(this.status === 200) {\n          let response = JSON.parse(this.responseText);\n          if (response.status === 'OK' && response.results.length) {\n            // Filtering only white list countries\n            results = response.results.filter((item) => {\n              return widget.countriesWhiteList.filter((elem) => {\n                  return elem === item.address_components[item.address_components.length - 1].long_name;\n                }).length > 0;\n            });\n\n            if (results.length) {\n              // sorting results by country name\n              results.sort((f, g) => {\n                let a = f.address_components[f.address_components.length - 1].long_name;\n                let b = g.address_components[g.address_components.length - 1].long_name;\n                if (a > b) {\n                  return 1;\n                }\n                if (a < b) {\n                  return -1;\n                }\n                return 0;\n              });\n\n              // Use first item if multiple results was found in one country or in different\n              let geometry = results[0].geometry;\n              countryShortName = results[0].address_components[results[0].address_components.length - 1].short_name;\n\n              // If multiple results without country try to find USA as prefer value\n              if (!widget.config.country) {\n                for (let i in results) {\n                  let result = results[i];\n                  if (result.address_components) {\n                    let country = result.address_components[result.address_components.length - 1];\n                    if (country) {\n                      if (country.short_name === 'US') {\n                        countryShortName = 'US';\n                        geometry = result.geometry;\n                      }\n                    }\n                  }\n                }\n              }\n\n              if (geometry) {\n                if (geometry.location) {\n                  latlong = `${geometry.location.lat},${geometry.location.lng}`;\n                }\n              }\n            } else {\n              results = null;\n            }\n          }\n        }\n        // Used in builder\n        if(widget.onLoadCoordinate) widget.onLoadCoordinate(results, countryShortName);\n        widget.config.latlong = latlong;\n        cb(widget.config.latlong);\n      }\n    }\n\n    if(this.isConfigAttrExistAndNotEmpty('postalcode')){\n      let args = {language: 'en', components: `postal_code:${widget.config.postalcode}`};\n      if(widget.config.googleapikey) args.key = widget.config.googleapikey;\n      if(this.config.country) args.components += `|country:${this.config.country}`;\n      this.makeRequest( parseGoogleGeocodeResponse, this.geocodeUrl, args);\n    }else{\n      // Used in builder\n      if(widget.onLoadCoordinate) widget.onLoadCoordinate(null);\n      widget.config.latlong = '';\n      widget.config.country = '';\n      cb(widget.config.latlong);\n    }\n  }\n\n  initBuyBtn(){\n    this.buyBtn = document.createElement(\"a\");\n    this.buyBtn.appendChild(document.createTextNode('BUY NOW'));\n    this.buyBtn.classList.add(\"event-buy-btn\");\n    this.buyBtn.classList.add(\"main-btn\");\n    this.buyBtn.target = '_blank';\n    this.buyBtn.href = '';\n    this.buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\n    this.buyBtn.addEventListener('click', (e)=> {\n      // e.preventDefault(); /*used in plugins for 'buy button'*/\n      this.stopAutoSlideX();\n      //console.log(this.config.affiliateid)\n    });\n    this.eventsRootContainer.appendChild(this.buyBtn);\n  }\n\n  /**\n   * Set position center/right\n   *\n   * @param url\n   * @param isAddressCenter - if true : Set address position center/right for oldschool theme 300x250 (proportion :'m')\n   */\n  updateTransition(url , isAddressCenter) {\n    let el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");\n    (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date.centered-logo\") : el = this.eventsRootContainer.querySelector(\".event-logo.centered-logo\");    \n    if(url !=='') {\n      if(el && !isAddressCenter){\n        el.classList.add(\"right-logo\");\n        el.classList.remove(\"centered-logo\");\n      }else if(el){\n        let i;\n        for (i = 0; i < el.length-1; i++) {\n          el[i].classList.remove(\"centered-logo\");\n        }\n      }\n    }\n    else {\n      (isAddressCenter)? el = this.eventsRootContainer.querySelectorAll(\".event-date\"): el = this.eventsRootContainer.querySelector(\".event-logo.right-logo\");\n      if (el && !isAddressCenter) {\n        el.classList.remove(\"right-logo\");\n        el.classList.add(\"centered-logo\");\n      }else if(el){\n        let i;\n        for (i = 0; i < el.length-1; i++) {\n          el[i].classList.add(\"centered-logo\");\n        }\n      }\n    }\n  }\n\n  setBuyBtnUrl(){\n    if(this.buyBtn){\n      let event = this.eventsGroups[this.currentSlideX][this.currentSlideY],\n          url = '';\n      if(event){\n        if(event.url){\n\n           if((this.isUniversePluginInitialized && this.isUniverseUrl(event.url)) || (this.isTMPluginInitialized && this.isAllowedTMEvent(event.url))){\n             url = event.url;\n           }\n\n          if(this.config.theme === 'oldschool' && this.config.proportion === 'm'){\n            this.updateTransition(url , true);\n          }else{\n            this.updateTransition(url);\n          }\n\n        }\n      }\n      this.buyBtn.href = url;\n    }\n  }\n\n  isUniverseUrl(url){\n      return (url.match(/universe.com/g) || url.match(/uniiverse.com/g) || url.match(/ticketmaster.com/g));\n  }\n\n  isAllowedTMEvent(url){\n    for (var t = [/(?:ticketmaster\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/, /(?:concerts\\.livenation\\.com)\\/(.*\\/)?event\\/([^\\/?#]+)/], n = null, r = 0; r < t.length && (n = url.match(t[r]), null === n); r++);\n    let id = (null !== n ? n[2] : void 0);\n    return (this.tmWidgetWhiteList.indexOf(id) > -1);\n  }\n\n  embedTMPlugin(){\n    let id = 'id_tm_widget';\n    if( !document.getElementById(id) ) {\n      let script = document.createElement('script');\n      script.setAttribute('src', this.portalUrl + 'scripts/vendors/tm.js');\n      script.setAttribute('type', 'text/javascript');\n      script.setAttribute('charset', 'UTF-8');\n      script.setAttribute('id', id);\n      (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\n    }\n    this.isTMPluginInitialized = true;\n  }\n\n  embedUniversePlugin(){\n    let id = 'id_universe_widget';\n    if( !document.getElementById(id) ){\n      let script = document.createElement('script');\n      script.setAttribute('src', 'https://www.universe.com/embed.js');\n      script.setAttribute('type', 'text/javascript');\n      script.setAttribute('charset', 'UTF-8');\n      script.setAttribute('id', id);\n      (document.head || document.getElementsByTagName('head')[0]).appendChild(script);\n    }\n    this.isUniversePluginInitialized = true;\n  }\n\n  // Message\n  initMessage(){\n    this.messageDialog = document.createElement('div');\n    this.messageDialog.classList.add(\"event-message\");\n    this.messageContent = document.createElement('div');\n    this.messageContent.classList.add(\"event-message__content\");\n\n    let messageClose = document.createElement('div');\n    messageClose.classList.add(\"event-message__btn\");\n    messageClose.addEventListener(\"click\", ()=> {\n      this.hideMessage();\n    });\n\n    this.messageDialog.appendChild(this.messageContent);\n    this.messageDialog.appendChild(messageClose);\n    this.eventsRootContainer.appendChild(this.messageDialog);\n  }\n\n  showMessage(message, hideMessageWithoutDelay){\n    if(message.length){\n      this.hideMessageWithoutDelay = hideMessageWithoutDelay;\n      this.messageContent.innerHTML = message;\n      this.messageDialog.classList.add(\"event-message-visible\");\n      if (this.messageTimeout) {\n        clearTimeout(this.messageTimeout); // Clear timeout if before 'hideMessageWithDelay' was called\n      }\n    }\n  }\n\n  hideMessageWithDelay(delay){\n    if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout if this method was called before\n    this.messageTimeout = setTimeout(()=>{\n      this.hideMessage();\n    }, delay);\n  }\n\n  hideMessage(){\n    if(this.messageTimeout) clearTimeout(this.messageTimeout); // Clear timeout and hide message immediately.\n    this.messageDialog.classList.remove(\"event-message-visible\");\n  }\n  // End message\n\n  AdditionalElements(){\n    var legalNoticeContent = document.createTextNode('Legal Notice'),\n        legalNotice = document.createElement(\"a\");\n    legalNotice.appendChild(legalNoticeContent);\n    legalNotice.classList.add(\"legal-notice\");\n    legalNotice.target = '_blank';\n    legalNotice.href = this.legalNoticeUrl;\n    this.widgetRoot.appendChild(legalNotice);\n\n    var logo = document.createElement('a');\n    logo.classList.add(\"event-logo\",\"centered-logo\");\n    logo.target = '_blank';\n    logo.href = this.logoUrl;\n    logo.innerHTML = 'Powered by ';\n\n    var logoBox = document.createElement('div');\n    logoBox.classList.add(\"event-logo-box\");\n    logoBox.appendChild(logo);\n    this.eventsRootContainer.appendChild(logoBox);\n\n    let question = document.createElement('span'),\n        toolTip = document.createElement('div'),\n        tooltipHtml = `\n      <div class=\"tooltip-inner\"> \n        <a href=\"${this.questionUrl}\" target = \"_blank\" >About widget</a>\n        <div class=\"place\">version: <b>${this.widgetVersion}</b></div>\n      </div>`;\n    question.classList.add(\"event-question\");\n    question.addEventListener('click', toolTipHandler);\n    toolTip.classList.add(\"tooltip-version\");\n    toolTip.classList.add(\"left\");\n    toolTip.innerHTML = tooltipHtml;\n    this.eventsRootContainer.appendChild(question);\n    this.eventsRootContainer.appendChild(toolTip);\n\n    function toolTipHandler(e) {\n      e.preventDefault();\n      e.target.nextSibling.classList.toggle('show-tip');\n    }\n  }\n\n  //adds general admission element for OLDSCHOOL theme\n  oldSchoolModificator(){\n\n    var generalAdmissionWrapper = document.createElement(\"div\");\n        generalAdmissionWrapper.classList.add(\"general-admission\", \"modificator\");\n\n    var generalAdmission = document.createElement(\"div\"),\n        generalAdmissionText = document.createTextNode('GENERAL ADMISSION');\n        generalAdmission.appendChild(generalAdmissionText);\n        generalAdmissionWrapper.appendChild(generalAdmission);\n\n    this.eventsRootContainer.appendChild(generalAdmissionWrapper);\n  }\n\n  newSchoolModificator(){\n    var ticketLogo = document.createElement(\"div\");\n    ticketLogo.classList.add(\"ticket-logo\", \"modificator\");\n\n    for(let i = 0; i < 4; i++){\n      let headLogo = document.createElement(\"img\");\n      headLogo.setAttribute(\"src\", this.portalUrl + \"assets/widgets/1.0.0/img/ticketmaster-logo-white.svg\");\n      headLogo.setAttribute(\"height\", \"11\");\n      ticketLogo.appendChild(headLogo);\n    }\n\n    this.eventsRootContainer.appendChild(ticketLogo);\n  }\n\n  listViewModificator(){\n  }\n\n  hideSliderControls(){\n    this.prevEventX.classList.add(this.controlHiddenClass);\n    this.nextEventX.classList.add(this.controlHiddenClass);\n    this.prevEventY.classList.add(this.controlHiddenClass);\n    this.nextEventY.classList.add(this.controlHiddenClass);\n  }\n\n  toggleControlsVisibility(){\n    // Horizontal\n    if(this.slideCountX > 1){\n      this.prevEventX.classList.remove(this.controlHiddenClass);\n      this.nextEventX.classList.remove(this.controlHiddenClass);\n      if(this.currentSlideX === 0){\n        this.prevEventX.classList.add(this.controlHiddenClass);\n      }else if(this.currentSlideX === this.slideCountX - 1){\n        this.nextEventX.classList.add(this.controlHiddenClass);\n      }\n    }else{\n      this.prevEventX.classList.add(this.controlHiddenClass);\n      this.nextEventX.classList.add(this.controlHiddenClass);\n    }\n\n    // Vertical\n    if(this.eventsGroups.length){\n      if(this.eventsGroups[this.currentSlideX].length > 1){\n        this.prevEventY.classList.remove(this.controlHiddenClass);\n        this.nextEventY.classList.remove(this.controlHiddenClass);\n        if(this.currentSlideY === 0){\n          this.prevEventY.classList.add(this.controlHiddenClass);\n        }else if(this.currentSlideY === this.eventsGroups[this.currentSlideX].length - 1){\n          this.nextEventY.classList.add(this.controlHiddenClass);\n        }\n      }else{\n        this.prevEventY.classList.add(this.controlHiddenClass);\n        this.nextEventY.classList.add(this.controlHiddenClass);\n      }\n    }else{\n      this.prevEventY.classList.add(this.controlHiddenClass);\n      this.nextEventY.classList.add(this.controlHiddenClass);\n    }\n  }\n\n  prevSlideX(){\n    if(this.currentSlideX > 0){\n      this.setSlideManually(this.currentSlideX - 1, true);\n    }\n  }\n\n  nextSlideX(){\n    if(this.slideCountX - 1 > this.currentSlideX) {\n      this.setSlideManually(this.currentSlideX + 1, true);\n    }\n  }\n\n  prevSlideY(){\n    if(this.currentSlideY > 0){\n      this.setSlideManually(this.currentSlideY - 1, false);\n    }\n  }\n\n  nextSlideY(){\n    if(this.eventsGroups[this.currentSlideX].length - 1 > this.currentSlideY) {\n      this.setSlideManually(this.currentSlideY + 1, false);\n    }\n  }\n\n  setSlideManually(slideIndex, isDirectionX){\n    this.stopAutoSlideX();\n    this.sliderTimeout = setTimeout(()=>{\n      this.runAutoSlideX();\n    }, this.sliderRestartDelay);\n    if(isDirectionX)\n      this.goToSlideX(slideIndex);\n    else\n      this.goToSlideY(slideIndex);\n  }\n\n  goToSlideX(slideIndex){\n    if(this.currentSlideX === slideIndex) return;\n    this.currentSlideY = 0;\n    this.currentSlideX = slideIndex;\n    this.eventsRoot.style.marginLeft = `-${this.currentSlideX * 100}%`;\n    this.toggleControlsVisibility();\n    this.setEventsCounter();\n    this.setBuyBtnUrl();\n  }\n\n  goToSlideY(slideIndex){\n    if(this.currentSlideY === slideIndex) return;\n    this.currentSlideY = slideIndex;\n    let eventGroup = this.eventsRoot.getElementsByClassName(\"event-group-\" + this.currentSlideX);\n    if(eventGroup.length){\n      eventGroup = eventGroup[0];\n      eventGroup.style.marginTop = `-${this.currentSlideY * (this.widgetContentHeight - this.borderSize * 2)}px`;\n      this.toggleControlsVisibility();\n      this.setBuyBtnUrl();\n    }\n  }\n\n  runAutoSlideX(){\n    if(this.slideCountX > 1) {\n      this.sliderInterval = setInterval(()=> {\n        var slideIndex = 0;\n        if (this.slideCountX - 1 > this.currentSlideX) slideIndex = this.currentSlideX + 1;\n        this.goToSlideX(slideIndex);\n      }, this.sliderDelay);\n    }\n  }\n\n  stopAutoSlideX(){\n    if(this.sliderTimeout) clearTimeout(this.sliderTimeout);\n    if(this.sliderInterval) clearInterval(this.sliderInterval);\n  }\n\n  initSliderControls(){\n    this.currentSlideX = 0;\n    this.currentSlideY = 0;\n    this.slideCountX = 0;\n    let coreCssClass = 'events_control';\n\n    // left btn\n    this.prevEventX = document.createElement(\"div\");\n    let prevEventXClass = [coreCssClass, coreCssClass + '-horizontal', coreCssClass + '-left', this.controlHiddenClass];\n    for(let i in prevEventXClass){\n      this.prevEventX.classList.add(prevEventXClass[i]);\n    }\n    this.eventsRootContainer.appendChild(this.prevEventX);\n\n    // right btn\n    this.nextEventX = document.createElement(\"div\");\n    let nextEventXClass = [coreCssClass, coreCssClass + '-horizontal', coreCssClass + '-right', this.controlHiddenClass];\n    for(let i in nextEventXClass){\n      this.nextEventX.classList.add(nextEventXClass[i]);\n    }\n    this.eventsRootContainer.appendChild(this.nextEventX);\n\n    // top btn\n    this.prevEventY = document.createElement(\"div\");\n    let prevEventYClass = [coreCssClass, coreCssClass + '-vertical', coreCssClass + '-top', this.controlHiddenClass];\n    for(let i in prevEventYClass ){\n      this.prevEventY.classList.add(prevEventYClass[i]);\n    }\n    this.eventsRootContainer.appendChild(this.prevEventY);\n\n    // bottom btn\n    this.nextEventY = document.createElement(\"div\");\n    let nextEventYClass = [coreCssClass, coreCssClass + '-vertical', coreCssClass + '-bottom', this.controlHiddenClass];\n    for(let i in nextEventYClass){\n      this.nextEventY.classList.add(nextEventYClass[i]);\n    }\n    this.eventsRootContainer.appendChild(this.nextEventY);\n\n    // Restore events group position\n    function whichTransitionEvent(){\n      let el = document.createElement('fakeelement'),\n        transitions = {\n          'transition':'transitionend',\n          'OTransition':'oTransitionEnd',\n          'MozTransition':'transitionend',\n          'WebkitTransition':'webkitTransitionEnd'\n        };\n\n      for(let event in transitions){\n        if( el.style[event] !== undefined ) return transitions[event];\n      }\n    }\n\n    var transitionEvent = whichTransitionEvent();\n    transitionEvent && this.eventsRoot.addEventListener(transitionEvent, (e)=> {\n      if (this.eventsRoot !== e.target) return;\n      let eventGroup = this.eventsRoot.getElementsByClassName(\"event-group\");\n      // Reset all groups. We don't know what event group was visible before.\n      for(let i = 0; eventGroup.length > i; i++){\n        eventGroup[i].style.marginTop = 0;\n      }\n    });\n\n    // Arrows\n    this.prevEventX.addEventListener(\"click\", ()=> {\n      this.prevSlideX();\n    });\n\n    this.nextEventX.addEventListener(\"click\", ()=> {\n      this.nextSlideX();\n    });\n\n    this.prevEventY.addEventListener(\"click\", ()=> {\n      this.prevSlideY();\n    });\n\n    this.nextEventY.addEventListener(\"click\", ()=> {\n      this.nextSlideY();\n    });\n\n    // Tough device swipes\n    let xDown = null,\n        yDown = null;\n\n    function handleTouchStart(evt) {\n      xDown = evt.touches[0].clientX;\n      yDown = evt.touches[0].clientY;\n    }\n\n    function handleTouchMove(evt) {\n      if ( ! xDown || ! yDown ) return;\n\n      let xUp = evt.touches[0].clientX,\n          yUp = evt.touches[0].clientY,\n          xDiff = xDown - xUp,\n          yDiff = yDown - yUp;\n\n      if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {\n        if ( xDiff > 0 )\n          this.nextSlideX(); // left swipe\n        else\n          this.prevSlideX(); // right swipe\n      } else {\n        if ( yDiff > 0 )\n          this.nextSlideY(); // up swipe\n        else\n          this.prevSlideY(); // down swipe\n      }\n\n      xDown = null;\n      yDown = null;\n    }\n\n    this.eventsRootContainer.addEventListener('touchstart', (e)=> {\n      if(this.config.theme !== \"listview\") { if (e.target.className != 'event-logo' && e.target.className != 'event-question') e.preventDefault(); } /*used in plugins for 'buy button'*/\n      handleTouchStart.call(this, e);\n    }, false);\n    this.eventsRootContainer.addEventListener('touchmove', (e)=> {\n      if(this.config.theme !== \"listview\") { if (e.target.className != 'event-logo' && e.target.className != 'event-question') e.preventDefault(); }\n      handleTouchMove.call(this, e);\n    }, false);\n  }\n\n  initSlider(){\n    if(this.sliderInterval) clearInterval(this.sliderInterval);\n    if(this.sliderTimeout) clearTimeout(this.sliderTimeout);\n    this.slideCountX = this.eventsGroups.length;\n    this.eventsRoot.style.marginLeft = '0%';\n    this.eventsRoot.style.width = (this.isFullWidth) ? `${this.slideCountX * this.widgetRoot.offsetWidth }px` :  `${this.slideCountX * 100}%` ;\n    this.currentSlideX = 0;\n    this.currentSlideY = 0;\n    this.runAutoSlideX();\n\n    if (this.isFullWidth) {\n      let list = this.widgetRoot.querySelectorAll('li'),\n        me = this,\n        resizeTimeout;\n\n      window.addEventListener('resize', resizeThrottler, false);\n      this.listenerResize.push(resizeThrottler);\n      \n      function resizeThrottler() {\n        // ignore resize events as long as an actualResizeHandler execution is in the queue\n        if ( !resizeTimeout ) {\n          resizeTimeout = setTimeout(function() {\n            resizeTimeout = null;\n            actualResizeHandler();\n\n            // The actualResizeHandler will execute at a rate of 15fps\n          }, 66);\n        }\n      }\n\n      function actualResizeHandler() {\n        // handle the resize event\n        list.forEach((item)=> {\n          item.style.width = `${me.widgetRoot.offsetWidth}px`;\n          item.style.height = `${me.widgetRoot.widgetContentHeight}px`;\n        });\n\n        me.eventsRoot.style.width = (me.isFullWidth) ? `${me.slideCountX * me.widgetRoot.offsetWidth }px` :  `${me.slideCountX * 100}%`;\n      }\n      \n    }else if(this.listenerResize && this.listenerResize.length !== 0){\n        window.removeEventListener(\"resize\", this.listenerResize[0], false);\n        this.listenerResize.pop();\n    }\n\n    this.toggleControlsVisibility();\n    this.setBuyBtnUrl();\n  }\n\n  initFullWidth(){\n    let heightStatic = 550;\n    this.config.width = `100%`;\n    this.config.height = heightStatic;\n    this.widgetRoot.style.width = `100%`;\n    this.widgetRoot.style.height = heightStatic + 'px';\n    this.widgetRoot.style.display = `block`;\n    this.eventsRootContainer.style.width  = `100%`;\n    this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\n  }\n\n  formatDate(date) {\n    var result = '';\n    if(!date.day) return result; // Day is required\n\n    function LZ(x) {\n      return (x < 0 || x > 9 ? \"\" : \"0\") + x\n    }\n    var MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\n        DAY_NAMES = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\n        dayArray = date.day.split('-'),\n        d = parseInt(dayArray[2]),\n        M = parseInt(dayArray[1]);\n\n    // var E = new Date(date.day).getDay();\n    var E = new Date(+date.day.split('-')[0],(+date.day.split('-')[1])-1,+date.day.split('-')[2]).getDay();\n    result = DAY_NAMES[E] + ', ' + MONTH_NAMES[M - 1] + ' ' + d + ', ' + dayArray[0];\n\n    if(!date.time) return result;\n\n    var timeArray = date.time.split(':'),\n      H = parseInt(timeArray[0]),\n      m = timeArray[1],\n      a = \"AM\";\n\n    if (H > 11) a = \"PM\";\n    if (H == 0) {\n      H = 12;\n    } else if (H > 12) {\n      H = H - 12;\n    }\n\n    return result + ' ' + LZ(H) + ':' + m + ' ' + a;\n  }\n\n  clearEvents(){\n    this.eventsRoot.innerHTML = \"\";\n  }\n\n  clear(){\n    var modificatorList = this.widgetRoot.getElementsByClassName('modificator');\n    while (modificatorList.length) {\n      let el = modificatorList[0],\n          parent = el.parentNode;\n      parent.removeChild(el);\n    }\n\n\n    if(!this.isListView && !this.isListViewThumbnails ) {\n      var eventsRootContainer = document.getElementsByClassName(\"events-root-container\")[0];\n      var eventsRoot = document.getElementsByClassName(\"events-root\")[0];\n      var ss = document.getElementsByClassName(\"ss\")[0];\n      ss.parentNode.removeChild(ss);\n\n      var ssDiv = document.createElement(\"div\");\n      ssDiv.setAttribute(\"class\", \"ss\");\n      eventsRootContainer.appendChild(ssDiv);\n\n      var ssDiv = document.getElementsByClassName(\"ss\")[0];\n      ssDiv.appendChild(eventsRoot);\n\n      var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\n      eventsRootContainer.classList.remove(\"listview-after\");\n    }\n\n    if(this.isListView || this.isListViewThumbnails || this.isFullWidth ) {\n      var eventsRootContainer = document.getElementsByClassName(\"widget-container--discovery\")[0];\n      eventsRootContainer.classList.add(\"listview-after\");\n    }\n\n\n    this.clearEvents();\n  }\n\n  update() {\n\n    let oldTheme = this.config.constructor();\n    for (let attr in this.config) {\n      if (this.config.hasOwnProperty(attr)) oldTheme[attr] = this.config[attr];\n    }\n\n    this.config = this.widgetRoot.attributes;\n\n    if(this.isListView || this.isListViewThumbnails ) {\n      this.stopAutoSlideX();\n    }\n    if (!this.isFullWidth) {\n      this.widgetRoot.style.height = `${this.widgetHeight}px`;\n      this.widgetRoot.style.width  = `${this.config.width}px`;\n      this.eventsRootContainer.style.height = `${this.widgetContentHeight}px`;\n      this.eventsRootContainer.style.width  = `${this.config.width}px`;\n    }\n    this.eventsRootContainer.style.borderRadius = `${this.config.borderradius}px`;\n    this.eventsRootContainer.style.borderWidth = `${this.borderSize}px`;\n\n    this.eventsRootContainer.classList.remove(\"border\");\n    if( this.config.hasOwnProperty(\"border\") ){\n      this.eventsRootContainer.classList.add(\"border\");\n    }\n\n    if(!this.needToUpdate(this.config, oldTheme, this.updateExceptions) || this.needToUpdate(this.config, oldTheme, this.updateExceptions)){\n      this.clear();\n\n      if( this.themeModificators.hasOwnProperty( this.widgetConfig.theme ) ) {\n        this.themeModificators[ this.widgetConfig.theme ]();\n      }\n\n      this.getCoordinates(() => {\n        this.makeRequest( this.eventsLoadingHandler, this.apiUrl, this.eventReqAttrs );\n      });\n\n      if(this.isListView || this.isListViewThumbnails ) this.addScroll();\n\n    }\n    else{\n      let events = this.eventsRoot.getElementsByClassName(\"event-wrapper\");\n      for(let i in events){\n        if(events.hasOwnProperty(i) && events[i].style !== undefined){\n          events[i].style.width = `${this.config.width - this.borderSize * 2}px`;\n          events[i].style.height = `${this.widgetContentHeight - this.borderSize * 2}px`;\n        }\n      }\n      if(!this.isListView && !this.isListViewThumbnails ) {\n        this.goToSlideY(0);\n      }\n    }\n\n  }\n\n  needToUpdate(newTheme, oldTheme, forCheck = []){\n    return Object.keys(newTheme).map(function(key){\n      if(forCheck.indexOf(key) > -1) return true;\n      return newTheme[key] === oldTheme[key] ;\n    }).indexOf(false) > -1\n  }\n\n  loadConfig(NamedNodeMap){\n      var config = {};\n      Object.keys(NamedNodeMap).map(function(value){\n        if( typeof(NamedNodeMap[value].name) !== \"undefined\" && NamedNodeMap[value].name.indexOf(\"w-\") !== -1){\n          config[ NamedNodeMap[value].name.replace(/w-/g, \"\").replace(/-/g, \"\") ] = NamedNodeMap[value].value;\n        }\n      });\n      return config;\n  }\n\n  styleLoadingHandler(){\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\n      if(this.status == 200){\n        var style = document.createElement(\"style\");\n        style.setAttribute(\"type\",\"text/css\");\n        style.setAttribute(\"id\",`widget-theme-${this.widget.config.theme}`);\n        style.textContent = this.responseText;\n        document.getElementsByTagName(\"head\")[0].appendChild(style);\n      }\n      else {\n        console.log(\"theme wasn't loaded\");\n      }\n    }\n  }\n\n  groupEventsByName(){\n    let groups = {};\n    this.events.map(function(event){\n      if (groups[event.name] === undefined) groups[event.name] = [];\n      groups[event.name].push(event);\n    });\n    this.eventsGroups = [];\n    for (let groupName in groups) {\n      this.eventsGroups.push(groups[groupName]);\n    }\n  }\n\n  initEventCounter(){\n    this.eventsCounter = document.createElement(\"div\");\n    this.eventsCounter.classList.add(\"events-counter\");\n    this.widgetRoot.appendChild(this.eventsCounter);\n  }\n\n  setEventsCounter(){\n    if(this.eventsCounter){\n      let text = '';\n      if(this.eventsGroups.length){\n        if(this.eventsGroups.length > 1){\n          text = `${this.currentSlideX + 1} of ${this.eventsGroups.length} events`;\n        } else {\n          text = '1 event';\n        }\n      }\n      this.eventsCounter.innerHTML = text;\n    }\n  }\n\n  resetReduceParamsOrder(){\n    this.reduceParamsOrder = 0;\n  }\n\n  reduceParamsAndReloadEvents(){\n    let eventReqAttrs = {},\n      reduceParamsList = [\n        ['classificationName'],\n        ['city'],\n        ['countryCode'],\n        ['source'],\n        ['startDateTime', 'endDateTime', 'country'],\n        ['radius'],\n        ['postalCode', 'latlong'],\n        ['attractionId'],\n        ['promoterId'],\n        // ['segmentId'],\n        ['venueId'],\n        ['keyword'],\n        ['size']\n      ];\n\n    // make copy of params\n    for(let key in this.eventReqAttrs){\n      eventReqAttrs[key] = this.eventReqAttrs[key]\n    }\n\n    if(!this.reduceParamsOrder) this.reduceParamsOrder = 0;\n    if(reduceParamsList.length > this.reduceParamsOrder){\n      for(let item in reduceParamsList){\n        if(this.reduceParamsOrder >= item){\n          for(let i in reduceParamsList[item]){\n            delete eventReqAttrs[reduceParamsList[item][i]];\n          }\n        }\n      }\n\n      if(this.reduceParamsOrder === 0) this.showMessage(\"No results were found.<br/>Here other options for you.\");\n      this.reduceParamsOrder++;\n      this.makeRequest( this.eventsLoadingHandler, this.apiUrl, eventReqAttrs );\n    }else{\n      // We haven't any results\n      this.showMessage(\"No results were found.\", true);\n      this.reduceParamsOrder = 0;\n      this.hideSliderControls();\n    }\n  }\n\n  eventsLoadingHandler(){\n    let widget = this.widget;\n    widget.clearEvents(); // Additional clearing after each loading\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\n      if(this.status == 200){\n        widget.events = JSON.parse(this.responseText);\n\n        if (widget.isFullWidth) { widget.initFullWidth(); }\n\n        if(widget.events.length){\n          widget.groupEventsByName.call(widget);\n          widget.eventsGroups.map(function(group, i){\n            if(group.length === 1)\n              widget.publishEvent(group[0]);\n            else\n              widget.publishEventsGroup.call(widget, group, i);\n          });\n          if (!widget.isListView && !widget.isListViewThumbnails) widget.initSlider();\n\n          widget.setEventsCounter();\n          widget.resetReduceParamsOrder();\n          if(widget.hideMessageWithoutDelay)\n            widget.hideMessage();\n          else\n            widget.hideMessageWithDelay(widget.hideMessageDelay);\n\n        }else{\n          widget.reduceParamsAndReloadEvents.call(widget);\n        }\n      }\n      else if(this.status == 400) {\n        widget.reduceParamsAndReloadEvents.call(widget);\n        console.log('There was an error 400');\n      }\n      else {\n        widget.reduceParamsAndReloadEvents.call(widget);\n        console.log('something else other than 200 was returned');\n      }\n    }\n  }\n\n  publishEventsGroup(group, index){\n    let groupNodeWrapper = document.createElement(\"li\");\n    groupNodeWrapper.classList.add(\"event-wrapper\");\n    groupNodeWrapper.classList.add(\"event-group-wrapper\");\n\n    groupNodeWrapper.style.width = (!this.isFullWidth) ? `${this.config.width - this.borderSize * 2}px` : `${this.widgetRoot.offsetWidth - this.borderSize * 2 }px`;\n    groupNodeWrapper.style.height = (!this.isFullWidth) ? `${this.widgetContentHeight - this.borderSize * 2}px`: `${this.widgetContentHeight - this.borderSize * 2}px`;\n\n    let groupNode = document.createElement(\"ul\");\n    groupNode.classList.add(\"event-group\");\n    groupNode.classList.add(\"event-group-\" + index);\n\n    group.map((event)=> {\n      this.publishEvent(event, groupNode)\n    });\n\n    groupNodeWrapper.appendChild(groupNode);\n    this.eventsRoot.appendChild(groupNodeWrapper);\n  }\n\n  publishEvent(event, parentNode){\n    parentNode = parentNode || this.eventsRoot;\n    let DOMElement = this.createDOMItem(event);\n    parentNode.appendChild(DOMElement);\n  }\n\n  getEventByID(id){\n    for(let index in this.events){\n      if(this.events.hasOwnProperty(index) && this.events[index].id === id){\n        return this.events[index]\n      }\n    }\n  }\n\n  getImageForEvent(images , isGetSmallest , isSecondSmallest){\n    var width = this.config.width,\n      height = this.widgetContentHeight;\n\n    images.sort(function(a,b) {\n      if (a.width < b.width)\n        return -1;\n      else if (a.width > b.width)\n        return 1;\n      else\n        return 0;\n    });\n\n    var myImg = \"\";\n    if(!isGetSmallest) {\n      images.forEach(function (element) {\n        if (element.width >= width && element.height >= height && !myImg) {\n          myImg = element.url;\n        }\n      });\n    }else myImg = images[0].url; //set the smallest\n\n    if(isGetSmallest && isSecondSmallest) {\n      myImg = images[2].url;\n    }\n\n    if(myImg === \"\") {\n      myImg = images[images.length-1].url;\n    }\n\n    return myImg;\n  }\n\n  parseEvents(eventsSet){\n    if(!eventsSet._embedded){\n      if(typeof($widgetModalNoCode) !== \"undefined\"){\n        $widgetModalNoCode.modal();\n      }\n      return [];\n    }\n    eventsSet = eventsSet._embedded.events;\n    var tmpEventSet = [];\n\n    for(var key in eventsSet){\n      if(eventsSet.hasOwnProperty(key)){\n        let currentEvent = {};\n\n        currentEvent.id = eventsSet[key].id;\n        currentEvent.url = eventsSet[key].url;\n        currentEvent.name = eventsSet[key].name;\n\n        /* Change URL [START] */\n        var parser = document.createElement(\"a\");\n        parser.href = currentEvent.url;\n        var expr= \"/ticketmaster.evyy.net/\";\n        if (parser.href.match(expr) !== null) {\n            var changeURL = parser.pathname.split('/');\n            changeURL[3] = '330564';\n            currentEvent.url = parser.origin + changeURL.join('/') + parser.search + parser.hash;\n        }\n        /* Change URL [END] */\n\n        currentEvent.date = {\n          day: eventsSet[key].dates.start.localDate,\n          time: eventsSet[key].dates.start.localTime\n        };\n\n        if(eventsSet[key].hasOwnProperty('_embedded') && eventsSet[key]._embedded.hasOwnProperty('venues')){\n          let venue = eventsSet[key]._embedded.venues[0];\n          if(venue){\n            if(venue.address)\n              currentEvent.address = venue.address;\n\n            if(venue.name){\n              if(!currentEvent.address) currentEvent.address = {};\n              currentEvent.address.name = venue.name;\n            }\n          }\n        }\n\n        // Remove this comment to get categories\n        /*if(eventsSet[key]._embedded.hasOwnProperty('categories')){\n          currentEvent.categories = [];\n          let eventCategories = eventsSet[key]._embedded.categories;\n          currentEvent.categories = Object.keys(eventCategories).map(function(category){\n            return eventCategories[category].name\n          });\n        }*/\n        currentEvent.img = this.getImageForEvent(eventsSet[key].images , this.isListViewThumbnails, this.isFullWidth); //*this.listViewModificator() - is boolean*/\n        tmpEventSet.push(currentEvent);\n\n      }\n    }\n    return tmpEventSet;\n  }\n\n  makeRequest(handler, url=this.apiUrl, attrs={}, method=\"GET\"){\n    attrs = Object.keys(attrs).map(function(key){\n      return `${key}=${attrs[key]}`;\n    }).join(\"&\");\n\n    url = [url,attrs].join(\"?\");\n    if (this.widgetRoot.getAttribute('w-postalcodeapi') != null) url += '&postalCode=' + this.widgetRoot.getAttribute('w-postalcodeapi');\n    url += '&sort=date,asc';\n\n    this.xmlHTTP = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\");\n    if(method == \"POST\") {\n      this.xmlHTTP.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n    }\n    this.xmlHTTP.widget = this;\n    this.xmlHTTP.onreadystatechange = handler;\n    this.xmlHTTP.open(method, url, true);\n    this.xmlHTTP.send();\n  }\n\n  initPretendedLink(el, url, isBlank){\n    if(el && url){\n      el.setAttribute('data-url', url);\n      el.classList.add(\"event-pretended-link\");\n      el.addEventListener('click', function(){\n        let url = this.getAttribute('data-url');\n        if(url){\n          let win = window.open(url, (isBlank ? '_blank' : '_self'));\n          win.focus();\n        }\n      });\n      el.addEventListener('touchstart', function(){\n        let url = this.getAttribute('data-url');\n        if(url){\n          let win = window.open(url, (isBlank ? '_blank' : '_self'));\n          win.focus();\n        }\n      });\n    }\n    return el;\n  }\n\n  createBackgroundImage(event, img) {\n    if (!this.isListView && !this.isListViewThumbnails ) {\n      var image = document.createElement(\"span\");\n      image.classList.add(\"bg-cover\");\n      image.style.backgroundImage = `url('${img}')`;\n      event.appendChild(image);\n    }\n    if(this.isListViewThumbnails) {\n      var wrapperImg = document.createElement(\"div\"),\n          image = document.createElement(\"span\");\n\n      wrapperImg.classList.add(\"wrapper-thumbnails\");\n      image.classList.add(\"bg-cover-thumbnails\");\n      image.style.backgroundImage = `url('${img}')`;\n      wrapperImg.appendChild(image);\n      event.appendChild(wrapperImg);\n\n      return wrapperImg;\n    }\n  }\n\n  addBarcode(domNode, url) {\n    if (this.isBarcodeWidget) {\n      let barcodeBtn = document.createElement(\"a\");\n      barcodeBtn.classList.add(\"barcode\");\n      barcodeBtn.target = '_blank';\n      barcodeBtn.href = url;\n      barcodeBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickEventName', 'click');\");\n      domNode.appendChild(barcodeBtn);\n      let bottomBg = document.createElement(\"span\");\n      bottomBg.classList.add(\"barcode-bottom\");\n      domNode.appendChild(bottomBg);\n    }\n  }\n\n  addBuyButton(domNode, url) {\n    if (this.isListView || this.isListViewThumbnails ) {\n      let _urlValid = ( this.isUniversePluginInitialized && this.isUniverseUrl(url) ) || ( this.isTMPluginInitialized && this.isAllowedTMEvent(url) );\n      if(!_urlValid) url = '';\n      let buyBtn = document.createElement(\"a\");\n      buyBtn.appendChild(document.createTextNode('BUY NOW'));\n      buyBtn.classList.add(\"event-buy-btn\");\n      buyBtn.target = '_blank';\n      buyBtn.href = url;\n      buyBtn.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickBuyButton', 'click');\");\n      domNode.appendChild(buyBtn);\n    }\n  }\n\n  addScroll() {\n    (function(n,t){function u(n){n.hasOwnProperty(\"data-simple-scrollbar\")||Object.defineProperty(n,\"data-simple-scrollbar\",new SimpleScrollbar(n))}function e(n,i){function f(n){var t=n.pageY-u;u=n.pageY;r(function(){i.el.scrollTop+=t/i.scrollRatio})}function e(){n.classList.remove(\"ss-grabbed\");t.body.classList.remove(\"ss-grabbed\");t.removeEventListener(\"mousemove\",f);t.removeEventListener(\"mouseup\",e)}var u;n.addEventListener(\"mousedown\",function(i){return u=i.pageY,n.classList.add(\"ss-grabbed\"),t.body.classList.add(\"ss-grabbed\"),t.addEventListener(\"mousemove\",f),t.addEventListener(\"mouseup\",e),!1})}function i(n){for(this.target=n,this.bar='<div class=\"ss-scroll\">',this.wrapper=t.createElement(\"div\"),this.wrapper.setAttribute(\"class\",\"ss-wrapper\"),this.el=t.createElement(\"div\"),this.el.setAttribute(\"class\",\"ss-content\"),this.wrapper.appendChild(this.el);this.target.firstChild;)this.el.appendChild(this.target.firstChild);this.target.appendChild(this.wrapper);this.target.insertAdjacentHTML(\"beforeend\",this.bar);this.bar=this.target.lastChild;e(this.bar,this);this.moveBar();this.el.addEventListener(\"scroll\",this.moveBar.bind(this));this.el.addEventListener(\"mouseenter\",this.moveBar.bind(this));this.target.classList.add(\"ss-container\")}function f(){for(var i=t.querySelectorAll(\"*[ss-container]\"),n=0;n<i.length;n++)u(i[n])}var r=n.requestAnimationFrame||n.setImmediate||function(n){return setTimeout(n,0)};i.prototype={moveBar:function(){var t=this.el.scrollHeight,i=this.el.clientHeight,n=this;this.scrollRatio=i/t;r(function(){n.bar.style.cssText=\"height:\"+i/t*100+\"%; top:\"+n.el.scrollTop/t*100+\"%;right:-\"+(n.target.clientWidth-n.bar.clientWidth)+\"px;\"})}};t.addEventListener(\"DOMContentLoaded\",f);i.initEl=u;i.initAll=f;n.SimpleScrollbar=i})(window,document)\n    // var scrollRoot = document.getElementsByClassName(\"ss\")[0];\n    var scrollRoot = document.querySelector('.ss');\n    SimpleScrollbar.initEl(scrollRoot);\n  }\n\n  createDOMItem(itemConfig){\n    var medWrapper = document.createElement(\"div\");\n    medWrapper.classList.add(\"event-content-wraper\");\n\n    var event = document.createElement(\"li\");\n    event.classList.add(\"event-wrapper\");\n    event.style.height = (!this.isFullWidth) ? `${this.widgetContentHeight - this.borderSize * 2}px` : `${this.widgetContentHeight - this.borderSize * 2}px`;\n    event.style.width = (!this.isFullWidth) ? `${this.config.width - this.borderSize * 2}px` : `${this.widgetRoot.offsetWidth - this.borderSize * 2 }px`;\n\n    let wrapperImg = this.createBackgroundImage(event, itemConfig.img);\n    var titleLink = document.querySelector('[w-type=\"event-discovery\"]').getAttribute('w-titlelink');\n    var nameContent = document.createTextNode(itemConfig.name);\n\n    if (titleLink && titleLink == 'off') {\n      let name = document.createElement(\"span\");\n      name.classList.add(\"event-name\");\n      name.appendChild(nameContent);\n      this.initPretendedLink(name, itemConfig.url, true);\n      name.setAttribute('onclick', `ga('send', 'event', 'DiscoveryClickeventName_theme=${this.config.theme}_width=${this.config.width}_height=${this.config.height}_color_scheme=${this.config.colorscheme}', 'click', '${itemConfig.url}');`);\n      name.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickeventName', 'click', '\" + itemConfig.url + \"');\");\n      medWrapper.appendChild(name);\n    }\n    else {\n      let name = document.createElement(\"a\");\n      name.classList.add(\"event-name\");\n      name.classList.add(\"event-pretended-link\");\n      name.href = itemConfig.url;\n      name.appendChild(nameContent);\n      name.setAttribute('onclick', `ga('send', 'event', 'DiscoveryClickeventName_theme=${this.config.theme}_width=${this.config.width}_height=${this.config.height}_color_scheme=${this.config.colorscheme}', 'click', '${itemConfig.url}');`);\n      name.setAttribute('onclick', \"ga('send', 'event', 'DiscoveryClickeventName', 'click', '\" + itemConfig.url + \"');\");\n      medWrapper.appendChild(name);\n    }\n\n    this.addBarcode(event, itemConfig.url);\n    this.addBuyButton( (!this.isListViewThumbnails) ? medWrapper : wrapperImg, itemConfig.url ); //add 'BuyButton' to '.wrapper-thumbnails' if choose ListViewThumbnails\n\n    var dateTimeContent = document.createTextNode(this.formatDate(itemConfig.date)),\n    dateTime = document.createElement(\"span\");\n    dateTime.classList.add(\"event-date\", \"centered-logo\");\n    dateTime.appendChild(dateTimeContent);\n\n    var dateWraper = document.createElement(\"span\");\n    dateWraper.classList.add(\"event-date-wraper\");\n    dateWraper.appendChild(dateTime);\n    medWrapper.appendChild(dateWraper);\n\n    if(itemConfig.hasOwnProperty(\"address\")){\n      var addressWrapper = document.createElement(\"span\");\n      addressWrapper.classList.add(\"address-wrapper\");\n\n      if( itemConfig.address.hasOwnProperty(\"name\") ){\n        var addressNameText = document.createTextNode(itemConfig.address.name),\n            addressName =  document.createElement(\"span\");\n        addressName.classList.add(\"event-address\");\n        addressName.classList.add(\"event-address-name\");\n        addressName.appendChild(addressNameText);\n        addressWrapper.appendChild(addressName);\n      }\n\n      if( itemConfig.address.hasOwnProperty(\"line1\") ){\n        var addressOneText = document.createTextNode(itemConfig.address.line1),\n        addressOne =  document.createElement(\"span\");\n        addressOne.classList.add(\"event-address\");\n        addressOne.appendChild(addressOneText);\n        addressWrapper.appendChild(addressOne);\n      }\n\n      if( itemConfig.address.hasOwnProperty(\"line2\") ){\n        var addressTwoText = document.createTextNode(itemConfig.address.line2),\n        addressTwo =  document.createElement(\"span\");\n        addressTwo.classList.add(\"event-address\");\n        addressTwo.appendChild(addressTwoText);\n        addressWrapper.appendChild(addressTwo);\n      }\n\n      medWrapper.appendChild(addressWrapper);\n    }\n\n    if(itemConfig.hasOwnProperty(\"categories\")) {\n      var categoriesWrapper = document.createElement(\"span\");\n      categoriesWrapper.classList.add(\"category-wrapper\");\n\n      itemConfig.categories.forEach(function (element) {\n        var categoryText = document.createTextNode(element),\n          category = document.createElement(\"span\");\n        category.classList.add(\"event-category\");\n        category.appendChild(categoryText);\n        categoriesWrapper.appendChild(category);\n      });\n      medWrapper.appendChild(categoriesWrapper);\n    }\n\n    event.appendChild(medWrapper);\n\n    return event;\n  }\n\n  makeImageUrl(id){\n    return `https://app.ticketmaster.com/discovery/v2/events/${id}/images.json`;\n  }\n\n\n  /*\n   * Config block\n   */\n\n  decConfig(config){\n    return JSON.parse(window.atob(config));\n  }\n\n  encConfig(config){\n    return window.btoa(config);\n  }\n\n  toShortISOString(dateObj){\n    return dateObj.getFullYear() +\n      \"-\" + (dateObj.getMonth() + 1 < 10 ? \"0\"+ (dateObj.getMonth()+ 1): dateObj.getMonth() + 1) +\n      \"-\" + (dateObj.getDate() < 10 ? \"0\"+ dateObj.getDate(): dateObj.getDate()) +\n      \"T\" + (dateObj.getHours() < 10 ? \"0\"+dateObj.getHours(): dateObj.getHours()) +\n      \":\" + (dateObj.getMinutes() < 10 ? \"0\"+dateObj.getMinutes(): dateObj.getMinutes()) +\n      \":\" + (dateObj.getSeconds() < 10 ? \"0\"+dateObj.getSeconds(): dateObj.getSeconds()) +\n      \"Z\";\n  }\n\n  getDateFromPeriod(period){\n\n    var period = period.toLowerCase(),\n      firstDay, lastDay;\n\n    if(period == \"year\" ) {\n      // firstDay = new Date( new Date(new Date()).toISOString() );\n      // lastDay = new Date( new Date(new Date().valueOf()+24*365*60*60*1000).toISOString() );\n      firstDay = new Date().toISOString().slice(0,19) + 'Z';\n      lastDay = new Date(new Date().valueOf()+24*365*60*60*1000).toISOString().slice(0,19) + 'Z';\n    }\n    else if(period == \"month\") {\n      // firstDay = new Date( new Date(new Date()).toISOString() );\n      // lastDay = new Date( new Date(new Date().valueOf()+24*31*60*60*1000).toISOString() );\n      firstDay = new Date().toISOString().slice(0,19) + 'Z';\n      lastDay = new Date(new Date().valueOf()+24*31*60*60*1000).toISOString().slice(0,19) + 'Z';\n    }\n    else if(period == \"week\") {\n      // firstDay = new Date( new Date(new Date()).toISOString() );\n      // lastDay = new Date( new Date(new Date().valueOf()+24*7*60*60*1000).toISOString() );\n      firstDay = new Date().toISOString().slice(0,19) + 'Z';\n      lastDay = new Date(new Date().valueOf()+24*7*60*60*1000).toISOString().slice(0,19) + 'Z';\n    } else {\n      // firstDay = new Date( new Date(new Date()).toISOString() );\n      // lastDay = new Date( new Date(new Date().valueOf()+24*60*60*1000).toISOString() );\n      firstDay = new Date().toISOString().slice(0,19) + 'Z';\n      lastDay = new Date(new Date().valueOf()+24*60*60*1000).toISOString().slice(0,19) + 'Z';\n    }\n\n    // return [this.toShortISOString(firstDay), this.toShortISOString(lastDay)];\n    return [firstDay, lastDay];\n  }\n\n}\nlet widgetsEventDiscovery = [];\n(function () {\n  let widgetContainers = document.querySelectorAll(\"div[w-type='event-discovery']\");\n  for (let i = 0; i < widgetContainers.length; ++i) {\n    widgetsEventDiscovery.push(new TicketmasterEventDiscoveryWidget(widgetContainers[i]));\n  }\n\n})();\n\n(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\nga('create', 'UA-78315612-1', 'auto');\nga('send', 'pageview');\n\n\nif(typeof module !== \"undefined\") {\n  module.exports = { TicketmasterEventDiscoveryWidget };\n}\n\n"]}