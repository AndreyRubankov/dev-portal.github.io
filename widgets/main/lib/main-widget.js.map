{"version":3,"sources":["../src/main-widget.es6"],"names":[],"mappings":"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","file":"main-widget.js","sourcesContent":["/*\r\n {\"ak\":\"KRUnjq8y8Sg5eDpP90dNzOK70d4WiUst\",\"kw\":\"zztop\",\"t\":{\"b\":\"t1\",\"h\":200,\"w\":150}}\r\n {\r\n \"ak\":\"KRUnjq8y8Sg5eDpP90dNzOK70d4WiUst\", #ApiKey\r\n \"kw\":\"zztop\", #KeyWords\r\n \"t\":{ #Theme\r\n \"b\":\"t1\", #baseTheme - if null do not load theme\r\n \"h\":300,\r\n \"w\":150\r\n }\r\n })\r\n\r\n -API key       # input\r\n -Key word      # input\r\n -Postal Code   # input\r\n -Theme         # Buttons\r\n -Color Scheme  # Buttons\r\n -Layout        # Buttons\r\n -Height        # Slider\r\n -Width         # Slider\r\n -Border Radius # Slider\r\n\r\n */\r\n\r\n\r\n\r\nclass TicketmasterWidget {\r\n\r\n  set config(config) { this.widgetConfig = this.decConfig(config); }\r\n  get config() { return this.widgetConfig; }\r\n  set events(responce){ this.eventsList = this.parseEvents(responce);}\r\n  get events(){ return this.eventsList;}\r\n  get apiUrl(){ return \"https://app.ticketmaster.com/discovery/v1/events.json\"; }\r\n  get themeUrl() { return \"http://localhost:4000/widgets/main/theme/\"; }\r\n\r\n  //https://app.ticketmaster.com/discovery/v1/events/10004F84CD1C5395/images.json?apikey=KRUnjq8y8Sg5eDpP90dNzOK70d4WiUst\r\n\r\n  constructor(selector) {\r\n    this.widgetRoot = document.querySelectorAll(selector)[0];\r\n    this.eventsRoot = document.createElement(\"ul\");\r\n    this.eventsRoot.classList.add(\"events-root\");\r\n    this.widgetRoot.appendChild(this.eventsRoot);\r\n\r\n    this.config = this.loadConfig();\r\n\r\n    if(this.config.t.b !== null){\r\n      this.makeRequest( this.styleLoadingHandler, this.themeUrl + this.config.t.b + \".css\" );\r\n    }\r\n\r\n    this.widgetRoot.style.height = `${this.config.t.h}px`;\r\n    this.widgetRoot.style.width  = `${this.config.t.w}px`;\r\n\r\n    this.makeRequest( this.eventsLoadingHandler, this.apiUrl, {apikey: this.config.ak, keyword: this.config.kw} );\r\n  }\r\n\r\n  clear(){\r\n    this.widgetRoot.innerHTML = \"\";\r\n  }\r\n\r\n  update() {\r\n    this.clear();\r\n  }\r\n\r\n\r\n  loadConfig(){\r\n    return this.widgetRoot.dataset.config ? this.widgetRoot.dataset.config : null;\r\n  }\r\n\r\n  styleLoadingHandler(){\r\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n      if(this.status == 200){\r\n        var style = document.createElement(\"style\");\r\n        style.setAttribute(\"type\",\"text/css\");\r\n        style.textContent = this.responseText;\r\n        document.getElementsByTagName(\"head\")[0].appendChild(style);\r\n      }\r\n      else {\r\n        alert(\"theme wasn't loaded\")\r\n      }\r\n    }\r\n  }\r\n\r\n  eventsLoadingHandler(){\r\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n      if(this.status == 200){\r\n        this.widget.events = JSON.parse(this.responseText);\r\n        //this.widget.build();\r\n        this.widget.loadImages();\r\n      }\r\n      else if(this.status == 400) {\r\n        alert('There was an error 400')\r\n      }\r\n      else {\r\n        alert('something else other than 200 was returned')\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  loadImages(){\r\n    var self = this;\r\n    this.events.forEach(function(event){\r\n      var url = self.makeImageUrl(event.id);\r\n      self.makeRequest(self.loadImagesHandler ,url, {apikey: self.config.ak});\r\n    })\r\n  }\r\n\r\n  loadImagesHandler(){\r\n    if (this && this.readyState == XMLHttpRequest.DONE ) {\r\n      if(this.status == 200){\r\n        let response = JSON.parse(this.responseText);\r\n        let event = this.widget.getEventByID(response.id);\r\n        event.img = this.widget.getImageForEvent(response.images);\r\n        this.widget.publishEvent(event);\r\n      }\r\n      else {\r\n        console.error('Fail to load IMG for event');\r\n      }\r\n    }\r\n  }\r\n\r\n  publishEvent(event){\r\n    let DOMElement = this.createDOMItem(event);\r\n    this.eventsRoot.appendChild(DOMElement);\r\n  }\r\n\r\n  getEventByID(id){\r\n    for(let index in this.events){\r\n      if(this.events[index].id === id){\r\n        return this.events[index]\r\n      }\r\n    }\r\n  }\r\n\r\n  getImageForEvent(images){\r\n    var width = this.config.t.w,\r\n      height = this.config.t.h;\r\n\r\n    images.sort(function(a,b) {\r\n      if (a.width < b.width)\r\n        return -1;\r\n      else if (a.width > b.width)\r\n        return 1;\r\n      else\r\n        return 0;\r\n    });\r\n\r\n    var myimg;\r\n    images.forEach(function(element, index, array){\r\n      if(element.width >= width && element.height >= height && !myimg){\r\n        myimg = element.url;\r\n      }\r\n    });\r\n    return myimg;\r\n  }\r\n\r\n  parseEvents(eventsSet){\r\n    eventsSet = eventsSet._embedded.events;\r\n    var tmpEventSet = [];\r\n    for(var key in eventsSet){\r\n      let currentEvent = {};\r\n      currentEvent.id = eventsSet[key].id;\r\n      currentEvent.url = eventsSet[key].eventUrl ? eventsSet[key].eventUrl : \"\";\r\n      currentEvent.name = eventsSet[key].name;\r\n      currentEvent.date = {\r\n        day: eventsSet[key].dates.start.localDate,\r\n        time: eventsSet[key].dates.start.localTime\r\n      };\r\n      let eventCategories = eventsSet[key]._embedded.categories;\r\n      currentEvent.categories = Object.keys(eventCategories).map(function(category){\r\n        return eventCategories[category].name\r\n      });\r\n\r\n      tmpEventSet.push(currentEvent);\r\n    }\r\n    return tmpEventSet;\r\n  }\r\n\r\n\r\n  makeRequest(handler, url=this.apiUrl, attrs={}, method=\"GET\"){\r\n    attrs = Object.keys(attrs).map(function(key){\r\n      return `${key}=${attrs[key]}`;\r\n    }).join(\"&\");\r\n\r\n    url = [url,attrs].join(\"?\");\r\n\r\n    this.xmlHTTP = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    if(method == \"POST\") {\r\n      this.xmlHTTP.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\r\n    }\r\n    this.xmlHTTP.widget = this;\r\n    this.xmlHTTP.onreadystatechange = handler;\r\n    this.xmlHTTP.open(method, url, true);\r\n    this.xmlHTTP.send();\r\n  }\r\n\r\n  createDOMItem(itemConfig){\r\n    var event = document.createElement(\"li\");\r\n    event.classList.add(\"event-wrapper\");\r\n    event.style.backgroundImage = `url('${itemConfig.img}')`;\r\n    event.style.height = `${this.config.t.h}px`;\r\n    event.style.width  = `${this.config.t.w}px`;\r\n\r\n    var nameContent = document.createTextNode(itemConfig.name),\r\n      name =  document.createElement(\"div\");\r\n    name.classList.add(\"event-name\");\r\n    name.appendChild(nameContent);\r\n\r\n    var dateContent = document.createTextNode(itemConfig.date.day),\r\n      date = document.createElement(\"div\");\r\n    date.classList.add(\"event-date\");\r\n    date.appendChild(dateContent);\r\n\r\n    var timeContent = document.createTextNode(itemConfig.date.time),\r\n      time = document.createElement(\"div\");\r\n    time.classList.add(\"event-date\");\r\n    time.appendChild(timeContent);\r\n\r\n\r\n    var dateWraper = document.createElement(\"div\");\r\n    dateWraper.classList.add(\"event-date-wraper\");\r\n\r\n    dateWraper.appendChild(date);\r\n    dateWraper.appendChild(time);\r\n\r\n    var medWrapper = document.createElement(\"div\");\r\n    medWrapper.classList.add(\"event-content-wraper\");\r\n\r\n    medWrapper.appendChild(name);\r\n    medWrapper.appendChild(dateWraper);\r\n\r\n    event.appendChild(medWrapper);\r\n\r\n    return event;\r\n  }\r\n\r\n\r\n\r\n  makeImageUrl(id){\r\n    return `https://app.ticketmaster.com/discovery/v1/events/${id}/images.json`;\r\n  }\r\n\r\n\r\n  /*\r\n   * Config block\r\n   */\r\n\r\n  decConfig(config){\r\n    return JSON.parse(window.atob(config));\r\n  }\r\n\r\n  encConfig(config){\r\n    return window.btoa(config);\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\nconst widget = new TicketmasterWidget(\"#ticketmaster-config\");\r\n"]}