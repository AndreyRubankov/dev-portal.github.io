language: node_js
node_js:
  - "4.1"

env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true # speeds up installation of html-proofer
  - secure: "H++gXPFfOE+kUubGB+nyAprflCkfJCJ9Ydvg7Jerou53bsWKAdmGk8KXZyvxBbAVourfmIeXlBDCez4Mvs7atCAjdBz2vGOy3JEUmpMpCEyfx/0OIaywOYapmux6wV4sEu+JN0STpB+W0yDVajnDXs9wWn1oCyKDEHSYIm7edLZhH+c0diLE1JE5O1ds8Yuc0qEENxENsHOcs1M96bDUYrXM9RabphQKWnZlKtHRHQWq+JrvV1RnevOXK6Mo/g6fNreO99MJo7AJ4t6kJxPOx3sLfA9dvFqjr+RNKRDdk7EMAo1QQwl1YNMpbyHhSNLfHJuBXyThiKWznW+72N4KJ2sEiMFwSDIQC9rwhvc96nU3Olw9lgZNtC33+/nAL/n/lU77IwHF/XUG4tf3afR4he9wPtGdhbpnRCb6FajXG8A7FqTwUHXPvBiLpPBfdb4VGkYLg7dgsSQi5DEgVYOgz17H8d4JZ1CI0RTV2AREU9h+3OH9RilLPmsQu6xApWK/5RgmVcm3vaU/2RU/fqw5fbVsVnEB3gwy05GYCyJAcrp+Lch74zJYE9RGp74BniyQpMf5IIZ/8qGiIkDU+0oDZB/Fbd3cMNSeuT2uZL0rcLwD7eFGnLXzo+gco7Wxc47xAZg06f8YugOxhO1e2RmMXe2yzjevqJPLyn266BSrDCs="

# whitelist
branches:
  only:
    - master
    - dev
    - ran-test

before_script:
  - jekyll build
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 20 # give xvfb some time to start

script:
  - ./node_modules/karma/bin/karma start karma.conf.js
#  - htmlproof ./_site --verbose --href-ignore "#" --disable-external --file-ignore './_site/node_modules/*'
# - jekyll serve &
# - sleep 20 # give jekyll some time to start
# - galen test tests/galen/all.test --htmlreport tests/galen/reports/all
# - jekyll serve & #refresh jekyll
# - sleep 5
# - galen test tests/galen/all-part2.test --htmlreport tests/galen/reports/all-part2

#  - galen test tests/galen/all.test --htmlreport tests/galen/reports/all -groups SupportPage,ProductsDocsConsole,PD-WidgetsPage,Events
#  - galen test tests/galen/generate-img-all.test --htmlreport tests/galen/reports/all --groups SupportPage,ProductsDocsConsole,ProductsDocsSlate,PD-WidgetsPage,BlogsPage,Events,PartnersNexus,PartnersLanding,PD-getting-started-Page #generate comparing images
#  - galen test tests/galen/generate-img-all.test --htmlreport tests/galen/reports/all --groups PartnersNexus,PartnersLanding #generate comparing images

after_script:
  - rake travis:deploy --trace --verbose
  - rake travis:report --trace --verbose

cache:
  directories:
    - node_modules
    - bundler

notifications:
  email: false #

before_install:
  - ls ./
  - rm ./_site/* -rf #remove directory _site
  - rm ./events/* -rf #remove directory events
  - rm ./partners/* -rf #remove directory partners
  - \cp -avrf ./tests/content/*/ ./ #copy test content
  - ls ./events/list
  - rvm install 2.1.5
  - gem install github-pages
  - gem install html-proofer
  - npm install -g galenframework-cli
